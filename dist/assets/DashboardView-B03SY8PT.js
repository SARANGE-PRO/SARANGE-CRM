import{j as e,B as g,M as re,I as m,u as H,b as de,d as Q,A as O,S as X,a as oe}from"./index-DUWccq4l.js";import{r as i,m as C,E as ie,t as ce,u as xe,v as me,w as be,x as pe,y as he,z as ue,B as ge,F as fe,T as q,G as Ne,H as je,p as ve,A as U,C as G,n as Z,I as Ce,o as we}from"./vendor-BIhwZqk1.js";const ke=l=>{if(!l)return 0;const r=new Date;return l.filter(s=>{if(s.sendStatus==="SENT")return!1;if(!s.dateIntervention){const n=new Date(s.date);return(r-n)/(1e3*60*60*24)>5}return!1}).length},Se=l=>{if(!l.dateIntervention)return null;const r=w=>new Date(w).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",s=r(l.dateIntervention),n=r(new Date(new Date(l.dateIntervention).getTime()+60*6e4)),d=r(new Date);let x=l.adresse,a="",b="";l.gps&&l.gps.lat&&(a=`GEO:${l.gps.lat};${l.gps.lon}`,b=`X-APPLE-STRUCTURED-LOCATION;VALUE=URI;X-APPLE-RADIUS=100;X-TITLE="${l.adresse}":geo:${l.gps.lat},${l.gps.lon}`);const f=`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//SarangePro//MÃ©trage//FR
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:${l.id}@app.sarange.fr
DTSTAMP:${d}
DTSTART:${s}
DTEND:${n}
SUMMARY:MÃ©trÃ© : ${l.client}
DESCRIPTION:Client: ${l.client}\\nTÃ©lÃ©phone: ${l.telephone}\\nAdresse: ${l.adresse}
LOCATION:${x}
${a}
${b}
STATUS:CONFIRMED
BEGIN:VALARM
TRIGGER:-P1D
ACTION:DISPLAY
DESCRIPTION:Rappel J-1 : MÃ©trÃ© demain (${l.client})
END:VALARM
BEGIN:VALARM
TRIGGER:-PT2H
ACTION:DISPLAY
DESCRIPTION:Rappel H-2 : DÃ©part imminent ? VÃ©rifiez le trafic.
END:VALARM
BEGIN:VALARM
TRIGGER:-PT0M
ACTION:DISPLAY
DESCRIPTION:C'est l'heure du mÃ©trÃ© !
END:VALARM
END:VEVENT
END:VCALENDAR`,v=new Blob([f],{type:"text/calendar;charset=utf-8"});return URL.createObjectURL(v)},J=l=>{const r=Se(l);if(!r)return;const s=document.createElement("a");s.href=r,s.setAttribute("download",`Metre_${l.client.replace(/\s+/g,"_")}.ics`),document.body.appendChild(s),s.click(),document.body.removeChild(s)},Ie=l=>{if(!l.dateIntervention)return"";const r=encodeURIComponent(`MÃ©trÃ© : ${l.client}`),s=encodeURIComponent(`Client: ${l.client}
TÃ©lÃ©phone: ${l.telephone||""}
Adresse: ${l.adresse}

${l.gps?`GPS: ${l.gps.lat}, ${l.gps.lon}`:""}`),n=encodeURIComponent(l.adresse),d=new Date(l.dateIntervention),x=d.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",a=new Date(d.getTime()+60*6e4).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${r}&dates=${x}/${a}&details=${s}&location=${n}`},Te=({chantier:l})=>{const[r,s]=i.useState(!1);if(!l||!l.dateIntervention)return null;const n=()=>{window.open(Ie(l),"_blank"),s(!1)},d=()=>{J(l),s(!1)};return e.jsxs("div",{className:"relative inline-block",children:[e.jsxs(g,{variant:"secondary",onClick:()=>s(!r),className:"py-2 px-3 text-sm flex items-center gap-2",title:"Ajouter Ã  l'agenda",children:[e.jsx(C,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Agenda"})]}),r&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 z-50 animate-fade-in overflow-hidden flex flex-col p-1",children:[e.jsxs("button",{onClick:n,className:"flex items-center w-full px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 rounded-lg transition-colors text-left",children:[e.jsx(ie,{size:14,className:"mr-2"})," Google Calendar"]}),e.jsxs("button",{onClick:d,className:"flex items-center w-full px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg transition-colors text-left",children:[e.jsx(ce,{size:14,className:"mr-2"})," Outlook / Apple"]})]}),r&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>s(!1)})]})},Ee=({onClose:l,onConfirm:r})=>{const s=new Date;s.setDate(s.getDate()+1);const n=s.toISOString().split("T")[0],[d,x]=i.useState(n),[a,b]=i.useState("09:00"),f=c=>{const j=new Date;j.setDate(j.getDate()+c),x(j.toISOString().split("T")[0])},v=c=>{b(c)},w=()=>{if(!d||!a)return alert("Veuillez choisir une date et une heure");const c=`${d}T${a}`;r(c),l()},N=({label:c,onClick:j,active:P})=>e.jsx("button",{onClick:j,className:`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all ${P?"bg-brand-100 text-brand-700 border-brand-200":"bg-white text-slate-600 border-slate-200 hover:border-brand-300"}`,children:c});return e.jsx(re,{isOpen:!0,onClose:l,title:"Planifier l'intervention",size:"sm",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-200",children:[e.jsx(C,{size:16})," Date"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{label:"Demain",onClick:()=>f(1),active:!1}),e.jsx(N,{label:"+2j",onClick:()=>f(2),active:!1}),e.jsx(N,{label:"+7j",onClick:()=>f(7),active:!1})]})]}),e.jsx(m,{type:"date",value:d,onChange:x,className:"font-bold text-lg",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-200",children:[e.jsx(xe,{size:16})," Heure"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{label:"09:00",onClick:()=>v("09:00"),active:a==="09:00"}),e.jsx(N,{label:"14:00",onClick:()=>v("14:00"),active:a==="14:00"})]})]}),e.jsx(m,{type:"time",value:a,onChange:b,className:"font-bold text-lg text-center"})]}),e.jsx(g,{onClick:w,className:"w-full py-4 text-lg shadow-lg",icon:me,children:"Valider le rendez-vous"})]})})},Ae=({activeTab:l,onTabChange:r,counts:s})=>e.jsxs("div",{className:"lg:hidden flex mb-4 bg-white dark:bg-slate-900 rounded-xl p-1 shadow-sm border border-slate-200 dark:border-slate-800 sticky top-[130px] z-30",children:[e.jsxs("button",{onClick:()=>r("TODO"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-bold flex flex-col items-center gap-1 transition-all ${l==="TODO"?"bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 shadow-sm":"text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:16}),e.jsx("span",{children:"Ã€ FAIRE"})]}),s.todo>0&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-700 px-1.5 rounded-full",children:s.todo})]}),e.jsxs("button",{onClick:()=>r("PLANNING"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-bold flex flex-col items-center gap-1 transition-all ${l==="PLANNING"?"bg-brand-50 text-brand-600 dark:bg-brand-900/20 dark:text-brand-400 shadow-sm":"text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{size:16}),e.jsx("span",{children:"PLANNING"})]}),s.planning>0&&e.jsx("span",{className:"text-[10px] bg-brand-100 text-brand-700 px-1.5 rounded-full",children:s.planning})]}),e.jsxs("button",{onClick:()=>r("DONE"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-bold flex flex-col items-center gap-1 transition-all ${l==="DONE"?"bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400 shadow-sm":"text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{size:16}),e.jsx("span",{children:"TERMINÃ‰S"})]}),s.done>0&&e.jsx("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 rounded-full",children:s.done})]})]}),ye=({onNew:l,isDark:r,toggleDark:s,onOpenSettings:n,onOpenTrash:d,isOnline:x})=>{const{state:a,selectChantier:b,deleteChantier:f,duplicateChantier:v,updateChantier:w,addChantier:N}=H(),[c,j]=i.useState(""),[P,V]=i.useState(!1),[_,k]=i.useState(!1),K=i.useRef(null),[S,ee]=i.useState("TODO"),[I,L]=i.useState(null),te=t=>{if(I){w(I,{dateIntervention:t});const o=a.chantiers.find(u=>u.id===I);if(o)try{J({...o,dateIntervention:t})}catch(u){console.error("Auto-download ICS blocked",u)}L(null)}},[T,se]=i.useState(!1),B=(a.chantiers||[]).filter(t=>!t.deleted),ae=B.filter(t=>t.archived).length,[Y,le]=i.useState(0);i.useEffect(()=>{le(ke(a.chantiers||[]))},[a.chantiers]);const $=B.filter(t=>t.client.toLowerCase().includes(c.toLowerCase())||t.adresse.toLowerCase().includes(c.toLowerCase())||t.telephone&&t.telephone.includes(c)||t.email&&t.email.toLowerCase().includes(c.toLowerCase())).filter(t=>T?t.archived:!t.archived),E=$.filter(t=>!t.dateIntervention&&t.sendStatus!=="SENT").sort((t,o)=>new Date(t.date).getTime()-new Date(o.date).getTime()),A=$.filter(t=>t.dateIntervention&&t.sendStatus!=="SENT").sort((t,o)=>new Date(t.dateIntervention).getTime()-new Date(o.dateIntervention).getTime()),F=new Date,z=new Date(F.getFullYear(),F.getMonth(),F.getDate()).getTime(),y=z+864e5,ne=z+7*864e5,h={today:[],tomorrow:[],week:[],later:[]};A.forEach(t=>{const o=new Date(t.dateIntervention).getTime();o>=z&&o<y?h.today.push(t):o>=y&&o<y+864e5?h.tomorrow.push(t):o>=y+864e5&&o<ne?h.week.push(t):h.later.push(t)});const D=$.filter(t=>t.sendStatus==="SENT").sort((t,o)=>new Date(o.sentAt).getTime()-new Date(t.sentAt).getTime()),M=({c:t,isTodo:o=!1})=>{const u=!t.dateIntervention&&t.sendStatus!=="SENT"&&Date.now()-new Date(t.date).getTime()>432e6;return e.jsxs("div",{onClick:()=>b(t.id),className:`relative group bg-white dark:bg-slate-900 p-4 rounded-xl border shadow-sm hover:shadow-md active:scale-[0.99] transition-all cursor-pointer overflow-hidden mb-3
                    ${t.sendStatus==="SENT"?"border-slate-200 dark:border-slate-800 opacity-75 hover:opacity-100":u?"border-red-400 dark:border-red-500 ring-1 ring-red-400 dark:ring-red-500":"border-slate-200 dark:border-slate-800 hover:border-brand-400 dark:hover:border-brand-600"}
                `,children:[u&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-bl-lg",children:"URGENT"}),e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-bold text-lg dark:text-white truncate pr-2",children:t.client}),t.sendStatus==="SENT"&&e.jsx(G,{size:16,className:"text-green-500"})]}),e.jsx("div",{className:"text-sm text-slate-500 mb-3 ml-[-5px]",children:e.jsx(oe,{address:t.adresse,gps:t.gps})}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-lg p-2.5 flex items-center justify-between mb-3 text-sm",children:[t.dateIntervention?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"Intervention"}),e.jsxs("span",{className:"font-bold text-brand-600 dark:text-brand-400 flex items-center gap-1",children:[e.jsx(C,{size:14}),new Date(t.dateIntervention).toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})]})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"CrÃ©Ã© le"}),e.jsx("span",{className:"font-bold text-slate-600 dark:text-slate-300",children:new Date(t.date).toLocaleDateString("fr-FR")})]}),t.telephone&&e.jsx("a",{href:`tel:${t.telephone}`,onClick:p=>p.stopPropagation(),className:"bg-white dark:bg-slate-700 p-2 rounded-full text-slate-600 dark:text-slate-300 shadow-sm border border-slate-100 dark:border-slate-600 hover:text-brand-600 hover:border-brand-600 transition-colors",children:e.jsx(Ce,{size:16})})]}),o&&e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsx(g,{className:"flex-1 py-2 text-xs bg-brand-600 text-white shadow-md hover:bg-brand-700 h-10",onClick:p=>{p.stopPropagation(),L(t.id)},icon:C,children:"PLANIFIER"})}),e.jsxs("div",{className:"flex items-center justify-end pt-2 mt-2 border-t border-slate-100 dark:border-slate-800 gap-2",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),v(t.id)},className:"text-slate-400 hover:text-brand-500",children:e.jsx(we,{size:16})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),confirm("Supprimer ?")&&f(t.id)},className:"text-slate-400 hover:text-red-500",children:e.jsx(q,{size:16})})]})]})},R=({title:t,items:o,color:u})=>o.length===0?null:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:`text-xs font-bold uppercase tracking-wider mb-2 ${u}`,children:t}),o.map(p=>e.jsx(M,{c:p},p.id))]});return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0 z-40 px-4 pb-3 safe-top-padding shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 max-w-[1400px] mx-auto pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/favicon-512.png",alt:"Logo",className:"w-8 h-8 object-contain rounded-lg"}),e.jsxs("h1",{className:"text-xl font-bold tracking-tight",children:["Sarange",e.jsx("span",{className:"text-brand-600",children:"Pro"})]})]}),e.jsxs("div",{className:"flex gap-2 relative",ref:K,children:[x?e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full",children:e.jsx(be,{size:20,className:"text-green-500"})}):e.jsx("div",{className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full",children:e.jsx(pe,{size:20,className:"text-slate-400"})}),e.jsx("button",{onClick:()=>k(!_),className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:e.jsx(he,{size:20})}),_&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 overflow-hidden z-50 animate-fade-in origin-top-right",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("button",{onClick:s,className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg transition-colors",children:[r?e.jsx(ue,{size:16,className:"mr-3 text-orange-400"}):e.jsx(ge,{size:16,className:"mr-3 text-brand-600"}),r?"Mode Clair":"Mode Sombre"]}),e.jsx("div",{className:"h-px bg-slate-100 dark:bg-slate-700 my-1"}),e.jsxs("button",{onClick:()=>{se(!T),k(!1)},className:`w-full flex items-center px-3 py-2 text-sm rounded-lg transition-colors ${T?"bg-brand-50 text-brand-700":"text-slate-700 dark:text-slate-200 hover:bg-slate-50"}`,children:[e.jsx(fe,{size:16,className:"mr-3"}),T?"Voir Dossiers Actifs":"Voir Archives",e.jsx("span",{className:"ml-auto text-xs bg-slate-100 px-1.5 rounded-full",children:ae})]}),e.jsxs("button",{onClick:()=>{d(),k(!1)},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-lg",children:[e.jsx(q,{size:16,className:"mr-3 text-red-500"}),"Corbeille"]}),e.jsxs("button",{onClick:()=>{n(),k(!1)},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-lg",children:[e.jsx(Ne,{size:16,className:"mr-3"}),"ParamÃ¨tres"]})]})})]})]}),e.jsxs("div",{className:"max-w-[1400px] mx-auto relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(je,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-800 border-0 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all shadow-inner",placeholder:"Rechercher un dossier...",value:c,onChange:t=>j(t.target.value)})]}),e.jsx(g,{onClick:()=>V(!0),icon:ve,className:"py-2 text-sm shadow-sm whitespace-nowrap px-4",children:"Nouveau"})]})]}),e.jsxs("main",{className:"flex-1 p-4 max-w-[1400px] mx-auto w-full h-[calc(100vh-140px)] overflow-hidden flex flex-col",children:[Y>0&&e.jsx("div",{className:"mb-4 shrink-0",children:e.jsxs(de,{variant:"warning",icon:U,children:[Y," dossiers en attente de planification depuis +3 jours !"]})}),e.jsx(Ae,{activeTab:S,onTabChange:ee,counts:{todo:E.length,planning:A.length,done:D.length}}),e.jsxs("div",{className:"flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:`flex flex-col h-full ${S==="TODO"?"block":"hidden lg:flex"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-red-600 flex items-center gap-2",children:[e.jsx(U,{size:20}),"Ã€ PLANIFIER",e.jsx("span",{className:"bg-red-100 text-red-700 text-xs px-2 py-0.5 rounded-full",children:E.length})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 pb-20 custom-scrollbar",children:E.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Aucun dossier en attente ðŸŽ‰"}):E.map(t=>e.jsx(M,{c:t,isTodo:!0},t.id))})]}),e.jsxs("div",{className:`flex flex-col h-full ${S==="PLANNING"?"block":"hidden lg:flex"} lg:border-l lg:border-r lg:border-slate-100 lg:dark:border-slate-800 lg:px-6`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-brand-600 flex items-center gap-2",children:[e.jsx(C,{size:20}),"PLANNING",e.jsx("span",{className:"bg-brand-100 text-brand-700 text-xs px-2 py-0.5 rounded-full",children:A.length})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 pb-20 custom-scrollbar",children:A.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Planning vide ðŸ˜´"}):e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"Aujourd'hui",items:h.today,color:"text-green-600"}),e.jsx(R,{title:"Demain",items:h.tomorrow,color:"text-blue-600"}),e.jsx(R,{title:"Cette semaine",items:h.week,color:"text-brand-600"}),e.jsx(R,{title:"Plus tard",items:h.later,color:"text-slate-500"})]})})]}),e.jsxs("div",{className:`flex flex-col h-full ${S==="DONE"?"block":"hidden lg:flex"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-green-600 flex items-center gap-2",children:[e.jsx(G,{size:20}),"TERMINÃ‰S",e.jsx("span",{className:"bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full",children:D.length})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 pb-20 custom-scrollbar",children:D.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Aucun dossier terminÃ©"}):D.map(t=>e.jsx(M,{c:t},t.id))})]})]})]}),P&&e.jsx(W,{onClose:()=>V(!1)}),I&&e.jsx(Ee,{onClose:()=>L(null),onConfirm:te})]})},W=({onClose:l})=>{const{addChantier:r}=H(),[s,n]=i.useState({client:"",adresse:"",gps:null,typeContrat:"FOURNITURE_SEULE",telephone:"",email:"",clientFinal:"",adresseFinale:""}),d=(a,b="adresse")=>{n(typeof a=="object"?{...s,[b]:a.address,gps:a.gps}:{...s,[b]:a})},x=()=>{if(!s.client)return alert("Nom requis");if(s.typeContrat==="SOUS_TRAITANCE"&&(!s.clientFinal||!s.adresseFinale))return alert("Client final requis");r({...s,date:new Date().toISOString()}),l()};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-4 animate-fade-in",children:e.jsxs(Q,{className:"w-full max-w-md p-6 shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 dark:text-white",children:"Nouveau Dossier"}),e.jsx(m,{label:"Nom Client",value:s.client,onChange:a=>n({...s,client:a}),placeholder:"Ex: Entreprise BTP"}),e.jsx(O,{value:s.adresse,onChange:a=>d(a,"adresse")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{label:"TÃ©l",value:s.telephone,onChange:a=>n({...s,telephone:a}),type:"tel",inputMode:"tel",pattern:"[0-9]*"}),e.jsx(m,{label:"Email",value:s.email,onChange:a=>n({...s,email:a}),type:"email",inputMode:"email"})]}),e.jsx(X,{label:"Contrat",value:s.typeContrat,onChange:a=>n({...s,typeContrat:a}),options:[{label:"Fourniture Seule",value:"FOURNITURE_SEULE"},{label:"Fourniture & Pose",value:"FOURNITURE_ET_POSE"},{label:"Sous-traitance",value:"SOUS_TRAITANCE"}]}),s.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700 mb-4 animate-fade-in",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-500 mb-2 uppercase flex items-center",children:[e.jsx(Z,{size:14,className:"mr-1"})," Client Final"]}),e.jsx(m,{label:"Nom Final",value:s.clientFinal,onChange:a=>n({...s,clientFinal:a}),placeholder:"Ex: Mme Michu"}),e.jsx(O,{value:s.adresseFinale,onChange:a=>d(a,"adresseFinale")})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(g,{variant:"secondary",onClick:l,className:"flex-1",children:"Annuler"}),e.jsx(g,{onClick:x,className:"flex-1",children:"CrÃ©er"})]})]})})},De=({chantier:l,onClose:r,onUpdate:s})=>{const[n,d]=i.useState({...l}),x=()=>{if(!n.client)return alert("Nom requis");if(n.typeContrat==="SOUS_TRAITANCE"&&(!n.clientFinal||!n.adresseFinale))return alert("Client final requis");s(n),r()};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-4 animate-fade-in",children:e.jsxs(Q,{className:"w-full max-w-md p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Modifier le dossier"}),e.jsx(Te,{chantier:n})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"block text-sm font-bold text-slate-500 mb-2 uppercase",children:"Planification"}),e.jsx(m,{label:"Date d'intervention",type:"datetime-local",value:n.dateIntervention||"",onChange:a=>d({...n,dateIntervention:a})}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:n.dateIntervention?"âœ… Ce dossier passera en PLANNING":"âš ï¸ Sans date, ce dossier reste en Ã€ PLANIFIER"})]}),e.jsx(m,{label:"Nom Client",value:n.client,onChange:a=>d({...n,client:a})}),e.jsx(O,{value:n.adresse,onChange:a=>d(typeof a=="object"?{...n,adresse:a.address,gps:a.gps}:{...n,adresse:a})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{label:"TÃ©l",value:n.telephone,onChange:a=>d({...n,telephone:a}),type:"tel",inputMode:"tel",pattern:"[0-9]*"}),e.jsx(m,{label:"Email",value:n.email,onChange:a=>d({...n,email:a}),type:"email",inputMode:"email"})]}),e.jsx(X,{label:"Contrat",value:n.typeContrat,onChange:a=>d({...n,typeContrat:a}),options:[{label:"Fourniture Seule",value:"FOURNITURE_SEULE"},{label:"Fourniture & Pose",value:"FOURNITURE_ET_POSE"},{label:"Sous-traitance",value:"SOUS_TRAITANCE"}]}),n.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg border border-amber-200 dark:border-amber-800 animate-fade-in",children:[e.jsxs("h3",{className:"text-xs font-bold text-amber-600 dark:text-amber-400 mb-2 uppercase flex items-center",children:[e.jsx(Z,{size:14,className:"mr-1"})," Client Final"]}),e.jsx(m,{label:"Nom Final",value:n.clientFinal,onChange:a=>d({...n,clientFinal:a})}),e.jsx(O,{value:n.adresseFinale,onChange:a=>d({...n,adresseFinale:a})})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(g,{variant:"secondary",onClick:r,className:"flex-1",children:"Annuler"}),e.jsx(g,{onClick:x,className:"flex-1",children:"Enregistrer"})]})]})})},Pe=Object.freeze(Object.defineProperty({__proto__:null,DashboardView:ye,EditChantierModal:De,NewChantierModal:W},Symbol.toStringTag,{value:"Module"}));export{Pe as D,De as E,J as d};
