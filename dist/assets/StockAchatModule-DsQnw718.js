import{r as p,o as v,a as f,b as N,g as C,f as w,j as r}from"./index-DMGdsos9.js";import{r as g,ah as O,e as A,u as j,T as y,l as M}from"./vendor-DQYctaBf.js";import"./utils-CKkNC6ps.js";const u="OrdresCommande",D="OrdresFabrication",I={VITRAGE:"VITRAGE",PROFILS:"PROFILS",NEGOCE:"NEGOCE",FOURNITURE:"FOURNITURE"},d={A_COMMANDER:"A_COMMANDER",COMMANDE_PASSEE:"COMMANDE_PASSEE",RECEPTIONNE:"RECEPTIONNE"},$=s=>{const n=p(f,u);return v(n,o=>{const a=o.val();if(!a){s([]);return}const l=Object.entries(a).map(([i,b])=>({id:i,...b}));s(l)},o=>{console.error("âŒ Erreur getOrdresCommande:",o),s([])})},h=async(s,n)=>{const c=p(f,`${u}/${s}`),o={statut:n};if(n===d.COMMANDE_PASSEE&&(o.date_commande=new Date().toISOString()),n===d.RECEPTIONNE&&(o.date_reception=new Date().toISOString()),await N(c,o),console.log(`ðŸ“¦ OC ${s} â†’ ${n}`),n===d.COMMANDE_PASSEE)try{const a=await C(c);if(!a.exists())return;const l=a.val();if(l.type_commande===I.VITRAGE&&l.of_lie_id){const i=p(f,`${D}/${l.of_lie_id}`),b=await C(i);b.exists()&&b.val().statut==="ATTENTE_VITRAGE"&&(await N(i,{statut:"A_FABRIQUER"}),console.log(`ðŸ”“ OF ${l.of_lie_id} dÃ©bloquÃ© : ATTENTE_VITRAGE â†’ A_FABRIQUER`))}}catch(a){console.error("âŒ Erreur rÃ¨gle Vitrage:",a)}},P=async s=>{const n=p(f,`${u}/${s}`);await w(n),console.log(`ðŸ—‘ï¸ OC ${s} supprimÃ©`)},F=[{id:d.A_COMMANDER,title:"Ã€ Commander",shortTitle:"Ã€ Faire",icon:O,dot:"bg-amber-500",color:"bg-amber-50/50 dark:bg-amber-900/10",headerColor:"text-amber-700 dark:text-amber-300",border:"border-amber-100 dark:border-amber-900",ring:"ring-amber-400"},{id:d.COMMANDE_PASSEE,title:"Commande PassÃ©e",shortTitle:"CommandÃ©",icon:A,dot:"bg-brand-500",color:"bg-brand-50/50 dark:bg-brand-900/10",headerColor:"text-brand-700 dark:text-brand-300",border:"border-brand-100 dark:border-brand-900",ring:"ring-brand-400"},{id:d.RECEPTIONNE,title:"RÃ©ceptionnÃ©",shortTitle:"ReÃ§u",icon:j,dot:"bg-green-500",color:"bg-green-50/50 dark:bg-green-900/10",headerColor:"text-green-700 dark:text-green-300",border:"border-green-100 dark:border-green-900",ring:"ring-green-400"}],k={VITRAGE:{label:"Vitrage",bg:"bg-sky-100 dark:bg-sky-900/30 text-sky-700 dark:text-sky-300"},PROFILS:{label:"Profils",bg:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300"},NEGOCE:{label:"NÃ©goce",bg:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300"},FOURNITURE:{label:"Fourniture",bg:"bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}},L=()=>{const[s,n]=g.useState([]),[c,o]=g.useState(d.A_COMMANDER),[a,l]=g.useState(null);g.useEffect(()=>{const e=$(n);return()=>{typeof e=="function"&&e()}},[]);const i=g.useMemo(()=>F.map(e=>({...e,items:s.filter(t=>t.statut===e.id)})),[s]),b=(e,t)=>{l(t),e.dataTransfer.effectAllowed="move"},E=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},R=async(e,t)=>{if(e.preventDefault(),!a)return;const m=s.find(x=>x.id===a);if(m&&m.statut!==t)try{await h(a,t)}catch(x){console.error("Drop error:",x)}l(null)},T=async e=>{try{await h(e.id,d.COMMANDE_PASSEE)}catch(t){console.error(t)}},S=async e=>{try{await h(e.id,d.RECEPTIONNE)}catch(t){console.error(t)}},_=async e=>{if(confirm(`Supprimer la commande ${e.client_nom} ?`))try{await P(e.id)}catch(t){console.error(t)}};return r.jsxs("div",{className:"flex flex-col h-full bg-slate-50 dark:bg-slate-900",children:[r.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 pt-[max(1rem,env(safe-area-inset-top))] pb-4 flex-shrink-0 flex items-center shadow-sm z-20",children:r.jsxs("h2",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2 mr-auto",children:[r.jsx(O,{size:22,className:"text-brand-600"}),"Stock & Achat"]})}),r.jsx("div",{className:"md:hidden flex-none px-2 pt-4 pb-2 bg-slate-50 dark:bg-slate-900 w-full z-10 shrink-0",children:r.jsx("div",{className:"grid grid-cols-3 gap-2",children:i.map(e=>r.jsxs("button",{onClick:()=>o(e.id),className:`p-3 rounded-xl border transition-all flex flex-col items-center gap-1.5 text-center
                                ${c===e.id?`ring-2 ring-offset-1 ${e.ring} border-transparent`:`${e.border}/30 opacity-90`}
                                ${e.color}`,children:[r.jsx("div",{className:"text-2xl font-bold",children:e.items.length}),r.jsx("div",{className:"text-[11px] font-bold uppercase",children:e.shortTitle})]},`tile-${e.id}`))})}),r.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto pb-40 md:pb-0 w-full bg-slate-50 dark:bg-slate-900",children:r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 px-4 md:px-6 md:pt-6 pb-6",children:i.map(e=>(e.icon,r.jsxs("div",{className:`flex flex-col rounded-2xl border ${e.border}/60 ${e.color} ${c===e.id?"block":"hidden md:flex"}`,onDragOver:E,onDrop:t=>R(t,e.id),children:[r.jsx("div",{className:"hidden md:flex items-center justify-between p-4 border-b border-slate-200/50 dark:border-slate-700/50",children:r.jsxs("h3",{className:`font-bold ${e.headerColor} flex items-center gap-2`,children:[r.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${e.dot}`}),e.title,r.jsx("span",{className:"bg-white/50 dark:bg-slate-800/50 text-xs px-2 py-0.5 rounded-full shadow-sm ml-2",children:e.items.length})]})}),r.jsx("div",{className:"flex-1 p-0 pt-4 md:p-3 pb-0 md:pb-6 space-y-3",children:e.items.length===0?r.jsx("div",{className:"h-24 md:h-full flex items-center justify-center border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl text-slate-400 text-sm font-medium",children:"Aucune commande"}):e.items.map(t=>{const m=k[t.type_commande]||k.FOURNITURE;return r.jsxs("div",{draggable:!0,onDragStart:x=>b(x,t.id),className:`bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4 shadow-sm hover:shadow-md transition-shadow cursor-grab active:cursor-grabbing ${a===t.id?"opacity-50 scale-95":""}`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-bold text-sm text-slate-800 dark:text-white truncate",children:t.client_nom||"Client"}),r.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5 truncate",children:[t.description||"Commande",t.reference_devis&&r.jsxs("span",{className:"ml-2 text-slate-400",children:["#",t.reference_devis]})]})]}),r.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-full shrink-0 ${m.bg}`,children:m.label})]}),t.fournisseur&&r.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:[r.jsx(y,{size:12,className:"inline mr-1"}),t.fournisseur]}),r.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[t.statut===d.A_COMMANDER&&r.jsxs("button",{onClick:()=>T(t),className:"flex items-center gap-1 text-xs font-semibold text-brand-600 bg-brand-50 hover:bg-brand-100 dark:bg-brand-900/20 dark:hover:bg-brand-900/40 px-2.5 py-1.5 rounded-lg transition-colors",children:[r.jsx(A,{size:12})," Commander"]}),t.statut===d.COMMANDE_PASSEE&&r.jsxs("button",{onClick:()=>S(t),className:"flex items-center gap-1 text-xs font-semibold text-green-600 bg-green-50 hover:bg-green-100 dark:bg-green-900/20 dark:hover:bg-green-900/40 px-2.5 py-1.5 rounded-lg transition-colors",children:[r.jsx(j,{size:12})," RÃ©ceptionner"]}),r.jsxs("button",{onClick:()=>_(t),className:"flex items-center gap-1 text-xs font-semibold text-slate-500 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 px-2.5 py-1.5 rounded-lg transition-colors",children:[r.jsx(M,{size:12})," Suppr."]})]})]},t.id)})})]},e.id)))})})]})};export{L as StockAchatModule};
