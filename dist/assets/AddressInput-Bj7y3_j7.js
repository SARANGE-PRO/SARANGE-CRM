import{R as f,r as c,p as g,X as w,L as N}from"./vendor-DQYctaBf.js";import{j as t}from"./index-DMGdsos9.js";const h=(...a)=>a.filter(Boolean).join(" "),L=({options:a,value:o,onChange:d,label:n,error:u,id:x,className:m="",disabled:r=!1})=>f.createElement("div",{className:h("mb-4",m),id:x},n?f.createElement("label",{className:"block text-sm font-medium mb-2 text-slate-700 dark:text-slate-300"},n):null,f.createElement("div",{className:h("flex flex-wrap gap-1 bg-slate-100 dark:bg-slate-800 p-1 rounded-xl transition-all",u&&"field-error-ring animate-shake bg-red-50 dark:bg-red-950/20")},a.map(l=>f.createElement("button",{key:l.value,type:"button",onClick:()=>{r||d(l.value)},disabled:r,className:h("flex-1 flex-grow py-2 px-3 text-sm font-medium rounded-lg transition-all",o===l.value?"bg-white dark:bg-slate-700 text-brand-600 shadow-sm":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",r&&"opacity-50 cursor-not-allowed")},l.label))),u?f.createElement("span",{className:"text-xs text-red-500 mt-1 block"},"Requis"):null),z=({value:a,onChange:o})=>{const[d,n]=c.useState(!1),[u,x]=c.useState([]),[m,r]=c.useState(!1),l=c.useRef(null);c.useEffect(()=>{function e(s){l.current&&!l.current.contains(s.target)&&r(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]);const v=async e=>{if(!(!e||e.length<3))try{const i=await(await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(e)}&limit=5`)).json();i&&i.features&&(x(i.features),r(!0))}catch(s){console.error("Erreur recherche adresse",s)}};c.useEffect(()=>{const e=typeof a=="object"?a.address:a,s=setTimeout(()=>{e&&m&&v(e)},500);return()=>clearTimeout(s)},[a,m]);const j=()=>{if(!navigator.geolocation)return alert("Géolocalisation non supportée");n(!0);const e={enableHighAccuracy:!0,timeout:1e4,maximumAge:0};navigator.geolocation.getCurrentPosition(async s=>{try{const b=await(await fetch(`https://api-adresse.data.gouv.fr/reverse/?lon=${s.coords.longitude}&lat=${s.coords.latitude}`)).json();if(b&&b.features&&b.features.length>0){const y={address:b.features[0].properties.label,gps:{lat:s.coords.latitude,lon:s.coords.longitude}};o(y),x(b.features),r(!0)}else alert("Adresse introuvable à cette position.")}catch(i){console.error(i),alert("Erreur réseau API Adresse")}finally{n(!1)}},s=>{n(!1),console.warn("Erreur GPS:",s),alert("Impossible de vous localiser précisément. Vérifiez que le GPS est activé.")},e)},k=e=>{const s={address:e.properties.label,gps:{lon:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]}};o(s),r(!1)},p=typeof a=="object"?a.address:a||"";return t.jsxs("div",{className:"mb-4 relative",ref:l,children:[t.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-200 mb-1",children:"Adresse du chantier"}),t.jsxs("div",{className:"relative flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{type:"text",value:p,onChange:e=>{o(e.target.value),r(!0)},onFocus:()=>p&&p.length>3&&r(!0),placeholder:"Saisir ou cliquer sur le pin...",className:"w-full p-3 pl-10 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all shadow-sm",autoComplete:"off"}),t.jsx(g,{size:18,className:"absolute left-3 top-3.5 text-slate-400"}),p&&t.jsx("button",{type:"button",onClick:()=>{o(""),x([])},className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600",children:t.jsx(w,{size:16})})]}),t.jsx("button",{type:"button",onClick:j,disabled:d,className:"shrink-0 w-12 flex items-center justify-center bg-brand-50 dark:bg-brand-900/20 text-brand-600 border border-brand-200 dark:border-brand-800 rounded-xl hover:bg-brand-100 transition-colors disabled:opacity-50 active:scale-95",children:d?t.jsx(N,{className:"animate-spin",size:20}):t.jsx(g,{size:20})})]}),m&&u.length>0&&t.jsx("ul",{className:"absolute z-[100] left-0 right-0 mt-1 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-fade-in divide-y divide-slate-100 dark:divide-slate-700",children:u.map((e,s)=>t.jsx("li",{children:t.jsxs("button",{type:"button",onClick:()=>k(e),className:"w-full text-left px-4 py-3 text-sm text-slate-700 dark:text-slate-200 hover:bg-brand-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[t.jsx(g,{size:14,className:"text-slate-400 shrink-0"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-bold",children:e.properties.name}),t.jsxs("div",{className:"text-xs text-slate-400",children:[e.properties.postcode," ",e.properties.city]})]})]})},s))}),t.jsxs("p",{className:"text-[10px] text-slate-400 mt-1 ml-1 flex justify-between",children:[t.jsx("span",{children:"Le bouton utilise le GPS haute précision."}),d&&t.jsx("span",{className:"text-brand-500 font-bold",children:"Localisation en cours..."})]})]})};export{z as A,L as S};
