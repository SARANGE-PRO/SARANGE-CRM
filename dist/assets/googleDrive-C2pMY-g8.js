import{i as y,e as T}from"./index-faf4erw8.js";import"./vendor-BhKfyhrK.js";import"./utils-CKkNC6ps.js";const w=async()=>{await y(),await T()},p=async(e,r="root")=>{await w();const o=`name='${e}' and mimeType='application/vnd.google-apps.folder' and '${r}' in parents and trashed=false`;try{const i=(await window.gapi.client.drive.files.list({q:o,fields:"files(id, name)",spaces:"drive"})).result.files;if(i&&i.length>0)return console.log(`ðŸ“ Dossier "${e}" trouvÃ©: ${i[0].id}`),i[0].id;const n=await window.gapi.client.drive.files.create({resource:{name:e,mimeType:"application/vnd.google-apps.folder",parents:[r]},fields:"id"});return console.log(`ðŸ“ Dossier "${e}" crÃ©Ã©: ${n.result.id}`),n.result.id}catch(t){throw console.error("Erreur getOrCreateFolder:",t),t}},f=async(e,r,o,t)=>{await w();const i=window.gapi.client.getToken().access_token,n={name:r,mimeType:o,parents:[t]},s="-------314159265358979323846",d=`\r
--`+s+`\r
`,a=`\r
--`+s+"--",l=new FileReader;return new Promise((h,m)=>{l.readAsBinaryString(e),l.onload=async()=>{const u=d+`Content-Type: application/json\r
\r
`+JSON.stringify(n)+d+"Content-Type: "+o+`\r
Content-Transfer-Encoding: base64\r
\r
`+btoa(l.result)+a;try{const c=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:"Bearer "+i,"Content-Type":'multipart/related; boundary="'+s+'"'},body:u});if(!c.ok)throw new Error(`Upload failed: ${c.statusText}`);const g=await c.json();console.log(`â˜ï¸ Fichier "${r}" uploadÃ©: ${g.id}`),h(g.id)}catch(c){console.error("Erreur uploadFile:",c),m(c)}},l.onerror=u=>m(u)})},v=async e=>{await w();try{return(await window.gapi.client.drive.files.list({q:`'${e}' in parents and trashed=false`,fields:"files(id, name, mimeType, webViewLink, webContentLink, createdTime)",orderBy:"createdTime desc",spaces:"drive"})).result.files||[]}catch(r){throw console.error("Erreur listFilesInFolder:",r),r}},$=e=>({viewUrl:`https://drive.google.com/file/d/${e}/view`,downloadUrl:`https://drive.google.com/uc?export=download&id=${e}`,embedUrl:`https://drive.google.com/file/d/${e}/preview`}),k=async(e,r,o)=>{var t,i;try{const n=await p("SarangePro"),d=((t=e.client)==null?void 0:t.trim().replace(/[/\\?%*:|"<>]/g,"-"))||`Chantier_${((i=e.id)==null?void 0:i.substring(0,8))||"inconnu"}`,a=await p(d,n),l=await f(r,o,"application/pdf",a);return console.log(`ðŸ“¤ Quote uploaded to Drive: ${o}`),{fileId:l,folderId:a,filename:o}}catch(n){throw console.error("Erreur uploadQuoteToDrive:",n),n}},E=async e=>{var r,o;try{const t=await p("SarangePro"),n=((r=e.client)==null?void 0:r.trim().replace(/[/\\?%*:|"<>]/g,"-"))||`Chantier_${((o=e.id)==null?void 0:o.substring(0,8))||"inconnu"}`,s=await p(n,t);return(await v(s)).map(a=>({id:a.id,name:a.name,mimeType:a.mimeType,createdTime:a.createdTime,...$(a.id)}))}catch(t){return console.error("Erreur getChantierQuotes:",t),[]}},B=async e=>{await w();const r=window.gapi.client.getToken().access_token;try{const o=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?alt=media`,{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(!o.ok)throw new Error(`Download failed: ${o.statusText}`);const t=await o.blob();return console.log(`ðŸ“¥ Downloaded file ${e} as Blob (${t.size} bytes)`),t}catch(o){throw console.error("Erreur downloadFileAsBlob:",o),o}};export{B as downloadFileAsBlob,E as getChantierQuotes,$ as getFileUrl,p as getOrCreateFolder,v as listFilesInFolder,f as uploadFile,k as uploadQuoteToDrive};
