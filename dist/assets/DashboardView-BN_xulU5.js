const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/googleDrive-C2pMY-g8.js","assets/index-faf4erw8.js","assets/vendor-BhKfyhrK.js","assets/utils-CKkNC6ps.js","assets/index-Cd5KaDml.css"])))=>i.map(i=>d[i]);
import{j as e,B as S,u as M,_ as q}from"./index-faf4erw8.js";import{r as c,p as z,s as Y,a6 as H,D as W,w as J,f as U,C as K,a2 as X}from"./vendor-BhKfyhrK.js";import{c as Z}from"./calendar-CKSkTVT9.js";import{M as ee,I as g,A as _,S as te}from"./Modal-CalFg_z_.js";import{C as ae}from"./Card-SCoU-xcW.js";import{C as P}from"./ChantierCard-COOuaPxo.js";import{S as se}from"./StatusBanner-BIbTQqiz.js";import{g as le,D as ne}from"./utils-CKkNC6ps.js";import"./SmartAddress-CarXayvO.js";const re=({onClose:x,onConfirm:m})=>{const u=new Date;u.setDate(u.getDate()+1);const s=u.toISOString().split("T")[0],[l,o]=c.useState(s),[b,f]=c.useState("09:00"),j=i=>{const d=new Date;d.setDate(d.getDate()+i),o(d.toISOString().split("T")[0])},a=i=>{f(i)},h=()=>{if(!l||!b)return alert("Veuillez choisir une date et une heure");const i=`${l}T${b}`;m(i),x()},r=({label:i,onClick:d,active:N})=>e.jsx("button",{onClick:d,className:`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all ${N?"bg-brand-100 text-brand-700 border-brand-200":"bg-white text-slate-600 border-slate-200 hover:border-brand-300"}`,children:i});return e.jsx(ee,{isOpen:!0,onClose:x,title:"Planifier l'intervention",size:"sm",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-200",children:[e.jsx(z,{size:16})," Date"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{label:"Demain",onClick:()=>j(1),active:!1}),e.jsx(r,{label:"+2j",onClick:()=>j(2),active:!1}),e.jsx(r,{label:"+7j",onClick:()=>j(7),active:!1})]})]}),e.jsx(g,{type:"date",value:l,onChange:o,className:"font-bold text-lg",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-200",children:[e.jsx(Y,{size:16})," Heure"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{label:"09:00",onClick:()=>a("09:00"),active:b==="09:00"}),e.jsx(r,{label:"14:00",onClick:()=>a("14:00"),active:b==="14:00"})]})]}),e.jsx(g,{type:"time",value:b,onChange:f,className:"font-bold text-lg text-center"})]}),e.jsx(S,{onClick:h,className:"w-full py-4 text-lg shadow-lg",icon:H,children:"Valider le rendez-vous"})]})})},ie=({activeTab:x,onTabChange:m,counts:u})=>e.jsxs("div",{className:"lg:hidden grid grid-cols-3 gap-2 mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>m("TODO"),className:`p-3 rounded-xl border transition-all flex flex-col items-center justify-center text-center gap-1
                    ${x==="TODO"?"ring-2 ring-offset-1 ring-red-400 dark:ring-red-500 border-transparent":"border-red-100 dark:border-red-900/30"}
                    bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400`,children:[e.jsx("div",{className:"text-2xl font-bold",children:u.todo}),e.jsx("div",{className:"text-[10px] font-bold uppercase truncate w-full",children:"À PLANIFIER"})]}),e.jsxs("button",{onClick:()=>m("PLANNING"),className:`p-3 rounded-xl border transition-all flex flex-col items-center justify-center text-center gap-1
                      ${x==="PLANNING"?"ring-2 ring-offset-1 ring-brand-400 dark:ring-brand-500 border-transparent":"border-brand-100 dark:border-brand-900/30"}
                      bg-brand-50 text-brand-600 dark:bg-brand-900/20 dark:text-brand-400`,children:[e.jsx("div",{className:"text-2xl font-bold",children:u.planning}),e.jsx("div",{className:"text-[10px] font-bold uppercase truncate w-full",children:"PLANNING"})]}),e.jsxs("button",{onClick:()=>m("DONE"),className:`p-3 rounded-xl border transition-all flex flex-col items-center justify-center text-center gap-1
                      ${x==="DONE"?"ring-2 ring-offset-1 ring-green-400 dark:ring-green-500 border-transparent":"border-green-100 dark:border-green-900/30"}
                      bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400`,children:[e.jsx("div",{className:"text-2xl font-bold",children:u.done}),e.jsx("div",{className:"text-[10px] font-bold uppercase truncate w-full",children:"ENVOYÉS"})]})]}),Ne=({onNew:x,isDark:m,toggleDark:u,showArchived:s})=>{const{state:l,selectChantier:o,deleteChantier:b,duplicateChantier:f,updateChantier:j,addChantier:a,updateChantierDate:h}=M(),[r,i]=c.useState(""),[d,N]=c.useState(!1),[de,ce]=c.useState(!1);c.useRef(null);const[v,$]=c.useState("TODO"),[I,T]=c.useState(null),G=async t=>{I&&(T(null),t&&h(I,t))},L=(l.chantiers||[]).filter(t=>!t.deleted&&!t.purged&&(!t.assignation||t.assignation==="METRAGE"));L.filter(t=>t.archived).length;const[R,B]=c.useState(0);c.useEffect(()=>{B(Z(l.chantiers||[]))},[l.chantiers]);const E=L.filter(t=>t.client.toLowerCase().includes(r.toLowerCase())||t.adresse.toLowerCase().includes(r.toLowerCase())||t.telephone&&t.telephone.includes(r)||t.email&&t.email.toLowerCase().includes(r.toLowerCase())).filter(t=>s?t.archived:!t.archived),C=E.filter(t=>!t.dateIntervention&&t.sendStatus!=="SENT").sort((t,n)=>new Date(t.date).getTime()-new Date(n.date).getTime()),w=E.filter(t=>t.dateIntervention&&t.sendStatus!=="SENT").sort((t,n)=>new Date(t.dateIntervention).getTime()-new Date(n.dateIntervention).getTime()),A=new Date,O=new Date(A.getFullYear(),A.getMonth(),A.getDate()).getTime(),k=O+864e5,Q=O+7*864e5,p={today:[],tomorrow:[],week:[],later:[]};w.forEach(t=>{const n=new Date(t.dateIntervention).getTime();n>=O&&n<k?p.today.push(t):n>=k&&n<k+864e5?p.tomorrow.push(t):n>=k+864e5&&n<Q?p.week.push(t):p.later.push(t)});const D=E.filter(t=>t.sendStatus==="SENT").sort((t,n)=>new Date(n.sentAt).getTime()-new Date(t.sentAt).getTime()),y=({title:t,items:n,color:V})=>n.length===0?null:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:`text-xs font-bold uppercase tracking-wider mb-2 ${V}`,children:t}),n.map(F=>e.jsx(P,{c:F,onClick:()=>o(F.id)},F.id))]});return e.jsxs("div",{className:"flex flex-col h-full w-full bg-slate-50 dark:bg-slate-900 overflow-hidden",children:[e.jsx("div",{className:"flex-none bg-white dark:bg-slate-900 px-4 pt-3 pb-3 border-b border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"w-full mx-auto relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-800 border-0 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all shadow-inner",placeholder:"Rechercher un dossier...",value:r,onChange:t=>i(t.target.value)})]}),e.jsx(S,{onClick:()=>N(!0),icon:J,className:"py-2 text-sm shadow-sm whitespace-nowrap px-4",children:"Nouveau"})]})}),e.jsxs("main",{className:"flex-1 min-h-0 overflow-y-auto pb-40 lg:pb-0 w-full mx-auto",children:[R>0&&e.jsx("div",{className:"flex-none px-4 pt-4 mb-2",children:e.jsxs(se,{variant:"warning",icon:U,children:[R," dossiers en attente de planification depuis +3 jours !"]})}),e.jsx("div",{className:"flex-none px-4 pt-2 z-10 w-full relative",children:e.jsx(ie,{activeTab:v,onTabChange:$,counts:{todo:C.length,planning:w.length,done:D.length}})}),e.jsxs("div",{className:"flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-3 gap-6 h-auto lg:h-full px-4 pb-0",children:[e.jsxs("div",{className:`flex flex-col h-auto lg:h-full ${v==="TODO"?"block":"hidden lg:flex"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-red-600 flex items-center gap-2",children:[e.jsx(U,{size:20}),"À PLANIFIER",e.jsx("span",{className:"bg-red-100 text-red-700 text-xs px-2 py-0.5 rounded-full",children:C.length})]})}),e.jsx("div",{className:"flex-1 lg:overflow-y-auto overscroll-contain pr-2 pb-0 lg:pb-32 custom-scrollbar",children:C.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Aucun dossier en attente"}):C.map(t=>e.jsx(P,{c:t,isTodo:!0,onPlanifier:n=>T(n)},t.id))})]}),e.jsxs("div",{className:`flex flex-col h-auto lg:h-full ${v==="PLANNING"?"block":"hidden lg:flex"} lg:border-l lg:border-r lg:border-slate-100 lg:dark:border-slate-800 lg:px-6`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-brand-600 flex items-center gap-2",children:[e.jsx(z,{size:20}),"PLANNING",e.jsx("span",{className:"bg-brand-100 text-brand-700 text-xs px-2 py-0.5 rounded-full",children:w.length})]})}),e.jsx("div",{className:"flex-1 lg:overflow-y-auto overscroll-contain pr-2 pb-0 lg:pb-32 custom-scrollbar",children:w.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Planning vide"}):e.jsxs(e.Fragment,{children:[e.jsx(y,{title:"Aujourd'hui",items:p.today,color:"text-green-600"}),e.jsx(y,{title:"Demain",items:p.tomorrow,color:"text-blue-600"}),e.jsx(y,{title:"Cette semaine",items:p.week,color:"text-brand-600"}),e.jsx(y,{title:"Plus tard",items:p.later,color:"text-slate-500"})]})})]}),e.jsxs("div",{className:`flex flex-col h-auto lg:h-full ${v==="DONE"?"block":"hidden lg:flex"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-green-600 flex items-center gap-2",children:[e.jsx(K,{size:20}),"ENVOYÉS",e.jsx("span",{className:"bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full",children:D.length})]})}),e.jsx("div",{className:"flex-1 lg:overflow-y-auto overscroll-contain pr-2 pb-0 lg:pb-32 custom-scrollbar",children:D.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Aucun dossier envoyé"}):D.map(t=>e.jsx(P,{c:t},t.id))})]})]})]}),d&&e.jsx(oe,{onClose:()=>N(!1)}),I&&e.jsx(re,{onClose:()=>T(null),onConfirm:G})]})},oe=({onClose:x})=>{const{addChantier:m,updateChantier:u}=M(),[s,l]=c.useState({client:"",adresse:"",gps:null,typeContrat:"FOURNITURE_SEULE",telephone:"",email:"",clientFinal:"",adresseFinale:"",notes:"",dateIntervention:""}),[o,b]=c.useState(null),f=(a,h="adresse")=>{l(typeof a=="object"?{...s,[h]:a.address,gps:a.gps}:{...s,[h]:a})},j=async()=>{if(!s.client)return alert("Nom requis");if(s.typeContrat==="SOUS_TRAITANCE"&&(!s.clientFinal||!s.adresseFinale))return alert("Client final requis");let a=null;o&&(a=le(),await ne.storeFile(a,o));const h={...s,date:new Date().toISOString(),quoteFileId:a,quoteFileName:o?o.name:null},r=m(h);if(x(),o&&a){const{uploadQuoteToDrive:i}=await q(async()=>{const{uploadQuoteToDrive:d}=await import("./googleDrive-C2pMY-g8.js");return{uploadQuoteToDrive:d}},__vite__mapDeps([0,1,2,3,4]));i(r,o,o.name).then(d=>{console.log(`✅ Quote auto-uploaded to Drive: ${d.filename}`)}).catch(d=>{console.error("Drive auto-upload failed:",d)})}if(r.dateIntervention)try{const i=await manageGoogleEvent(r);i&&u(r.id,{googleEventId:i})}catch(i){console.error("Silent GCal Sync Fail",i)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-end md:items-center justify-center p-0 md:p-4 animate-fade-in",children:e.jsxs(ae,{className:"w-full max-w-md p-6 shadow-2xl rounded-t-2xl md:rounded-2xl max-h-[95vh] overflow-y-auto animate-slide-up md:animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Nouveau Dossier"}),e.jsx("button",{onClick:x,className:"p-2 text-slate-400 hover:text-slate-600 bg-slate-50 dark:bg-slate-800 rounded-full transition-colors",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{label:"Nom Client",value:s.client,onChange:a=>l({...s,client:a}),placeholder:"Ex: Entreprise BTP"}),e.jsx(_,{value:s.adresse,onChange:a=>f(a,"adresse")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"Tél",value:s.telephone,onChange:a=>l({...s,telephone:a}),type:"tel",inputMode:"tel",pattern:"[0-9]*"}),e.jsx(g,{label:"Email",value:s.email,onChange:a=>l({...s,email:a}),type:"email",inputMode:"email"})]}),e.jsx(te,{label:"Contrat",value:s.typeContrat,onChange:a=>l({...s,typeContrat:a}),options:[{label:"Fourniture Seule",value:"FOURNITURE_SEULE"},{label:"Fourniture & Pose",value:"FOURNITURE_ET_POSE"},{label:"Sous-traitance",value:"SOUS_TRAITANCE"}]}),s.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700 animate-fade-in",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-500 mb-2 uppercase flex items-center",children:[e.jsx(X,{size:14,className:"mr-1"})," Client Final"]}),e.jsx(g,{label:"Nom Final",value:s.clientFinal,onChange:a=>l({...s,clientFinal:a}),placeholder:"Ex: Mme Michu"}),e.jsx(_,{value:s.adresseFinale,onChange:a=>f(a,"adresseFinale")})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-2 uppercase tracking-wider",children:"Devis PDF (Optionnel)"}),e.jsx("input",{type:"file",accept:".pdf,application/pdf",className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-brand-50 file:text-brand-700 hover:file:bg-brand-100",onChange:a=>b(a.target.files?a.target.files[0]:null)}),o&&e.jsxs("p",{className:"text-xs text-brand-600 mt-1",children:["Fichier sélectionné : ",o.name]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-2 uppercase tracking-wider",children:"Planification (Optionnel)"}),e.jsx(g,{label:"Date d'intervention",type:"datetime-local",value:s.dateIntervention||"",onChange:a=>l({...s,dateIntervention:a})}),e.jsx("p",{className:"text-[10px] font-medium text-slate-400 mt-2",children:s.dateIntervention?"✅ Ce dossier passera directement en PLANNING":"ℹ️ Sans date, le dossier sera À PLANIFIER"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 ml-1",children:"Infos supplémentaires"}),e.jsx("textarea",{className:"w-full p-3 bg-slate-100 dark:bg-slate-800 border-0 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 transition-all text-sm min-h-[80px]",placeholder:"Codes d'accès, instructions particulières...",value:s.notes,onChange:a=>l({...s,notes:a.target.value})})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8 pb-4",children:[e.jsx(S,{variant:"secondary",onClick:x,className:"flex-1",children:"Annuler"}),e.jsx(S,{onClick:j,className:"flex-1",children:"Créer"})]})]})})};export{Ne as DashboardView,oe as NewChantierModal};
