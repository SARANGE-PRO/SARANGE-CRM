const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardView-DaDsQQXf.js","assets/vendor-Dg6mT7in.js","assets/utils-CRpMHnBn.js","assets/ChantierDetailView-ClGGQ_Dg.js","assets/SettingsView-BtuFfdE3.js"])))=>i.map(i=>d[i]);
import{r as g,a as A,R as l,A as C}from"./vendor-Dg6mT7in.js";import{D as y,L as w,g as j}from"./utils-CRpMHnBn.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();const B="modulepreload",V=function(t){return"/"+t},D={},S=function(e,s,n){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),b=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(s.map(u=>{if(u=V(u),u in D)return;D[u]=!0;const v=u.endsWith(".css"),k=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${k}`))return;const p=document.createElement("link");if(p.rel=v?"stylesheet":B,v||(p.as="script"),p.crossOrigin="",p.href=u,b&&p.setAttribute("nonce",b),document.head.appendChild(p),v)return new Promise((d,c)=>{p.addEventListener("load",d),p.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(o){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=o,window.dispatchEvent(b),!b.defaultPrevented)throw o}return a.then(o=>{for(const b of o||[])b.status==="rejected"&&r(b.reason);return e().catch(r)})};var L={exports:{}},N={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z=g,$=Symbol.for("react.element"),U=Symbol.for("react.fragment"),F=Object.prototype.hasOwnProperty,M=z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,q={key:!0,ref:!0,__self:!0,__source:!0};function O(t,e,s){var n,a={},r=null,o=null;s!==void 0&&(r=""+s),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)F.call(e,n)&&!q.hasOwnProperty(n)&&(a[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)a[n]===void 0&&(a[n]=e[n]);return{$$typeof:$,type:t,key:r,ref:o,props:a,_owner:M.current}}N.Fragment=U;N.jsx=O;N.jsxs=O;L.exports=N;var i=L.exports,I,R=A;I=R.createRoot,R.hydrateRoot;const x=(...t)=>t.filter(Boolean).join(" "),_=({onClick:t,variant:e="primary",children:s,icon:n,disabled:a=!1,className:r="",type:o="button"})=>{const b={primary:"bg-brand-600 text-white hover:bg-brand-700 disabled:bg-brand-300 shadow-lg shadow-brand-500/25 focus-visible:ring-brand-300",whatsapp:"bg-green-600 text-white hover:bg-green-700 shadow-lg shadow-green-600/20 focus-visible:ring-green-300",secondary:"bg-white text-slate-700 border border-slate-200 hover:bg-slate-50 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-700 focus-visible:ring-brand-200",danger:"bg-red-50 text-red-600 border border-red-100 hover:bg-red-100 dark:bg-red-900/20 dark:border-red-900/30 focus-visible:ring-red-200",ghost:"text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 focus-visible:ring-brand-200"},u=[];return n&&u.push(l.createElement(n,{key:"icon",size:18,className:s?"mr-2":void 0})),u.push(s),l.createElement("button",{type:o,onClick:t,disabled:a,className:x("inline-flex items-center justify-center px-4 py-3 rounded-full font-semibold transition-all active:scale-95 focus-visible:outline-none focus-visible:ring-4",b[e]||b.primary,r)},u)},ee=({label:t,value:e,onChange:s,placeholder:n,type:a="text",error:r,inputMode:o,pattern:b,id:u,className:v="",disabled:k=!1})=>l.createElement("div",{className:x("mb-4",v),id:u},t?l.createElement("label",{className:x("block text-sm font-medium mb-1.5",r?"text-red-600":"text-slate-700 dark:text-slate-300")},`${t}${r?" *":""}`):null,l.createElement("input",{type:a,value:e||"",onChange:p=>s&&s(p.target.value),placeholder:n,inputMode:o,pattern:b,disabled:k,className:x("w-full p-3 rounded-xl bg-white dark:bg-slate-900 border outline-none transition-all dark:text-white focus:ring-4",r?"border-red-500 focus:ring-red-200 focus:border-red-500":"border-slate-200 dark:border-slate-700 focus:border-brand-500 focus:ring-brand-200",k&&"opacity-50 cursor-not-allowed")}),r?l.createElement("span",{className:"text-xs text-red-500 mt-1 block"},"Requis"):null),te=({options:t,value:e,onChange:s,label:n,error:a,id:r,className:o="",disabled:b=!1})=>l.createElement("div",{className:x("mb-4",o),id:r},l.createElement("label",{className:x("block text-sm font-medium mb-2",a?"text-red-600":"text-slate-700 dark:text-slate-300")},`${n}${a?" *":""}`),l.createElement("div",{className:x("flex flex-wrap gap-2 p-1 rounded-xl",a?"border border-red-200 bg-red-50":"")},t.map(u=>l.createElement("button",{key:u.value,type:"button",onClick:()=>!b&&s(u.value),disabled:b,className:x("px-3 py-2 rounded-xl text-sm font-medium border transition-all",e===u.value?"bg-brand-600 text-white border-brand-600 shadow-lg shadow-brand-500/25":"bg-white text-slate-600 border-slate-200 hover:bg-slate-50 dark:bg-slate-800 dark:text-slate-300 dark:border-slate-700",b&&"opacity-50 cursor-not-allowed")},u.label)))),re=({className:t="",children:e,...s})=>l.createElement("div",{className:x("bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm",t),...s},e),Y=({size:t=20,className:e=""})=>l.createElement("div",{className:x("animate-spin rounded-full border-2 border-current border-t-transparent",e),style:{width:t,height:t}}),ae=({isOpen:t,onClose:e,title:s,children:n,size:a="md"})=>{if(!t)return null;const r={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",full:"max-w-full"};return l.createElement("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center",onClick:o=>o.target===o.currentTarget&&(e==null?void 0:e())},l.createElement("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-fade-in"}),l.createElement("div",{className:x("relative w-full bg-white dark:bg-slate-900 shadow-2xl","rounded-t-3xl md:rounded-2xl","max-h-[90vh] overflow-y-auto","animate-slide-up md:animate-fade-in",r[a]||r.md,"md:mx-4")},s&&l.createElement("div",{className:"sticky top-0 bg-white dark:bg-slate-900 px-6 py-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center"},l.createElement("h2",{className:"text-xl font-bold dark:text-white"},s),e&&l.createElement("button",{onClick:e,className:"p-2 -mr-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400"},"âœ•")),l.createElement("div",{className:"p-6"},n)))},se=({variant:t="info",icon:e,children:s,action:n,onAction:a})=>{const r={success:"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200 border-green-200 dark:border-green-800",error:"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 border-red-200 dark:border-red-800",warning:"bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-200 border-amber-200 dark:border-amber-800",info:"bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 border-blue-200 dark:border-blue-800"};return l.createElement("div",{className:x("px-4 py-3 border-b flex items-center justify-between",r[t])},l.createElement("div",{className:"flex items-center gap-2"},e&&l.createElement(e,{size:18,className:"shrink-0"}),l.createElement("span",{className:"text-sm font-medium"},s)),n&&l.createElement("button",{onClick:a,className:"text-xs font-bold uppercase opacity-80 hover:opacity-100 underline"},n))},ne=({message:t,type:e="success",onClose:s})=>{const n={success:"bg-green-600 text-white",error:"bg-red-600 text-white",info:"bg-slate-800 text-white",warning:"bg-amber-500 text-white"},a={success:"âœ“",error:"âœ•",info:"â„¹",warning:"âš "};return l.useEffect(()=>{const r=setTimeout(()=>s==null?void 0:s(),4e3);return()=>clearTimeout(r)},[s]),l.createElement("div",{className:x("fixed bottom-24 left-1/2 -translate-x-1/2 z-[60]","px-5 py-3 rounded-full shadow-xl","flex items-center gap-3","animate-fade-in",n[e])},l.createElement("span",{className:"text-lg"},a[e]),l.createElement("span",{className:"font-medium"},t))},oe=({checked:t,onChange:e,label:s,className:n=""})=>l.createElement("label",{className:x("flex items-center gap-3 p-4 rounded-xl border cursor-pointer transition-all min-h-[56px]",t?"bg-brand-50 dark:bg-brand-900/20 border-brand-500 text-brand-700 dark:text-brand-300":"bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700",n)},l.createElement("input",{type:"checkbox",checked:t,onChange:a=>e==null?void 0:e(a.target.checked),className:"w-6 h-6 rounded-md accent-brand-600"}),l.createElement("span",{className:"font-medium dark:text-white"},s)),P=g.createContext(null),le=()=>g.useContext(P),J=l.lazy(()=>S(()=>import("./DashboardView-DaDsQQXf.js"),__vite__mapDeps([0,1,2])).then(t=>({default:t.DashboardView}))),K=l.lazy(()=>S(()=>import("./ChantierDetailView-ClGGQ_Dg.js"),__vite__mapDeps([3,1,2,0])).then(t=>({default:t.ChantierDetailView}))),W=l.lazy(()=>S(()=>import("./SettingsView-BtuFfdE3.js"),__vite__mapDeps([4,1,2])).then(t=>({default:t.SettingsView}))),G=({step:t,error:e,onRetry:s})=>{const[n,a]=g.useState(!1);return i.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-slate-50 dark:bg-slate-900 absolute inset-0 z-50 p-4",children:[i.jsx("div",{className:"text-4xl mb-6 animate-bounce",children:"ðŸ—ï¸"}),i.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-2",children:"Sarange Pro"}),e?i.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-6 rounded-xl max-w-sm w-full text-center animate-fade-in",children:[i.jsx(C,{size:48,className:"mx-auto text-red-500 mb-4"}),i.jsx("h3",{className:"font-bold text-lg text-red-700 dark:text-red-300 mb-2",children:"Erreur de dÃ©marrage"}),i.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-6",children:e.message}),i.jsxs("div",{className:"space-y-3",children:[i.jsx(_,{onClick:s,variant:"primary",className:"w-full",children:"RÃ©essayer"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(_,{onClick:()=>a(!n),variant:"secondary",className:"flex-1 text-xs",children:"Logs"}),i.jsx(_,{onClick:()=>{const r=URL.createObjectURL(w.getBlob());window.open(r)},variant:"secondary",className:"flex-1 text-xs",children:"Download"})]})]})]}):i.jsxs("div",{className:"w-64",children:[i.jsxs("div",{className:"flex justify-between text-xs font-bold text-slate-500 mb-2 uppercase tracking-wide",children:[i.jsx("span",{children:"Chargement..."}),i.jsx("span",{children:t})]}),i.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-brand-600 animate-pulse w-full origin-left-right"})})]}),n&&i.jsx("div",{className:"mt-8 w-full max-w-lg bg-black text-green-400 font-mono text-xs p-4 rounded h-48 overflow-auto border border-slate-700 shadow-2xl",children:w.logs.map((r,o)=>i.jsxs("div",{children:[i.jsxs("span",{className:"opacity-50",children:["[",r.ts.split("T")[1].split(".")[0],"]"]})," ",i.jsx("span",{className:r.level==="error"?"text-red-400":r.level==="warn"?"text-amber-400":"",children:r.msg})]},o))})]})},H=()=>{const[t,e]=g.useState({chantiers:[],products:[],currentChantierId:null}),[s,n]=g.useState({loading:!0,step:"Init",error:null}),[a,r]=g.useState("list"),[o,b]=g.useState(!1),u=async()=>{try{n({loading:!0,step:"DB",error:null}),await y.init(),n(m=>({...m,step:"Migration"}));const d=localStorage.getItem("sarange_db_v3");if(d)try{w.info("Migration depuis LocalStorage...");const m=JSON.parse(d);await y.set("sarange_root",m),localStorage.removeItem("sarange_db_v3"),w.info("Migration OK")}catch(m){w.error("Erreur Migration",m)}n(m=>({...m,step:"DonnÃ©es"}));const c=await y.get("sarange_root");if(c){const h=Date.now();let E=!1;c.chantiers&&(c.chantiers=c.chantiers.map(f=>{const T=new Date(f.date).getTime();return!f.archived&&h-T>864e6?(E=!0,{...f,archived:!0}):f})),E&&w.info("Auto-archived old chantiers"),e(c)}w.info("App Ready"),n({loading:!1,step:"Ready",error:null})}catch(d){console.error(d),w.error("Boot Failed",d),n({loading:!0,step:"Erreur",error:d})}};g.useEffect(()=>{u()},[]);const v=g.useRef(null);g.useEffect(()=>{s.loading||(v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{y.set("sarange_root",t).catch(d=>w.error("AutoSave Fail",d))},1e3))},[t,s.loading]),g.useEffect(()=>{o?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[o]);const k={addChantier:d=>e(c=>({...c,chantiers:[{...d,id:j()},...c.chantiers]})),updateChantier:(d,c)=>e(m=>({...m,chantiers:m.chantiers.map(h=>h.id===d?{...h,...c}:h)})),deleteChantier:d=>e(c=>({...c,chantiers:c.chantiers.filter(m=>m.id!==d),products:c.products.filter(m=>m.chantierId!==d)})),selectChantier:d=>e(c=>({...c,currentChantierId:d})),saveProduct:d=>e(c=>{const m=c.products.find(h=>h.id===d.id);return{...c,products:m?c.products.map(h=>h.id===d.id?{...d,dateMaj:new Date().toISOString()}:h):[...c.products,d]}}),deleteProduct:d=>e(c=>({...c,products:c.products.filter(m=>m.id!==d)})),duplicateChantier:d=>{const c=t.chantiers.find(f=>f.id===d);if(!c)return;const m=j(),h={...c,id:m,client:c.client+" (Copie)",date:new Date().toISOString(),dateFinalisation:null,sendStatus:"DRAFT",sentAt:null,lastError:null},E=t.products.filter(f=>f.chantierId===d).map(f=>({...f,id:j(),chantierId:m}));e(f=>({...f,chantiers:[h,...f.chantiers],products:[...f.products,...E]}))},importData:d=>{e(d),y.set("sarange_root",d).catch(c=>console.error(c))}};if(s.loading)return i.jsx(G,{step:s.step,error:s.error,onRetry:u});const p=()=>i.jsx("div",{className:"h-screen w-full flex items-center justify-center bg-slate-50 dark:bg-slate-900",children:i.jsx(Y,{size:40,className:"text-brand-600"})});return i.jsx(P.Provider,{value:{state:t,...k},children:i.jsx("div",{className:"min-h-screen flex flex-col safe-pb",children:i.jsx(g.Suspense,{fallback:i.jsx(p,{}),children:a==="settings"?i.jsx(W,{onBack:()=>r("list"),state:t,onImport:k.importData}):t.currentChantierId?i.jsx(K,{}):i.jsx(J,{onNew:()=>r("new"),viewMode:a,setViewMode:r,isDark:o,toggleDark:()=>b(!o),onOpenSettings:()=>r("settings")})})})})},Q=I(document.getElementById("root"));Q.render(i.jsx(H,{}));export{_ as B,oe as C,ee as I,ae as M,te as S,ne as T,se as a,Y as b,re as c,i as j,le as u};
