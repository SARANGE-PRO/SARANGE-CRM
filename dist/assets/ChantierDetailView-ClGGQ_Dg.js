import{j as e,u as O,B as z,S as D,I as P,a as X,b as ee,T as ae,M as te,C as Y}from"./index-BkUUXKzz.js";import{r as u,P as H,U as K,T as B,M as Q,S as Z,b as le,X as G,C as oe,L as R,c as ne,A as se,d as V,e as de,f as ie,g as ce,D as ue,h as xe,i as be,j as me,k as he,l as pe,m as re,n as ge,o as fe}from"./vendor-Dg6mT7in.js";import{V as _,c as je,g as W,a as ke,L as q,b as Ne}from"./utils-CRpMHnBn.js";import{EditChantierModal as ve}from"./DashboardView-DaDsQQXf.js";const we=({data:x,onChange:y,disabled:f=!1})=>{const r=u.useRef(null),t=u.useRef(null),[j,m]=u.useState((x==null?void 0:x.lines)||[]),[E,C]=u.useState(!1),[A,d]=u.useState(!1),[i,k]=u.useState("free"),[N,a]=u.useState(null),[n,h]=u.useState(null),F=350,v=250;u.useEffect(()=>{y({lines:j,width:F,height:v})},[j]);const b=(o,g=1,I=0,l=0)=>{if(!o)return;const c=o.getContext("2d");if(c.clearRect(0,0,o.width,o.height),c.save(),c.translate(I,l),c.scale(g,g),c.fillStyle="white",c.fillRect(0,0,F,v),c.lineCap="round",c.lineJoin="round",c.lineWidth=3,c.strokeStyle="#2563EB",j.forEach(w=>{if(!(w.length<1)){c.beginPath(),c.moveTo(w[0].x,w[0].y);for(let $=1;$<w.length;$++)c.lineTo(w[$].x,w[$].y);c.stroke()}}),E&&N&&n){if(c.strokeStyle="#93C5FD",c.beginPath(),i!=="free"){if(i==="line")c.moveTo(N.x,N.y),c.lineTo(n.x,n.y);else if(i==="rect"){const w=n.x-N.x,$=n.y-N.y;c.rect(N.x,N.y,w,$)}}c.stroke()}c.restore()};u.useEffect(()=>{b(r.current)},[j,E,n,i]);const[S,s]=u.useState({s:1,x:0,y:0});u.useEffect(()=>{if(!A||!t.current)return;const o=t.current;o.width=window.innerWidth,o.height=window.innerHeight;const g=Math.min(o.width/F,o.height/v)*.95,I=(o.width-F*g)/2,l=(o.height-v*g)/2;s({s:g,x:I,y:l}),b(o,g,I,l)},[A,j,E,n]);const p=(o,g=1,I=0,l=0)=>{const c=o.target.getBoundingClientRect(),w=o.touches?o.touches[0]:o;return{x:(w.clientX-c.left-I)/g,y:(w.clientY-c.top-l)/g}},T=(o,g)=>{if(f)return;o.cancelable&&o.preventDefault(),g==="fs"?t.current:r.current;const{s:I,x:l,y:c}=g==="fs"?S:{s:1,x:0,y:0},w=p(o,I,l,c);C(!0),a(w),h(w),i==="free"&&m($=>[...$,[w]])},M=(o,g)=>{if(f||!E)return;o.cancelable&&o.preventDefault();const{s:I,x:l,y:c}=g==="fs"?S:{s:1,x:0,y:0},w=p(o,I,l,c);h(w),i==="free"&&m($=>{const L=[...$],J=L[L.length-1];return J&&(L[L.length-1]=[...J,w]),L})},U=()=>{if(E){if(C(!1),N&&n){if(i==="line")m(o=>[...o,[N,n]]);else if(i==="rect"){const o=N,g=n,I={x:g.x,y:o.y},l={x:o.x,y:g.y};m(c=>[...c,[o,I,g,l,o]])}}a(null),h(null)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg p-3 relative group ${f?"opacity-70":""}`,children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs text-slate-500 uppercase font-bold tracking-wide",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(H,{size:14,className:"mr-1"})," Croquis ",e.jsx("span",{className:"ml-2 text-brand-600 dark:text-brand-400 font-bold",children:"— VUE INTÉRIEUR"})]}),!f&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>m(o=>o.slice(0,-1)),className:"p-1 hover:bg-slate-200 dark:hover:bg-slate-700 rounded text-slate-600 dark:text-slate-400",title:"Annuler",children:e.jsx(K,{size:16})}),e.jsx("button",{onClick:()=>confirm("Effacer tout ?")&&m([]),className:"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded text-red-500",title:"Effacer",children:e.jsx(B,{size:16})})]})]}),!f&&e.jsxs("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-700 pb-2",children:[e.jsxs("button",{onClick:()=>k("free"),className:`flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-bold transition-colors ${i==="free"?"bg-brand-600 text-white shadow-sm":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700"}`,children:[e.jsx(H,{size:14})," Crayon"]}),e.jsxs("button",{onClick:()=>k("line"),className:`flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-bold transition-colors ${i==="line"?"bg-brand-600 text-white shadow-sm":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700"}`,children:[e.jsx(Q,{size:14})," Ligne"]}),e.jsxs("button",{onClick:()=>k("rect"),className:`flex items-center gap-1 px-3 py-1.5 rounded-md text-xs font-bold transition-colors ${i==="rect"?"bg-brand-600 text-white shadow-sm":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700"}`,children:[e.jsx(Z,{size:14})," Rect"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("canvas",{ref:r,width:F,height:v,className:`w-full h-48 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded touch-none shadow-inner ${f?"cursor-not-allowed":"cursor-crosshair"}`,onMouseDown:o=>T(o,"sm"),onMouseMove:o=>M(o,"sm"),onMouseUp:U,onMouseLeave:U,onTouchStart:o=>T(o,"sm"),onTouchMove:o=>M(o,"sm"),onTouchEnd:U}),!f&&e.jsx("button",{onClick:()=>d(!0),className:"absolute top-2 right-2 p-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur rounded-full shadow border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:text-brand-600",children:e.jsx(le,{size:20})})]})]}),A&&!f&&e.jsxs("div",{className:"fixed inset-0 z-[60] bg-slate-950 flex items-center justify-center touch-none",children:[e.jsx("canvas",{ref:t,className:"block cursor-crosshair",onMouseDown:o=>T(o,"fs"),onMouseMove:o=>M(o,"fs"),onMouseUp:U,onMouseLeave:U,onTouchStart:o=>T(o,"fs"),onTouchMove:o=>M(o,"fs"),onTouchEnd:U}),e.jsxs("div",{className:"absolute top-4 left-4 flex gap-2 bg-slate-800/90 backdrop-blur p-2 rounded-lg border border-slate-700 shadow-xl",children:[e.jsx("button",{onClick:()=>k("free"),className:`p-3 rounded-md ${i==="free"?"bg-brand-600 text-white":"text-slate-400 hover:bg-slate-700"}`,children:e.jsx(H,{size:24})}),e.jsx("button",{onClick:()=>k("line"),className:`p-3 rounded-md ${i==="line"?"bg-brand-600 text-white":"text-slate-400 hover:bg-slate-700"}`,children:e.jsx(Q,{size:24})}),e.jsx("button",{onClick:()=>k("rect"),className:`p-3 rounded-md ${i==="rect"?"bg-brand-600 text-white":"text-slate-400 hover:bg-slate-700"}`,children:e.jsx(Z,{size:24})})]}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("button",{onClick:()=>d(!1),className:"p-3 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-500",children:e.jsx(G,{size:24})})}),e.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-4 bg-slate-800/90 backdrop-blur p-2 rounded-full border border-slate-700 shadow-xl",children:[e.jsxs("button",{onClick:()=>m(o=>o.slice(0,-1)),className:"px-6 py-3 bg-slate-700 text-white rounded-full font-bold hover:bg-slate-600 flex items-center",children:[e.jsx(K,{size:20,className:"mr-2"})," Annuler"]}),e.jsxs("button",{onClick:()=>confirm("Tout effacer ?")&&m([]),className:"px-6 py-3 bg-red-900/50 text-red-200 rounded-full font-bold hover:bg-red-900/70 flex items-center",children:[e.jsx(B,{size:20,className:"mr-2"})," Effacer"]}),e.jsxs("button",{onClick:()=>d(!1),className:"px-8 py-3 bg-green-600 text-white rounded-full font-bold hover:bg-green-500 flex items-center",children:[e.jsx(oe,{size:20,className:"mr-2"})," OK"]})]})]})]})},Ee=({product:x,onSave:y,onCancel:f,isReadOnly:r=!1})=>{const[t,j]=u.useState(x),[m,E]=u.useState([]),[C,A]=u.useState(!1),[d,i]=u.useState(!1),k=u.useRef(null),{state:N}=O(),a=(s,p)=>{r||j(T=>({...T,[s]:p}))},n=(s,p,T)=>{r||j(M=>({...M,[s]:{...M[s]||{},[p]:T}}))},h=s=>{var p;r||(a("room",s),/sdb|salle\s?de\s?bain|toilette|wc|douche/i.test(s.toLowerCase())&&["FENETRE","BAIE_COULISSANTE"].includes(t.type)&&!((p=t.vitrageFlags)!=null&&p.g200)&&(j(T=>({...T,vitrageFlags:{...T.vitrageFlags,standard:!0,g200:!0}})),i(!0),setTimeout(()=>i(!1),3e3)))};u.useEffect(()=>{t.type==="FENETRE"&&t.hauteurMm>2200&&j(s=>({...s,oscilloBattant:!1}))},[t.hauteurMm]);const F=()=>{if(r)return;const s=_.validateProduct(t);if(!s.isValid){E(s.errors),setTimeout(()=>{const p=document.getElementById(`field-${s.errors[0]}`);p&&p.scrollIntoView({behavior:"smooth",block:"center"})},100);return}y({...t,isValid:!0,validationErrors:[]})},v=async s=>{if(!r&&s.target.files&&s.target.files[0]){const p=await je(s.target.files[0]);a("photos",[...t.photos||[],p])}},b=s=>m.includes(s),S=r?"opacity-60 cursor-not-allowed bg-slate-100 dark:bg-slate-800":"";return e.jsxs("div",{className:"fixed inset-0 bg-slate-50 dark:bg-slate-950 z-50 flex flex-col h-full animate-fade-in",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 px-4 pb-3 pt-3 safe-top-padding flex justify-between items-center shadow-sm shrink-0",children:[e.jsx("button",{onClick:f,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800",children:e.jsx(G,{size:24,className:"text-slate-500"})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"font-bold dark:text-white",children:["Produit #",String(t.index).padStart(2,"0")]}),r&&e.jsxs("span",{className:"text-xs text-green-600 font-medium flex items-center justify-center gap-1",children:[e.jsx(R,{size:12})," Consultation"]})]}),r?e.jsx("div",{className:"w-[76px]"}):e.jsx(z,{onClick:F,className:"px-5 py-2 rounded-full",icon:ne,children:"Valider"})]}),r&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border-b border-green-200 dark:border-green-800 px-4 py-2 text-center",children:e.jsxs("span",{className:"text-sm text-green-700 dark:text-green-300 font-medium flex items-center justify-center gap-2",children:[e.jsx(R,{size:14})," Dossier verrouillé — consultation seule"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-20 max-w-3xl mx-auto w-full",children:[m.length>0&&e.jsxs("div",{className:"mb-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900/50 text-red-700 dark:text-red-300 p-3 rounded-lg flex items-center",children:[e.jsx(se,{size:20,className:"mr-2"}),e.jsx("span",{children:"Champs manquants"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-xl p-5 shadow-sm border border-slate-200 dark:border-slate-800 ${S}`,children:[e.jsx(D,{label:"Type",value:t.type,onChange:s=>a("type",s),disabled:r,options:[{label:"Fenêtre",value:"FENETRE"},{label:"Porte-fenêtre",value:"PORTE_FENETRE"},{label:"Coulissant",value:"BAIE_COULISSANTE"},{label:"Porte Entrée",value:"PORTE_ENTREE"},{label:"Porte Service",value:"PORTE_SERVICE"},{label:"Volet",value:"VOLET_ROULANT"},{label:"Autre",value:"AUTRE"}]}),e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 dark:bg-slate-800 p-3 rounded-lg mb-4 border border-slate-100 dark:border-slate-700",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:"Quantité"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:`w-8 h-8 rounded-full bg-white dark:bg-slate-700 shadow text-brand-600 font-bold ${r?"opacity-50 cursor-not-allowed":""}`,onClick:()=>a("quantity",Math.max(1,(t.quantity||1)-1)),disabled:r,children:"-"}),e.jsx("span",{className:"font-bold text-xl w-6 text-center dark:text-white",children:t.quantity||1}),e.jsx("button",{className:`w-8 h-8 rounded-full bg-white dark:bg-slate-700 shadow text-brand-600 font-bold ${r?"opacity-50 cursor-not-allowed":""}`,onClick:()=>a("quantity",(t.quantity||1)+1),disabled:r,children:"+"})]})]}),e.jsx(P,{label:"Localisation",value:t.room,onChange:h,placeholder:"Ex: Cuisine",disabled:r}),t.type==="AUTRE"&&e.jsx(P,{id:"field-description",label:"Description",value:t.description,onChange:s=>a("description",s),error:b("description"),disabled:r}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(P,{id:"field-largeurMm",label:"Largeur (mm)",type:"number",inputMode:"numeric",pattern:"[0-9]*",value:t.largeurMm,onChange:s=>a("largeurMm",parseInt(s)),error:b("largeurMm"),disabled:r}),e.jsx(P,{id:"field-hauteurMm",label:"Hauteur (mm)",type:"number",inputMode:"numeric",pattern:"[0-9]*",value:t.hauteurMm,onChange:s=>a("hauteurMm",parseInt(s)),error:b("hauteurMm"),disabled:r})]}),(_.isMeasureSuspicious(t.largeurMm,t.monobloc)||_.isMeasureSuspicious(t.hauteurMm,t.monobloc))&&e.jsxs("div",{className:"text-orange-500 text-xs flex items-center mt-[-10px] mb-4",children:[e.jsx(V,{size:12,className:"mr-1"})," Attention: Cotes <300mm"]})]}),["FENETRE","PORTE_FENETRE","BAIE_COULISSANTE","PORTE_ENTREE","PORTE_SERVICE"].includes(t.type)&&e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-xl p-5 shadow-sm border border-slate-200 dark:border-slate-800 ${S}`,children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-4 tracking-wider",children:"Caractéristiques"}),e.jsx(D,{id:"field-matiere",label:"Matière",value:t.matiere,onChange:s=>a("matiere",s),error:b("matiere"),disabled:r,options:[{label:"PVC",value:"PVC"},{label:"Alu",value:"ALU"}]}),t.matiere&&e.jsx(D,{id:"field-profil",label:"Profil",value:t.profil,onChange:s=>a("profil",s),error:b("profil"),disabled:r,options:t.matiere==="PVC"?[{label:"Réno 40",value:"RENO_40"},{label:"Réno 60",value:"RENO_60"},{label:"Neuf",value:"NEUF"},{label:"ISO",value:"ISO"},{label:"Autre",value:"AUTRE"}]:[{label:"Réno",value:"RENO"},{label:"Neuf",value:"NEUF"},{label:"Autre",value:"AUTRE"}]}),t.profil==="ISO"&&e.jsx(P,{id:"field-isoMm",label:"Aile ISO (mm)",type:"number",inputMode:"numeric",pattern:"[0-9]*",value:t.isoMm,onChange:s=>a("isoMm",parseInt(s)),error:b("isoMm"),disabled:r}),t.profil==="AUTRE"&&e.jsx(P,{id:"field-profilAutre",label:"Profil personnalisé",placeholder:"Préciser le profil...",value:t.profilAutre,onChange:s=>a("profilAutre",s),error:b("profilAutre"),disabled:r}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsx(D,{id:"field-couleur",label:"Couleur",value:t.couleur,onChange:s=>a("couleur",s),error:b("couleur"),disabled:r,options:t.matiere==="PVC"?[{label:"Blanc",value:"BLANC"},{label:"Bicolor 7016",value:"BICOLOR_7016"},{label:"Autre",value:"AUTRE"}]:[{label:"Blanc",value:"BLANC"},{label:"Gris 7016",value:"GRIS_7016"},{label:"Autre",value:"AUTRE"}]}),t.couleur==="AUTRE"&&e.jsx(P,{id:"field-couleurAutre",placeholder:"Préciser...",value:t.couleurAutre,onChange:s=>a("couleurAutre",s),error:b("couleurAutre"),disabled:r})]})]}),(t.type==="FENETRE"||t.type==="PORTE_FENETRE"||t.type==="BAIE_COULISSANTE")&&e.jsxs("div",{id:"field-vitrageFlags",className:`bg-white dark:bg-slate-900 rounded-xl p-5 shadow-sm border ${b("vitrageFlags")?"border-red-500 ring-1 ring-red-500":"border-slate-200 dark:border-slate-800"} ${S}`,children:[e.jsxs("h3",{className:`text-xs font-bold uppercase mb-3 tracking-wider ${b("vitrageFlags")?"text-red-500":"text-slate-400"}`,children:["Vitrage ",b("vitrageFlags")&&"*"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[["standard","4/20/4"],["g200","G200"],["feuillete1f","Feuilleté 1F"],["feuillete2f","Feuilleté 2F"]].map(([s,p])=>{var T,M;return e.jsxs("label",{className:`flex items-center p-3 rounded-lg border transition-all ${r?"cursor-not-allowed":"cursor-pointer"} ${(T=t.vitrageFlags)!=null&&T[s]?"bg-brand-50 border-brand-500 text-brand-700 dark:bg-brand-900/30":"border-slate-200 dark:border-slate-700 dark:text-white"}`,children:[e.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded text-brand-600 focus:ring-brand-500",checked:!!((M=t.vitrageFlags)!=null&&M[s]),onChange:U=>n("vitrageFlags",s,U.target.checked),disabled:r}),e.jsx("span",{className:"ml-2 text-sm font-medium",children:p})]},s)})})]}),t.type==="FENETRE"&&e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-xl p-5 shadow-sm border border-slate-200 dark:border-slate-800 space-y-4 ${S}`,children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider",children:"Options"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:`flex-1 flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-100 dark:border-slate-700 ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white font-medium text-sm",children:"Oscillo-Battant"}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.oscilloBattant,onChange:s=>a("oscilloBattant",s.target.checked),disabled:r||t.hauteurMm>2200})]}),e.jsxs("label",{className:`flex-1 flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-100 dark:border-slate-700 ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white font-medium text-sm",children:"Grille Ventil."}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.grilleVentilation,onChange:s=>a("grilleVentilation",s.target.checked),disabled:r})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"text-sm dark:text-slate-300 font-medium mb-2 block",children:"Hauteur Poignée"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a("poigneeHauteur","CENTREE"),disabled:r,className:`flex-1 py-2 px-3 rounded-lg border text-sm font-medium ${r?"opacity-50 cursor-not-allowed":""} ${t.poigneeHauteur!=="AUTRE"?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border-slate-200 dark:border-slate-700"}`,children:"Centrée"}),e.jsx("button",{onClick:()=>a("poigneeHauteur","AUTRE"),disabled:r,className:`flex-1 py-2 px-3 rounded-lg border text-sm font-medium ${r?"opacity-50 cursor-not-allowed":""} ${t.poigneeHauteur==="AUTRE"?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border-slate-200 dark:border-slate-700"}`,children:"Autre"})]}),t.poigneeHauteur==="AUTRE"&&e.jsx("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",className:`mt-2 w-full p-3 border rounded-lg dark:bg-slate-900 dark:text-white dark:border-slate-700 ${r?"opacity-50 cursor-not-allowed":""}`,placeholder:"mm",value:t.poigneeHauteurMm||"",onChange:s=>a("poigneeHauteurMm",parseInt(s.target.value)),disabled:r})]})]}),t.type==="PORTE_FENETRE"&&e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-xl p-5 shadow-sm border border-slate-200 dark:border-slate-800 space-y-4 ${S}`,children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider",children:"Options Porte-fenêtre"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:`flex-1 flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-100 dark:border-slate-700 ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white font-medium text-sm",children:"Grille Ventil."}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.grilleVentilation,onChange:s=>a("grilleVentilation",s.target.checked),disabled:r})]}),e.jsxs("label",{className:`flex-1 flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-100 dark:border-slate-700 ${r?"cursor-not-allowed":""}`,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"dark:text-white font-medium text-sm",children:"Serrure"}),t.matiere==="PVC"&&e.jsx("span",{className:"text-xs text-slate-400",children:"(gros profil)"})]}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.serrure,onChange:s=>a("serrure",s.target.checked),disabled:r})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:`flex-1 flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-100 dark:border-slate-700 ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white font-medium text-sm",children:"Seuil PMR"}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.seuilPMR,onChange:s=>a("seuilPMR",s.target.checked),disabled:r})]}),e.jsxs("label",{className:`flex-1 flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-100 dark:border-slate-700 ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white font-medium text-sm",children:"Soubassement"}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.soubassement,onChange:s=>a("soubassement",s.target.checked),disabled:r})]})]}),t.soubassement&&e.jsx(P,{id:"field-soubassementHauteurMm",label:"Hauteur Soubassement (mm)",type:"number",inputMode:"numeric",pattern:"[0-9]*",value:t.soubassementHauteurMm,onChange:s=>a("soubassementHauteurMm",parseInt(s)),placeholder:"Ex: 400",disabled:r}),e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"text-sm dark:text-slate-300 font-medium mb-2 block",children:"Hauteur Poignée"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a("poigneeHauteur","CENTREE"),disabled:r,className:`flex-1 py-2 px-3 rounded-lg border text-sm font-medium ${r?"opacity-50 cursor-not-allowed":""} ${t.poigneeHauteur!=="AUTRE"?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border-slate-200 dark:border-slate-700"}`,children:"Centrée"}),e.jsx("button",{onClick:()=>a("poigneeHauteur","AUTRE"),disabled:r,className:`flex-1 py-2 px-3 rounded-lg border text-sm font-medium ${r?"opacity-50 cursor-not-allowed":""} ${t.poigneeHauteur==="AUTRE"?"bg-brand-600 text-white border-brand-600":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border-slate-200 dark:border-slate-700"}`,children:"Autre"})]}),t.poigneeHauteur==="AUTRE"&&e.jsx("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",className:`mt-2 w-full p-3 border rounded-lg dark:bg-slate-900 dark:text-white dark:border-slate-700 ${r?"opacity-50 cursor-not-allowed":""}`,placeholder:"mm",value:t.poigneeHauteurMm||"",onChange:s=>a("poigneeHauteurMm",parseInt(s.target.value)),disabled:r})]})]}),t.type==="VOLET_ROULANT"&&e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-xl p-5 shadow-sm border border-slate-200 dark:border-slate-800 ${S}`,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-700 dark:text-slate-300",children:"Lier à "}),e.jsxs("select",{className:`w-full p-3 rounded-lg bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 dark:text-white ${r?"opacity-50 cursor-not-allowed":""}`,value:t.lieAProduitId||"",onChange:s=>a("lieAProduitId",s.target.value),disabled:r,children:[e.jsx("option",{value:"",children:"-- Indépendant --"}),N.products.filter(s=>["FENETRE","BAIE_COULISSANTE"].includes(s.type)).map(s=>e.jsxs("option",{value:s.id,children:["#",s.index," ",s.type]},s.id))]})]}),e.jsx(D,{id:"field-manoeuvre",label:"Manoeuvre",value:t.manoeuvre,onChange:s=>a("manoeuvre",s),error:b("manoeuvre"),disabled:r,options:[{label:"Filaire",value:"FILAIRE"},{label:"Radio",value:"RADIO"},{label:"Solaire",value:"SOLAIRE"}]}),t.manoeuvre&&t.manoeuvre!=="SOLAIRE"&&e.jsx(D,{id:"field-sortieCable",label:"Sortie Câble",value:t.sortieCable,onChange:s=>a("sortieCable",s),error:b("sortieCable"),disabled:r,options:[{label:"Gauche",value:"GAUCHE"},{label:"Droite",value:"DROITE"}]}),t.manoeuvre!=="FILAIRE"&&e.jsxs("label",{className:`flex items-center p-3 border rounded-lg bg-slate-50 dark:bg-slate-800 dark:border-slate-700 mt-4 mb-4 ${r?"cursor-not-allowed":""}`,children:[e.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-brand-600",checked:!!t.boxDomotique,onChange:s=>a("boxDomotique",s.target.checked),disabled:r}),e.jsx("span",{className:"ml-3 font-medium dark:text-white",children:"Box Domotique"})]}),e.jsxs("div",{className:"my-4",id:"field-coffreADeduireMm",children:[e.jsxs("label",{className:`flex items-center justify-between p-3 border rounded-lg bg-slate-50 dark:bg-slate-800 dark:border-slate-700 ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"font-medium dark:text-white",children:"Monobloc ?"}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.monobloc,onChange:s=>a("monobloc",s.target.checked),disabled:r})]}),t.monobloc&&e.jsxs("div",{className:"mt-3 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:[e.jsx(P,{label:"Hauteur Coffre",type:"number",inputMode:"numeric",pattern:"[0-9]*",value:t.coffreADeduireMm,onChange:s=>a("coffreADeduireMm",parseInt(s)),error:b("coffreADeduireMm"),disabled:r}),e.jsxs("div",{className:"text-right text-sm font-bold text-brand-600",children:["Passage: ",t.hauteurMm&&t.coffreADeduireMm?t.hauteurMm-t.coffreADeduireMm:"-"," mm"]})]})]})]}),_.hasAdvancedOptions(t.type)&&e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden ${S}`,children:[e.jsxs("button",{onClick:()=>A(!C),className:"w-full flex justify-between items-center p-4 bg-slate-50 dark:bg-slate-800/50 font-medium text-slate-700 dark:text-slate-300",children:[e.jsx("span",{children:"Options Avancées"}),C?e.jsx(de,{size:18}):e.jsx(ie,{size:18})]}),C&&e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 space-y-4",children:[(t.type.includes("FENETRE")||t.type.includes("PORTE"))&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:`flex items-center justify-between ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white",children:"Ouverture Extérieure"}),e.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-brand-600",checked:!!t.ouvertureExterieure,onChange:s=>a("ouvertureExterieure",s.target.checked),disabled:r})]}),t.type==="FENETRE"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:`flex items-center justify-between ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white",children:"Poignée à  clé"}),e.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-brand-600",checked:!!t.poigneeCle,onChange:s=>a("poigneeCle",s.target.checked),disabled:r})]}),e.jsxs("label",{className:`flex items-center justify-between ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white",children:"Pièce d'appui"}),e.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-brand-600",checked:!!t.pieceAppui,onChange:s=>a("pieceAppui",s.target.checked),disabled:r})]}),t.pieceAppui&&e.jsx(P,{id:"field-pieceAppuiDescription",label:"Description Pièce d'appui",value:t.pieceAppuiDescription,onChange:s=>a("pieceAppuiDescription",s),placeholder:"Préciser...",disabled:r})]}),t.type==="PORTE_FENETRE"&&e.jsxs("label",{className:`flex items-center justify-between ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white",children:"Poignée à  clé"}),e.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-brand-600",checked:!!t.poigneeCle,onChange:s=>a("poigneeCle",s.target.checked),disabled:r})]}),t.type==="PORTE_ENTREE"&&e.jsxs("label",{className:`flex items-center justify-between ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white font-bold",children:"Tierce / Imposte ?"}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.tierceImposte,onChange:s=>a("tierceImposte",s.target.checked),disabled:r})]})]}),t.type==="VOLET_ROULANT"&&e.jsxs("div",{children:[e.jsx(D,{label:"Couple",value:t.coupleMoteur||10,onChange:s=>a("coupleMoteur",s),disabled:r,options:[{label:"10 Nm",value:10},{label:"20 Nm",value:20}]}),e.jsx(D,{label:"Pose",value:t.pose||"RENO",onChange:s=>a("pose",s),disabled:r,options:[{label:"Rénov",value:"RENO"},{label:"Tradi",value:"TRADI"},{label:"Tunnel",value:"TUNNEL"}]})]})]})]}),t.type==="PORTE_ENTREE"&&e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-5 rounded-xl border dark:border-slate-800 ${S}`,children:[e.jsx(D,{id:"field-remplissage",label:"Remplissage",value:t.remplissage,onChange:s=>a("remplissage",s),error:b("remplissage"),disabled:r,options:[{label:"Panneau Déco Alu",value:"PANNEAU_DECORATIF_ALU"},{label:"Sandwich",value:"PANNEAU_SANDWICH"},{label:"Vitrée",value:"VITREE"}]}),t.largeurMm>1e3&&e.jsxs("div",{className:"mt-3 pt-3 border-t dark:border-slate-700",children:[e.jsxs("label",{className:`flex items-center justify-between mb-3 ${r?"cursor-not-allowed":""}`,children:[e.jsx("span",{className:"dark:text-white font-medium",children:"Tierce ?"}),e.jsx("input",{type:"checkbox",className:"w-6 h-6 accent-brand-600",checked:!!t.tierce,onChange:s=>a("tierce",s.target.checked),disabled:r})]}),t.tierce&&e.jsx(P,{id:"field-cotePassageMm",label:"Cote Passage (mm)",type:"number",inputMode:"numeric",pattern:"[0-9]*",value:t.cotePassageMm,onChange:s=>a("cotePassageMm",s),error:b("cotePassageMm"),disabled:r})]})]}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 rounded-xl p-5 shadow-sm border border-slate-200 dark:border-slate-800 ${S}`,children:[e.jsx(we,{data:t.dessin,onChange:s=>a("dessin",s),disabled:r}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-3 text-slate-700 dark:text-slate-300",children:"Photos"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[(t.photos||[]).map((s,p)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700 group",children:[e.jsx("img",{src:s,className:"w-full h-full object-cover"}),!r&&e.jsx("button",{onClick:()=>a("photos",t.photos.filter((T,M)=>M!==p)),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow-md opacity-80 hover:opacity-100",children:e.jsx(G,{size:12})})]},p)),!r&&e.jsxs("button",{onClick:()=>{var s;return(s=k.current)==null?void 0:s.click()},className:"aspect-square rounded-lg border-2 border-dashed border-slate-300 dark:border-slate-600 flex flex-col items-center justify-center text-slate-400 hover:text-brand-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx(ce,{size:24}),e.jsx("span",{className:"text-[10px] mt-1",children:"Ajouter"})]}),e.jsx("input",{type:"file",ref:k,accept:"image/*",className:"hidden",onChange:v,disabled:r})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Notes techniques"}),e.jsx("textarea",{className:`w-full p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-950 dark:text-white h-24 text-sm focus:border-brand-500 outline-none ${r?"opacity-50 cursor-not-allowed":""}`,placeholder:"Contraintes...",value:t.notes||"",onChange:s=>a("notes",s.target.value),disabled:r})]})]})]})]}),d&&e.jsxs("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-4 py-3 rounded-lg shadow-xl flex items-center animate-slide-up",children:[e.jsx(ue,{size:20,className:"text-blue-400 mr-2"})," Vitrage G200 activé (Intimité)"]})]})};async function Ce(x,y,f,r){var A;const t=(A=window.SARANGE_CONFIG)==null?void 0:A.APPS_SCRIPT_URL,j=15e3;if(!t)return q.warn("URL Google Apps Script non configurée"),{success:!1,error:"Configuration manquante"};const m={timestamp:new Date().toISOString(),metrage_id:W(),htmlReport:f,chantier:{client:x.client,adresse:x.adresse,telephone:x.telephone||"",email:x.email||"",typeContrat:x.typeContrat},clientFinal:x.typeContrat==="SOUS_TRAITANCE"?{nom:x.clientFinal,adresse:x.adresseFinale}:null,produits:y.map(d=>({numero:d.index,type:d.type,quantite:d.quantity||1,localisation:d.room||"",dimensions:`${d.largeurMm} x ${d.hauteurMm} mm`,matiere:d.matiere||"",profil:d.profil||"",couleur:d.couleur==="AUTRE"?d.couleurAutre:d.couleur||"",vitrage:d.vitrageFlags?Object.entries(d.vitrageFlags).filter(([i,k])=>k).map(([i])=>i==="standard"?"4/20/4":i==="g200"?"G200":i==="feuillete1f"?"Feuilleté 1F":i==="feuillete2f"?"Feuilleté 2F":"").filter(Boolean).join(", "):"",options:Ne(d),notes:d.notes||"",isValid:d.isValid})),total_produits:y.reduce((d,i)=>d+(i.quantity||1),0),produits_incomplets:y.filter(d=>!d.isValid).length},E=new AbortController,C=setTimeout(()=>E.abort(),j);try{r==null||r({sendStatus:"SENDING",lastError:null});const d=await fetch(t,{method:"POST",mode:"cors",headers:{"Content-Type":"text/plain"},body:JSON.stringify(m),signal:E.signal});if(clearTimeout(C),!d.ok)throw new Error(`Erreur HTTP: ${d.status}`);const i=await d.json();if(i.success===!0){const k=new Date().toISOString();return r==null||r({sendStatus:"SENT",sentAt:k,lastError:null,dateFinalisation:k}),q.info("✅ Métrage envoyé avec succès",{metrage_id:m.metrage_id,client:x.client}),{success:!0}}else throw new Error(i.error||"Réponse serveur invalide")}catch(d){clearTimeout(C);let i;return d.name==="AbortError"?i="Connexion trop lente (délai 15s dépassé)":d.message.includes("Failed to fetch")||d.message.includes("NetworkError")?i="Pas de connexion réseau":i=d.message,r==null||r({sendStatus:"ERROR",lastError:i}),q.error("â Œ Échec envoi métrage",{error:i,client:x.client}),{success:!1,error:i}}}const Te=({chantier:x,products:y,incompleteCount:f,onClose:r,onStatusChange:t,onSuccess:j,onError:m})=>{const[E,C]=u.useState({cotes:!1,options:!1}),[A,d]=u.useState(!1),[i,k]=u.useState(!1),N=E.cotes&&E.options,a=async()=>{d(!0);const n=ke(x,y,new Date().toISOString()),h=await Ce(x,y,n,t);h.success?(d(!1),k(!0),setTimeout(()=>{j==null||j()},1500)):(d(!1),m==null||m(h.error))};return e.jsx(te,{isOpen:!0,onClose:A||i?void 0:r,title:i?"✓ Envoyé !":"Êtes-vous sûr ?",size:"md",children:e.jsxs("div",{className:"relative min-h-[360px] flex flex-col",children:[i&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center animate-fade-in z-10",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-green-100 dark:bg-green-900/30 rounded-full scale-150 animate-pulse"}),e.jsx("div",{className:"bg-green-500 text-white rounded-full p-6 shadow-xl shadow-green-500/40 relative z-10 animate-bounce",children:e.jsx(ge,{size:48,strokeWidth:3})})]}),e.jsx("h3",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-2",children:"Dossier Envoyé !"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center text-sm",children:"Le métrage a été transmis au bureau"})]}),!i&&e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx(Y,{checked:E.cotes,onChange:n=>C(h=>({...h,cotes:n})),label:"J'ai vérifié toutes les cotes"}),e.jsx(Y,{checked:E.options,onChange:n=>C(h=>({...h,options:n})),label:"J'ai vérifié les options"})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4 mb-4 flex items-start gap-3",children:[e.jsx("div",{className:"bg-red-100 dark:bg-red-900/50 p-2 rounded-lg shrink-0",children:e.jsx(V,{className:"text-red-600 dark:text-red-400",size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-red-700 dark:text-red-300 text-sm",children:"Action irréversible"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1 leading-relaxed",children:"Le dossier sera verrouillé après envoi."})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-xl p-4 mb-6 border border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Total Produits"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white bg-white dark:bg-slate-700 px-2 py-0.5 rounded border border-slate-200 dark:border-slate-600",children:y.reduce((n,h)=>n+(h.quantity||1),0)})]}),f>0&&e.jsxs("div",{className:"flex justify-between text-sm mt-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("span",{className:"text-amber-600 dark:text-amber-400 flex items-center gap-2",children:[e.jsx(V,{size:16})," Incomplets"]}),e.jsx("span",{className:"font-bold text-white bg-amber-500 px-2 py-0.5 rounded text-xs",children:f})]})]}),e.jsxs("div",{className:"mt-auto space-y-3",children:[e.jsx(z,{onClick:a,disabled:!N||A,className:`w-full py-4 text-base transition-all duration-300 ${N?"translate-y-0 opacity-100":"opacity-80"}`,icon:A?null:re,children:A?e.jsxs("span",{className:"flex items-center justify-center gap-3",children:[e.jsx(ee,{size:20}),e.jsx("span",{children:"Transmission en cours..."})]}):"Confirmer l'envoi"}),e.jsx(z,{onClick:r,variant:"ghost",className:"w-full py-3",disabled:A,children:"Annuler"})]})]})]})})},Ae=({onClose:x,onUnlock:y})=>{const[f,r]=u.useState(""),t=f.toUpperCase()==="MODIFIER";return e.jsxs(te,{isOpen:!0,onClose:x,title:"Déverrouiller le dossier",size:"sm",children:[e.jsxs("p",{className:"text-slate-600 dark:text-slate-400 mb-4 text-sm",children:["Pour modifier un dossier déjà  envoyé, saisissez ",e.jsx("strong",{className:"text-slate-800 dark:text-white",children:"MODIFIER"})," ci-dessous."]}),e.jsx(P,{value:f,onChange:r,placeholder:"Tapez MODIFIER",className:"mb-6"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(z,{onClick:y,disabled:!t,variant:t?"danger":"secondary",className:"w-full py-4",icon:fe,children:"Déverrouiller"}),e.jsx(z,{onClick:x,variant:"ghost",className:"w-full",children:"Annuler"})]})]})},Pe=()=>{const{state:x,selectChantier:y,deleteProduct:f,saveProduct:r,updateChantier:t}=O(),[j,m]=u.useState(null),[E,C]=u.useState(!1),[A,d]=u.useState(!1),[i,k]=u.useState(!1),[N,a]=u.useState(null),n=x.chantiers.find(l=>l.id===x.currentChantierId),h=x.products.filter(l=>l.chantierId===(n==null?void 0:n.id)).sort((l,c)=>l.index-c.index),F=(n==null?void 0:n.sendStatus)||"DRAFT",v=F==="SENT",b=F==="SENDING",S=F==="ERROR",s=()=>{if(v)return;const l=h[h.length-1],c=l?{matiere:l.matiere,profil:l.profil,couleur:l.couleur,couleurAutre:l.couleurAutre,isoMm:l.isoMm}:{};m({id:W(),chantierId:n.id,index:h.length+1,type:"FENETRE",quantity:1,dateCreation:new Date().toISOString(),photos:[],isValid:!1,validationErrors:[],...c})},p=(l,c)=>{l.stopPropagation(),!v&&r({...c,id:W(),index:h.length+1,dateCreation:new Date().toISOString()})},T=l=>t(n.id,l),M=()=>{C(!1)},U=l=>{C(!1),a({message:`Échec : ${l}`,type:"error"})},o=()=>{t(n.id,{sendStatus:"DRAFT",sentAt:null,lastError:null}),d(!1),a({message:"Dossier déverrouillé",type:"info"})};if(!n)return null;if(j)return e.jsx(Ee,{product:j,onSave:l=>{r(l),m(null)},onCancel:()=>m(null),isReadOnly:v});const g=h.reduce((l,c)=>l+(c.quantity||1),0),I=h.filter(l=>!l.isValid).length;return e.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 dark:bg-slate-950",children:[e.jsx("div",{className:"bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 px-4 pb-3 pt-3 safe-top-padding flex items-center justify-between sticky top-0 z-10 shadow-sm",children:e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>y(null),className:"mr-3 p-2 -ml-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-500 dark:text-slate-200",children:e.jsx(xe,{size:24})}),e.jsxs("div",{className:"truncate flex-1 cursor-pointer",onClick:()=>!v&&k(!0),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-bold text-lg dark:text-white truncate",children:n.client}),v?e.jsx(R,{size:16,className:"text-green-600"}):e.jsx(be,{size:16,className:"text-slate-400"})]}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2",children:[e.jsxs("span",{className:"bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded",children:[g," Produit(s)"]}),e.jsxs("span",{children:["• ",n.typeContrat==="FOURNITURE_ET_POSE"?"Pose":n.typeContrat==="SOUS_TRAITANCE"?"Sous-traitance":"Fourn. Seule"]})]})]})]})}),v&&e.jsxs(X,{variant:"success",icon:R,action:"Modifier",onAction:()=>d(!0),children:["Dossier verrouillé le ",new Date(n.sentAt).toLocaleDateString("fr-FR")," à  ",new Date(n.sentAt).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]}),S&&e.jsxs(X,{variant:"error",icon:se,children:["Échec de l'envoi : ",n.lastError]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 max-w-5xl mx-auto w-full pb-32",children:[n.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3 mb-4 flex items-start",children:[e.jsx(me,{className:"text-amber-600 mt-1 mr-3 shrink-0",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-amber-800 dark:text-amber-200 uppercase",children:"Client Final"}),e.jsx("div",{className:"font-medium text-amber-900 dark:text-amber-100",children:n.clientFinal}),e.jsxs("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(n.adresseFinale)}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-amber-800 dark:text-amber-300 hover:underline flex items-center",children:[e.jsx(MapPin,{size:12,className:"mr-1"}),n.adresseFinale]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[h.map(l=>e.jsxs("div",{onClick:()=>m(l),className:`bg-white dark:bg-slate-900 rounded-xl p-4 shadow-sm border-l-[6px] cursor-pointer hover:shadow-md transition-all relative group ${l.type.includes("FENETRE")?"border-l-orange-500":l.type.includes("PORTE")?"border-l-green-500":"border-l-orange-500"} border-t border-r border-b border-slate-200 dark:border-slate-800 ${v?"opacity-75":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("span",{className:"font-bold text-lg dark:text-white",children:["#",String(l.index).padStart(2,"0")]}),l.quantity>1&&e.jsxs("span",{className:"bg-brand-100 text-brand-700 dark:bg-brand-900 dark:text-brand-300 text-xs font-bold px-2 py-1 rounded-full",children:["x",l.quantity]})]}),e.jsx("div",{className:"text-slate-800 dark:text-slate-200 font-medium mb-1",children:l.type}),e.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:[l.largeurMm," x ",l.hauteurMm," mm ",l.room&&`• ${l.room}`]}),!l.isValid&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-300 px-2 py-1 rounded text-xs inline-flex items-center mb-2",children:[e.jsx(V,{size:12,className:"mr-1"})," Incomplet"]}),!v&&e.jsxs("div",{className:"flex justify-end gap-3 mt-2 pt-3 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("button",{onClick:c=>p(c,l),className:"text-slate-400 hover:text-brand-600 p-1",children:e.jsx(he,{size:18})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),confirm("Supprimer ?")&&f(l.id)},className:"text-slate-400 hover:text-red-600 p-1",children:e.jsx(B,{size:18})})]})]},l.id)),!v&&e.jsxs("button",{onClick:s,className:"min-h-[160px] border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl flex flex-col items-center justify-center text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-900 hover:border-brand-400 transition-colors",children:[e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800 p-4 rounded-full mb-2",children:e.jsx(pe,{size:24})}),e.jsx("span",{className:"font-medium",children:"Ajouter"})]})]})]}),!v&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 p-4 safe-pb z-40 shadow-lg",children:e.jsx(z,{onClick:()=>C(!0),disabled:b,className:"w-full py-4 text-base font-bold",icon:b?null:re,children:b?e.jsxs("span",{className:"flex items-center justify-center gap-3",children:[e.jsx(ee,{size:20}),"Transmission en cours..."]}):"ENVOYER AU BUREAU"})}),v&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-green-50 dark:bg-green-900/20 border-t border-green-200 dark:border-green-800 p-4 safe-pb z-40",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700 dark:text-green-300",children:[e.jsx(R,{size:16}),e.jsxs("span",{className:"text-sm font-medium",children:["Dossier verrouillé le ",new Date(n.sentAt).toLocaleDateString("fr-FR")]})]})}),E&&e.jsx(Te,{chantier:n,products:h,incompleteCount:I,onClose:()=>C(!1),onStatusChange:T,onSuccess:M,onError:U}),A&&e.jsx(Ae,{onClose:()=>d(!1),onUnlock:o}),i&&e.jsx(ve,{chantier:n,onClose:()=>k(!1),onUpdate:l=>t(n.id,l)}),N&&e.jsx(ae,{message:N.message,type:N.type,onClose:()=>a(null)})]})};export{Pe as ChantierDetailView};
