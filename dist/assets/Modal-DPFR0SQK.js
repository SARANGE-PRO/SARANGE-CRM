import{R as n,r as b,N as g,X as y,L as E,E as S}from"./vendor-zB6w3uSG.js";import{j as e,c as $}from"./index-DoWnPC-X.js";const w=(...a)=>a.filter(Boolean).join(" "),I=({label:a,value:r,onChange:c,placeholder:d,type:m="text",error:l,inputMode:i,pattern:s,id:u,className:v="",disabled:h=!1,min:k,step:x})=>n.createElement("div",{className:w("mb-4",v),id:u},a?n.createElement("label",{className:w("block text-sm font-medium mb-1.5",l?"text-red-600":"text-slate-700 dark:text-slate-300")},`${a}${l?" *":""}`):null,n.createElement("input",{type:m,value:r||"",onChange:t=>c&&c(t.target.value),placeholder:d,inputMode:i,pattern:s,disabled:h,min:k,step:x,className:w("w-full p-3 rounded-xl bg-white dark:bg-slate-900 border outline-none transition-all dark:text-white focus:ring-4",l?"border-red-500 focus:ring-red-200 focus:border-red-500":"border-slate-200 dark:border-slate-700 focus:border-brand-500 focus:ring-brand-200",h&&"opacity-50 cursor-not-allowed")}),l?n.createElement("span",{className:"text-xs text-red-500 mt-1 block"},"Requis"):null),j=(...a)=>a.filter(Boolean).join(" "),q=({options:a,value:r,onChange:c,label:d,error:m,id:l,className:i="",disabled:s=!1})=>n.createElement("div",{className:j("mb-4",i),id:l},d?n.createElement("label",{className:"block text-sm font-medium mb-2 text-slate-700 dark:text-slate-300"},d):null,n.createElement("div",{className:j("flex flex-wrap gap-1 bg-slate-100 dark:bg-slate-800 p-1 rounded-xl transition-all",m&&"field-error-ring animate-shake bg-red-50 dark:bg-red-950/20")},a.map(u=>n.createElement("button",{key:u.value,type:"button",onClick:()=>{s||c(u.value)},disabled:s,className:j("flex-1 flex-grow py-2 px-3 text-sm font-medium rounded-lg transition-all",r===u.value?"bg-white dark:bg-slate-700 text-brand-600 shadow-sm":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",s&&"opacity-50 cursor-not-allowed")},u.label))),m?n.createElement("span",{className:"text-xs text-red-500 mt-1 block"},"Requis"):null),C=({value:a,onChange:r})=>{const[c,d]=b.useState(!1),[m,l]=b.useState([]),[i,s]=b.useState(!1),u=b.useRef(null);b.useEffect(()=>{function t(o){u.current&&!u.current.contains(o.target)&&s(!1)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[u]);const v=async t=>{if(!(!t||t.length<3))try{const f=await(await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(t)}&limit=5`)).json();f&&f.features&&(l(f.features),s(!0))}catch(o){console.error("Erreur recherche adresse",o)}};b.useEffect(()=>{const t=typeof a=="object"?a.address:a,o=setTimeout(()=>{t&&i&&v(t)},500);return()=>clearTimeout(o)},[a,i]);const h=()=>{if(!navigator.geolocation)return alert("Géolocalisation non supportée");d(!0);const t={enableHighAccuracy:!0,timeout:1e4,maximumAge:0};navigator.geolocation.getCurrentPosition(async o=>{try{const p=await(await fetch(`https://api-adresse.data.gouv.fr/reverse/?lon=${o.coords.longitude}&lat=${o.coords.latitude}`)).json();if(p&&p.features&&p.features.length>0){const N={address:p.features[0].properties.label,gps:{lat:o.coords.latitude,lon:o.coords.longitude}};r(N),l(p.features),s(!0)}else alert("Adresse introuvable à cette position.")}catch(f){console.error(f),alert("Erreur réseau API Adresse")}finally{d(!1)}},o=>{d(!1),console.warn("Erreur GPS:",o),alert("Impossible de vous localiser précisément. Vérifiez que le GPS est activé.")},t)},k=t=>{const o={address:t.properties.label,gps:{lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]}};r(o),s(!1)},x=typeof a=="object"?a.address:a||"";return e.jsxs("div",{className:"mb-4 relative",ref:u,children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-200 mb-1",children:"Adresse du chantier"}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:x,onChange:t=>{r(t.target.value),s(!0)},onFocus:()=>x&&x.length>3&&s(!0),placeholder:"Saisir ou cliquer sur le pin...",className:"w-full p-3 pl-10 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all shadow-sm",autoComplete:"off"}),e.jsx(g,{size:18,className:"absolute left-3 top-3.5 text-slate-400"}),x&&e.jsx("button",{type:"button",onClick:()=>{r(""),l([])},className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600",children:e.jsx(y,{size:16})})]}),e.jsx("button",{type:"button",onClick:h,disabled:c,className:"shrink-0 w-12 flex items-center justify-center bg-brand-50 dark:bg-brand-900/20 text-brand-600 border border-brand-200 dark:border-brand-800 rounded-xl hover:bg-brand-100 transition-colors disabled:opacity-50 active:scale-95",children:c?e.jsx(E,{className:"animate-spin",size:20}):e.jsx(g,{size:20})})]}),i&&m.length>0&&e.jsx("ul",{className:"absolute z-[100] left-0 right-0 mt-1 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-fade-in divide-y divide-slate-100 dark:divide-slate-700",children:m.map((t,o)=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>k(t),className:"w-full text-left px-4 py-3 text-sm text-slate-700 dark:text-slate-200 hover:bg-brand-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[e.jsx(g,{size:14,className:"text-slate-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:t.properties.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:[t.properties.postcode," ",t.properties.city]})]})]})},o))}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-1 ml-1 flex justify-between",children:[e.jsx("span",{children:"Le bouton utilise le GPS haute précision."}),c&&e.jsx("span",{className:"text-brand-500 font-bold",children:"Localisation en cours..."})]})]})},L=({address:a,gps:r,className:c=""})=>{if(!a)return e.jsx("span",{className:"text-slate-400 italic text-xs",children:"Pas d'adresse"});const d=m=>{m.stopPropagation();const l=encodeURIComponent(a),i=r==null?void 0:r.lat,s=r==null?void 0:r.lon;/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?i&&s?window.location.href=`http://maps.apple.com/?ll=${i},${s}&q=${l}`:window.location.href=`http://maps.apple.com/?q=${l}`:i&&s?window.location.href=`geo:${i},${s}?q=${i},${s}(${l})`:window.location.href=`geo:0,0?q=${l}`};return e.jsxs("div",{className:`flex items-start group ${c}`,children:[e.jsx("button",{onClick:d,className:"p-1 -m-1 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-brand-600 transition-colors shrink-0",title:"Ouvrir dans le GPS",children:e.jsx(g,{size:14,className:"mt-0.5"})}),e.jsx("span",{className:"truncate ml-1",children:a}),e.jsx(S,{size:10,className:"ml-1 mt-1 text-slate-300 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]})},R=({isOpen:a,onClose:r,title:c,children:d,size:m="md"})=>{if(!a)return null;const l={sm:"max-w-md",md:"max-w-xl",lg:"max-w-3xl",full:"max-w-full m-4"};return n.createElement("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm animate-fade-in"},n.createElement("div",{className:$("bg-white dark:bg-slate-900 rounded-t-2xl md:rounded-2xl shadow-2xl w-full flex flex-col max-h-[90vh] animate-slide-up md:animate-fade-in",l[m])},n.createElement("div",{className:"px-6 py-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center"},n.createElement("h3",{className:"font-bold text-lg dark:text-white"},c),n.createElement("button",{onClick:r,className:"p-2 -mr-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 bg-slate-50 dark:bg-slate-800 rounded-full transition-colors"},"✕")),n.createElement("div",{className:"overflow-y-auto p-4"},d)))};export{C as A,I,R as M,q as S,L as a};
