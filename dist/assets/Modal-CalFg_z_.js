import{R as r,r as f,o as k,X as y,L as E}from"./vendor-BhKfyhrK.js";import{j as t,c as S}from"./index-faf4erw8.js";const w=(...s)=>s.filter(Boolean).join(" "),R=({label:s,value:i,onChange:d,placeholder:c,type:u="text",error:l,inputMode:m,pattern:o,id:n,className:h="",disabled:g=!1,min:v,step:x})=>r.createElement("div",{className:w("mb-4",h),id:n},s?r.createElement("label",{className:w("block text-sm font-medium mb-1.5",l?"text-red-600":"text-slate-700 dark:text-slate-300")},`${s}${l?" *":""}`):null,r.createElement("input",{type:u,value:i||"",onChange:e=>d&&d(e.target.value),placeholder:c,inputMode:m,pattern:o,disabled:g,min:v,step:x,className:w("w-full p-3 rounded-xl bg-white dark:bg-slate-900 border outline-none transition-all dark:text-white focus:ring-4",l?"border-red-500 focus:ring-red-200 focus:border-red-500":"border-slate-200 dark:border-slate-700 focus:border-brand-500 focus:ring-brand-200",g&&"opacity-50 cursor-not-allowed")}),l?r.createElement("span",{className:"text-xs text-red-500 mt-1 block"},"Requis"):null),j=(...s)=>s.filter(Boolean).join(" "),C=({options:s,value:i,onChange:d,label:c,error:u,id:l,className:m="",disabled:o=!1})=>r.createElement("div",{className:j("mb-4",m),id:l},c?r.createElement("label",{className:"block text-sm font-medium mb-2 text-slate-700 dark:text-slate-300"},c):null,r.createElement("div",{className:j("flex flex-wrap gap-1 bg-slate-100 dark:bg-slate-800 p-1 rounded-xl transition-all",u&&"field-error-ring animate-shake bg-red-50 dark:bg-red-950/20")},s.map(n=>r.createElement("button",{key:n.value,type:"button",onClick:()=>{o||d(n.value)},disabled:o,className:j("flex-1 flex-grow py-2 px-3 text-sm font-medium rounded-lg transition-all",i===n.value?"bg-white dark:bg-slate-700 text-brand-600 shadow-sm":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",o&&"opacity-50 cursor-not-allowed")},n.label))),u?r.createElement("span",{className:"text-xs text-red-500 mt-1 block"},"Requis"):null),$=({value:s,onChange:i})=>{const[d,c]=f.useState(!1),[u,l]=f.useState([]),[m,o]=f.useState(!1),n=f.useRef(null);f.useEffect(()=>{function e(a){n.current&&!n.current.contains(a.target)&&o(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[n]);const h=async e=>{if(!(!e||e.length<3))try{const b=await(await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(e)}&limit=5`)).json();b&&b.features&&(l(b.features),o(!0))}catch(a){console.error("Erreur recherche adresse",a)}};f.useEffect(()=>{const e=typeof s=="object"?s.address:s,a=setTimeout(()=>{e&&m&&h(e)},500);return()=>clearTimeout(a)},[s,m]);const g=()=>{if(!navigator.geolocation)return alert("Géolocalisation non supportée");c(!0);const e={enableHighAccuracy:!0,timeout:1e4,maximumAge:0};navigator.geolocation.getCurrentPosition(async a=>{try{const p=await(await fetch(`https://api-adresse.data.gouv.fr/reverse/?lon=${a.coords.longitude}&lat=${a.coords.latitude}`)).json();if(p&&p.features&&p.features.length>0){const N={address:p.features[0].properties.label,gps:{lat:a.coords.latitude,lon:a.coords.longitude}};i(N),l(p.features),o(!0)}else alert("Adresse introuvable à cette position.")}catch(b){console.error(b),alert("Erreur réseau API Adresse")}finally{c(!1)}},a=>{c(!1),console.warn("Erreur GPS:",a),alert("Impossible de vous localiser précisément. Vérifiez que le GPS est activé.")},e)},v=e=>{const a={address:e.properties.label,gps:{lon:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]}};i(a),o(!1)},x=typeof s=="object"?s.address:s||"";return t.jsxs("div",{className:"mb-4 relative",ref:n,children:[t.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-200 mb-1",children:"Adresse du chantier"}),t.jsxs("div",{className:"relative flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{type:"text",value:x,onChange:e=>{i(e.target.value),o(!0)},onFocus:()=>x&&x.length>3&&o(!0),placeholder:"Saisir ou cliquer sur le pin...",className:"w-full p-3 pl-10 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all shadow-sm",autoComplete:"off"}),t.jsx(k,{size:18,className:"absolute left-3 top-3.5 text-slate-400"}),x&&t.jsx("button",{type:"button",onClick:()=>{i(""),l([])},className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600",children:t.jsx(y,{size:16})})]}),t.jsx("button",{type:"button",onClick:g,disabled:d,className:"shrink-0 w-12 flex items-center justify-center bg-brand-50 dark:bg-brand-900/20 text-brand-600 border border-brand-200 dark:border-brand-800 rounded-xl hover:bg-brand-100 transition-colors disabled:opacity-50 active:scale-95",children:d?t.jsx(E,{className:"animate-spin",size:20}):t.jsx(k,{size:20})})]}),m&&u.length>0&&t.jsx("ul",{className:"absolute z-[100] left-0 right-0 mt-1 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-fade-in divide-y divide-slate-100 dark:divide-slate-700",children:u.map((e,a)=>t.jsx("li",{children:t.jsxs("button",{type:"button",onClick:()=>v(e),className:"w-full text-left px-4 py-3 text-sm text-slate-700 dark:text-slate-200 hover:bg-brand-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[t.jsx(k,{size:14,className:"text-slate-400 shrink-0"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-bold",children:e.properties.name}),t.jsxs("div",{className:"text-xs text-slate-400",children:[e.properties.postcode," ",e.properties.city]})]})]})},a))}),t.jsxs("p",{className:"text-[10px] text-slate-400 mt-1 ml-1 flex justify-between",children:[t.jsx("span",{children:"Le bouton utilise le GPS haute précision."}),d&&t.jsx("span",{className:"text-brand-500 font-bold",children:"Localisation en cours..."})]})]})},I=({isOpen:s,onClose:i,title:d,children:c,size:u="md"})=>{if(!s)return null;const l={sm:"max-w-md",md:"max-w-xl",lg:"max-w-3xl",full:"max-w-full m-4"};return r.createElement("div",{className:"fixed inset-0 z-[60] flex items-end md:items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm animate-fade-in"},r.createElement("div",{className:S("bg-white dark:bg-slate-900 rounded-t-2xl md:rounded-2xl shadow-2xl w-full flex flex-col max-h-[90vh] animate-slide-up md:animate-fade-in",l[u])},r.createElement("div",{className:"px-6 py-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center"},r.createElement("h3",{className:"font-bold text-lg dark:text-white"},d),r.createElement("button",{onClick:i,className:"p-2 -mr-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 bg-slate-50 dark:bg-slate-800 rounded-full transition-colors"},"✕")),r.createElement("div",{className:"overflow-y-auto p-4"},c)))};export{$ as A,R as I,I as M,C as S};
