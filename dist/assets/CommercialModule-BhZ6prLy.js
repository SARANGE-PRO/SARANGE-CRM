import{j as e,B as N,u as ne,i as fe,e as ve}from"./index-faf4erw8.js";import{m as de,n as W,o as se,p as ce,E as ae,f as oe,k as X,q as ie,s as xe,t as Z,u as je,r as x,Z as Ne,L as le,v as ee,U as me,w as ue,x as ke,y as we,I as ye,z as Ce,T as Se,g as De,h as Ee,M as Te,S as ze,i as Re,l as Ae,D as Le,G as Ie}from"./vendor-BhKfyhrK.js";import{C as d,D as te}from"./utils-CKkNC6ps.js";import{I as R,A as be,S as Pe,M as pe}from"./Modal-CalFg_z_.js";import{C as Me}from"./Card-SCoU-xcW.js";import{Q as Fe}from"./QuoteParserService-BHsDhh6M.js";const $e=({c:a,onClick:w,onDuplicate:b,onDelete:h,onPromoteToSent:I,onMarkForRelance:D,onMarkAsSigned:o,onTriggerRelanceAction:A})=>{const p=(()=>{let i=a.date,y="CrÃ©Ã© le";switch(a.status){case d.LEAD:i=a.dateCreation||a.date,y="CrÃ©Ã© le";break;case d.SENT:i=a.dateEnvoi||a.updatedAt,y="EnvoyÃ© le";break;case d.RELANCE:i=a.dateRelance||a.updatedAt,y="RelancÃ© le";break;case d.SIGNED:i=a.dateSignature||a.updatedAt,y="SignÃ© le";break}const g=i?new Date(i).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A";return{prefix:y,formattedDate:g}})(),E={[d.LEAD]:{color:"bg-slate-100 text-slate-600",dot:"bg-slate-400",label:"Nouveau"},[d.SENT]:{color:"bg-blue-50 text-blue-700 border-blue-200",dot:"bg-blue-500",label:"EnvoyÃ©"},[d.RELANCE]:{color:"bg-orange-50 text-orange-700 border-orange-200",dot:"bg-orange-500",label:"Ã€ Relancer"},[d.SIGNED]:{color:"bg-green-50 text-green-700 border-green-200",dot:"bg-green-500",label:"GagnÃ©"}},C=E[a.status]||E[d.LEAD],f=(()=>{if(a.status!==d.SENT&&a.status!==d.RELANCE)return null;const i=new Date(a.dateEnvoiDevis||a.updatedAt),y=Math.abs(new Date-i),g=Math.floor(y/(1e3*60*60*24)),v=a.relanceLevel||0;return g>=30&&v===2?{type:"R3",label:"Relance 3 (ClÃ´ture) requise",days:g,color:"text-red-600",bg:"bg-red-50",border:"border-red-400",shadow:"shadow-red-100"}:g>=10&&v===1?{type:"R2",label:"Relance 2 (Urgence) requise",days:g,color:"text-orange-600",bg:"bg-orange-50",border:"border-orange-400",shadow:"shadow-orange-100"}:g>=3&&v===0?{type:"R1",label:"Relance 1 requise",days:g,color:"text-amber-600",bg:"bg-amber-50",border:"border-amber-400",shadow:"shadow-amber-100"}:null})();return e.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-xl shadow-sm border ${f?`border-2 ${f.border} ${f.shadow}`:"border-slate-200 dark:border-slate-700"} p-4 transition-all hover:shadow-md cursor-pointer group hover:border-brand-300 dark:hover:border-brand-700`,onClick:()=>w(a.id),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"font-bold text-slate-800 dark:text-white line-clamp-1",children:a.client})}),e.jsxs("div",{className:`text-xs px-2 py-1 rounded-full border border-transparent font-medium flex items-center gap-1.5 whitespace-nowrap ${C.color}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${C.dot}`}),C.label]})]}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm text-slate-600 dark:text-slate-400",children:[a.telephone&&e.jsxs("a",{href:`tel:${a.telephone}`,className:"flex items-center gap-2 hover:text-brand-600 transition-colors",onClick:i=>i.stopPropagation(),children:[e.jsx(de,{size:14,className:"text-slate-400"}),a.telephone]}),a.email&&e.jsxs("a",{href:`mailto:${a.email}`,className:"flex items-center gap-2 hover:text-brand-600 transition-colors line-clamp-1",onClick:i=>i.stopPropagation(),children:[e.jsx(W,{size:14,className:"text-slate-400 shrink-0"}),e.jsx("span",{className:"truncate",children:a.email})]}),a.adresse&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{size:14,className:"text-slate-400 shrink-0 mt-0.5"}),e.jsx("span",{className:"line-clamp-2 text-xs leading-tight",children:a.adresse})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 font-medium mb-3 bg-slate-50 dark:bg-slate-900/50 p-2 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ce,{size:12,className:"text-slate-400"}),e.jsxs("span",{children:[p.prefix," ",p.formattedDate]})]}),a.montantTTC&&a.status!==d.LEAD&&e.jsxs("div",{className:"flex items-center gap-1 font-bold text-slate-700 dark:text-slate-200",children:[e.jsx(ae,{size:13,className:"text-slate-400"}),parseFloat(a.montantTTC).toLocaleString("fr-FR",{style:"currency",currency:"EUR"})]})]}),e.jsxs("div",{className:"pt-3 mt-2 border-t border-slate-100 dark:border-slate-800 flex flex-col gap-2",children:[f&&e.jsxs("div",{className:`w-full rounded-lg border ${f.border} ${f.bg} p-2 mb-1`,children:[e.jsxs("div",{className:`text-xs font-bold mb-2 flex items-center gap-1.5 ${f.color}`,children:[e.jsx(oe,{size:14,className:"animate-pulse"})," ",f.label," (J+",f.days,")"]}),e.jsxs("div",{className:"flex flex-col gap-1.5 w-full",children:[f.type==="R1"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"secondary",className:"w-full text-xs py-1.5 bg-white border border-amber-200 text-amber-700 hover:bg-amber-100 flex justify-center !px-2",onClick:i=>{i.stopPropagation(),A(a,1,"phone")},children:"ðŸ“ž AppelÃ© (Sans SuccÃ¨s)"}),e.jsx(N,{variant:"primary",className:"w-full text-[11px] py-1.5 bg-amber-500 hover:bg-amber-600 border-none flex justify-center !px-2",icon:W,onClick:i=>{i.stopPropagation(),A(a,1,"email")},children:"Envoyer Email R1"})]}),f.type==="R2"&&e.jsx(N,{variant:"primary",className:"w-full text-[11px] py-1.5 bg-orange-500 hover:bg-orange-600 border-none flex justify-center !px-2",icon:W,onClick:i=>{i.stopPropagation(),A(a,2,"email")},children:"Envoyer Email R2 (Urgence)"}),f.type==="R3"&&e.jsx(N,{variant:"primary",className:"w-full text-[11px] py-1.5 bg-red-600 hover:bg-red-700 border-none flex justify-center !px-2",icon:X,onClick:i=>{i.stopPropagation(),A(a,3,"email_archive")},children:"Email de ClÃ´ture & Archiver"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsxs("div",{className:"flex-1",children:[a.status===d.LEAD&&e.jsx(N,{variant:"primary",className:"w-full text-xs py-1.5 h-auto rounded-lg shadow-sm",icon:ie,onClick:i=>{i.stopPropagation(),I(a.id)},children:"Chiffrer / Envoyer"}),!f&&a.status===d.SENT&&e.jsx(N,{variant:"secondary",className:"w-full text-[11px] py-1.5 h-auto rounded-lg shadow-sm bg-orange-100/50 text-orange-700 hover:bg-orange-100 border-none font-medium px-2",icon:xe,onClick:i=>{i.stopPropagation(),D(a.id)},children:"Forcer en Relance"}),!f&&a.status===d.RELANCE&&e.jsx(N,{variant:"secondary",className:"w-full text-xs py-1.5 h-auto rounded-lg shadow-sm bg-green-100/50 text-green-700 hover:bg-green-100 border-none font-bold",icon:Z,onClick:i=>{i.stopPropagation(),o(a.id),w(a.id)},children:"GagnÃ© / SignÃ©"}),a.status===d.SIGNED&&e.jsxs("div",{className:"w-full text-xs py-1.5 text-center font-bold text-green-600 bg-green-50 rounded-lg flex justify-center items-center gap-1",children:[e.jsx(Z,{size:14})," SignÃ©"]})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l border-slate-200 dark:border-slate-700 pl-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),b(a.id)},className:"p-1 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded-md transition-colors",title:"Dupliquer",children:e.jsx(je,{size:16})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),h(a.id)},className:"p-1 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-md transition-colors",title:"Supprimer",children:e.jsx(X,{size:16})})]})]})]})]})},Oe=({onClose:a,onSubmit:w})=>{const[b,h]=x.useState({client:"",telephone:"",email:"",adresse:"",source:"Site Web",notes:""}),I=o=>{h(typeof o=="object"?{...b,adresse:o.address}:{...b,adresse:o})},D=()=>{if(!b.client.trim())return alert("Le nom du client est requis pour un lead.");w(b)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-end md:items-center justify-center p-0 md:p-4 animate-fade-in",children:e.jsxs(Me,{className:"w-full max-w-md p-6 shadow-2xl rounded-t-2xl md:rounded-2xl max-h-[95vh] overflow-y-auto animate-slide-up md:animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{className:"text-brand-500",size:24}),"Nouveau Lead"]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Saisie rapide pour un premier contact"})]}),e.jsx("button",{onClick:a,className:"p-2 text-slate-400 hover:text-slate-600 bg-slate-50 dark:bg-slate-800 rounded-full transition-colors",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{label:"Nom / PrÃ©nom Client *",value:b.client,onChange:o=>h({...b,client:o}),autoFocus:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(R,{label:"TÃ©l",value:b.telephone,onChange:o=>h({...b,telephone:o}),type:"tel",inputMode:"tel",pattern:"[0-9]*"}),e.jsx(R,{label:"Email",value:b.email,onChange:o=>h({...b,email:o}),type:"email",inputMode:"email"})]}),e.jsx(be,{value:b.adresse,onChange:I}),e.jsx(Pe,{label:"Source du Lead",value:b.source,onChange:o=>h({...b,source:o}),options:[{label:"Site Web",value:"Site Web"},{label:"TÃ©lÃ©phone",value:"TÃ©lÃ©phone"},{label:"Bouche-a-oreille",value:"Bouche-Ã -oreille"},{label:"Autre",value:"Autre"}]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 ml-1",children:"Description / Projet"}),e.jsx("textarea",{className:"w-full p-3 bg-slate-50 dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 rounded-xl outline-none focus:border-brand-500 transition-colors text-sm min-h-[100px] resize-none text-slate-800 dark:text-slate-200",placeholder:"Quels sont les besoins du client ?",value:b.notes,onChange:o=>h({...b,notes:o.target.value})})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8 pb-4",children:[e.jsx(N,{variant:"secondary",onClick:a,className:"flex-1 py-3 text-base",children:"Annuler"}),e.jsx(N,{onClick:D,variant:"primary",className:"flex-1 py-3 text-base",children:"CrÃ©er le Lead"})]})]})})},Qe=({file:a,chantierId:w,onClose:b,onSuccess:h})=>{const{state:I,updateChantier:D}=ne(),o=I.chantiers.find(m=>m.id===w),[A,r]=x.useState(!0),[p,E]=x.useState(!1),[C,P]=x.useState(null),[f,i]=x.useState(!1),[y,g]=x.useState(""),[v,V]=x.useState(""),[L,G]=x.useState(""),[M,J]=x.useState(""),[F,$]=x.useState(""),[_,q]=x.useState(!1),[B,T]=x.useState(""),[K,Q]=x.useState(""),[U,s]=x.useState(!1);x.useEffect(()=>{if(!a||!o)return;(async()=>{try{r(!0);const t=await Fe.extractQuoteData(a),l=t.number||o.extractedQuoteNumber||"",c=t.name||o.client||"",j=t.email||o.email||"",n=t.totalTTC?t.totalTTC.toString():o.montantTTC||"",S=t.address||o.adresse||"",z=t.tvaReduced||o.tvaReduced||!1;V(l),G(c),J(j),T(n),Q(S),s(z);const k={};let O=!1;!o.extractedQuoteNumber&&l&&(k.extractedQuoteNumber=l,O=!0),!o.client&&c&&(k.client=c,O=!0),!o.email&&j&&(k.email=j,O=!0),!o.adresse&&S&&(k.adresse=S,O=!0),!o.montantTTC&&n&&(k.montantTTC=n,O=!0),o.tvaReduced===void 0&&z!==void 0&&(k.tvaReduced=z,O=!0),O&&D(o.id,k)}catch(t){console.error("Erreur parsing PDF",t),P("Impossible de lire le PDF. Veuillez vÃ©rifier le fichier.")}finally{r(!1)}})()},[a,o]);const u=async()=>{if(!v||!L||!M){P("Les champs NÂ° Devis, Client et Email sont obligatoires.");return}E(!0),P(null);try{await fe(),await ve();const t=window.gapi.client.getToken().access_token,l={name:a.name,parents:["1TslssfhTFaJ_I2-Hr2mqgtT8a7plnXZCt9_K00Zc8Nur6kjnEr8zJlC5nc8vSz-wZoBML0jb"],mimeType:"application/pdf"},c=new FormData;c.append("metadata",new Blob([JSON.stringify(l)],{type:"application/json"})),c.append("file",a,a.name);const j=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink",{method:"POST",headers:{Authorization:"Bearer "+t},body:c});if(!j.ok){const Y=await j.text();throw new Error("Erreur upload Drive: "+j.status+" "+Y)}const n=await j.json(),S=n.id,z=n.webViewLink;await fetch(`https://www.googleapis.com/drive/v3/files/${S}/permissions`,{method:"POST",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},body:JSON.stringify({role:"reader",type:"anyone"})});const k="https://script.google.com/macros/s/AKfycbzTS1SgE9Lg3WlFHrC5q-jsfVUXMlk0fGStJQOw2yQGM1AIssJ8-hEtKls5cJTiEvxw/exec",O={action:"admin_devis",horodateur:new Date().toLocaleString("fr-FR"),devis:v.trim(),client:L.trim(),email:M.trim(),cc:F.trim(),fileId:S,driveUrl:z,totalTTC:parseFloat(B)||0,tvaReduced:U},ge=await(await fetch(k,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},redirect:"follow",body:JSON.stringify(O)})).text();let re;try{re=JSON.parse(ge)}catch{throw new Error("RÃ©ponse inattendue du serveur.")}if(re.status==="success"){const Y=crypto.randomUUID();await te.storeFile(Y,a);const he=[...o.attachments||[],{id:Y,name:a.name,type:a.type,date:new Date().toISOString()}];let H=o.notes||"";H.includes(v)||(H=H?`${H}
Devis NÂ° ${v}`:`Devis NÂ° ${v}`),D(o.id,{status:d.SENT,dateEnvoi:new Date().toISOString(),extractedQuoteNumber:v,tvaReduced:U,montantTTC:O.totalTTC,client:L,email:M,notes:H,attachments:he,updatedAt:new Date().toISOString()}),i(!0),g(z),setTimeout(()=>{h&&h(),b()},2500)}else throw new Error(re.message||"Erreur serveur inconnue.")}catch(m){console.error("Erreur envoi devis admin",m),P(m.message)}finally{E(!1)}};return o?e.jsx(pe,{isOpen:!0,onClose:b,title:"Extraction & Envoi Devis",size:"md",children:A?e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-slate-500",children:[e.jsx(le,{size:32,className:"animate-spin text-brand-500 mb-4"}),e.jsx("p",{className:"font-medium text-sm",children:"Analyse du PDF en cours..."})]}):f?e.jsxs("div",{className:"py-8 flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-4",children:e.jsx(Z,{size:32})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-2",children:"Devis envoyÃ© avec succÃ¨s !"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-sm mb-6",children:"Le PDF est sur Drive, la ligne est dans le Sheet interne et le mail de demande de signature a Ã©tÃ© envoyÃ© au client."}),y&&e.jsx("a",{href:y,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-semibold text-brand-600 hover:text-brand-700 underline",children:"Voir le PDF sur Google Drive"})]}):e.jsxs("div",{className:"flex flex-col gap-5",children:[C&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm flex items-start gap-3",children:[e.jsx(oe,{size:16,className:"mt-0.5 shrink-0"}),e.jsx("p",{children:C})]}),e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 dark:border-slate-800 pb-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-800 dark:text-slate-200 flex items-center gap-2",children:[e.jsx(Z,{size:16,className:"text-green-500"}),"DonnÃ©es extraites"]}),U&&e.jsx("span",{className:"bg-orange-500 text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wide",children:"TVA RÃ©duite"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1.5 mb-1.5",children:[e.jsx(ee,{size:12})," NÂ° Devis"]}),e.jsx(R,{value:v,onChange:V,placeholder:"001804"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1.5 mb-1.5",children:[e.jsx(me,{size:12})," Nom du client"]}),e.jsx(R,{value:L,onChange:G,placeholder:"DA TRAVAUX"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1.5",children:[e.jsx(W,{size:12})," Email du client"]}),!_&&e.jsxs("button",{onClick:()=>q(!0),className:"text-[11px] font-medium text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 flex items-center gap-1 transition-colors",children:[e.jsx(ue,{size:10})," Ajouter CC"]})]}),e.jsx(R,{value:M,onChange:J,type:"email",placeholder:"client@example.com"})]}),_&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1.5 mb-1.5",children:[e.jsx(W,{size:12})," Email en copie (CC)"]}),e.jsx(R,{value:F,onChange:$,type:"email",placeholder:"architecte@example.com"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1.5 mb-1.5",children:[e.jsx(se,{size:12})," Adresse"]}),e.jsx(R,{value:K,onChange:Q,placeholder:"Adresse du client"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1.5 mb-1.5",children:[e.jsx(ae,{size:12})," Total TTC"]}),e.jsx(R,{value:B,onChange:T,placeholder:"35207.10",type:"number",step:"0.01"})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 p-3 rounded-lg text-xs flex items-center gap-2 mt-2",children:[e.jsx(le,{size:14,className:"text-blue-500"}),e.jsx("span",{children:"Le PDF sera uploadÃ© automatiquement sur Google Drive"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsx(N,{variant:"secondary",onClick:b,disabled:p,children:"Annuler"}),e.jsx(N,{variant:"primary",onClick:u,disabled:p,isLoading:p,icon:ie,className:p?"opacity-80":"",children:p?"Envoi en cours...":"Envoyer vers Sheet + Mail"})]})]})}):null},Ue=({chantierId:a,onClose:w})=>{var U;const{state:b,updateChantier:h,deleteChantier:I,promoteLeadToSent:D,markForRelance:o,markAsSigned:A}=ne(),[r,p]=x.useState(null),[E,C]=x.useState(!1),[P,f]=x.useState(!1),[i,y]=x.useState(!1),[g,v]=x.useState(null);if(x.useEffect(()=>{if(a){const s=b.chantiers.find(u=>u.id===a);s&&p({...s})}},[a,b.chantiers]),!r)return null;const V=()=>{h(r.id,{client:r.client,telephone:r.telephone,email:r.email,adresse:r.adresse,montantTTC:r.montantTTC,notes:r.notes,dateEnvoiDevis:r.dateEnvoiDevis,updatedAt:new Date().toISOString()}),w()},L=async s=>{if(!s||s.length===0)return;f(!0);const u=[...r.attachments||[]];let m={};for(let t=0;t<s.length;t++){const l=s[t],c=crypto.randomUUID(),j={id:c,name:l.name,type:l.type,date:new Date().toISOString()};try{if(await te.storeFile(c,l),u.push(j),l.type==="application/pdf"&&!m.number)try{const n=await QuoteParserService.extractQuoteData(l);n&&(m=n)}catch(n){console.error("Erreur parsing PDF",n)}}catch(n){console.error("Erreur lors de l'enregistrement du fichier",n),alert("Erreur lors de l'enregistrement de "+l.name)}}p(t=>{const l={...t,attachments:u,montantTTC:m.totalTTC||t.montantTTC,tvaReduced:m.tvaReduced!==void 0?m.tvaReduced:t.tvaReduced,extractedQuoteNumber:m.number||t.extractedQuoteNumber};return m.number&&(!l.notes||!l.notes.includes(m.number))&&(l.notes=l.notes?`${l.notes}
Devis NÂ° ${m.number}`:`Devis NÂ° ${m.number}`),h(l.id,{attachments:u,montantTTC:l.montantTTC,tvaReduced:l.tvaReduced,extractedQuoteNumber:l.extractedQuoteNumber,notes:l.notes,updatedAt:new Date().toISOString()}),l}),f(!1),C(!1)},G=s=>{s.preventDefault(),s.stopPropagation(),C(!1),L(s.dataTransfer.files)},M=s=>{s.preventDefault(),s.stopPropagation(),C(!0)},J=s=>{s.preventDefault(),s.stopPropagation(),C(!1)},F=s=>L(s.target.files),$=async s=>{try{const u=await te.getFile(s.id);if(!u){alert("Ce fichier est introuvable sur cet appareil.");return}const m=URL.createObjectURL(u);window.open(m,"_blank"),setTimeout(()=>URL.revokeObjectURL(m),1e4)}catch(u){console.error("Download error",u)}},_=async s=>{if(!window.confirm(`Voulez-vous vraiment supprimer "${s.name}" ?`))return;try{await te.deleteFile(s.id)}catch(m){console.error("Delete DB file error",m)}const u=(r.attachments||[]).filter(m=>m.id!==s.id);p(m=>{const t={...m,attachments:u};return h(t.id,{attachments:u,updatedAt:new Date().toISOString()}),t})},q=()=>{window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce dossier ?")&&(I(r.id),w())},B=s=>{s.preventDefault(),s.stopPropagation(),y(!1);const u=s.dataTransfer.files;u&&u.length>0&&(u[0].type==="application/pdf"?v(u[0]):alert("Veuillez sÃ©lectionner un fichier PDF valide."))},T=s=>{s.preventDefault(),s.stopPropagation(),y(!0)},K=s=>{s.preventDefault(),s.stopPropagation(),y(!1)},Q=s=>{const u=s.target.files;u&&u.length>0&&v(u[0])};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{isOpen:!g,onClose:w,title:"DÃ©tails du Dossier Commercial",size:"lg",children:e.jsxs("div",{className:"flex flex-col gap-5 md:flex-row md:gap-6",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("section",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800 p-4",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2",children:[e.jsx(me,{size:14})," Contact & CoordonnÃ©es"]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 block mb-1",children:"Nom du Client / SociÃ©tÃ©"}),e.jsx(R,{value:r.client,onChange:s=>p({...r,client:s}),placeholder:"Ex: Jean Dupont",className:"font-bold text-slate-800"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(de,{size:11})," TÃ©lÃ©phone"]}),e.jsx(R,{value:r.telephone||"",onChange:s=>p({...r,telephone:s}),placeholder:"06...",type:"tel"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(W,{size:11})," Email"]}),e.jsx(R,{value:r.email||"",onChange:s=>p({...r,email:s}),placeholder:"contact@...",type:"email"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(se,{size:11})," Adresse"]}),e.jsx(be,{value:r.adresse||"",onChange:(s,u,m,t,l)=>p({...r,adresse:s,gps:{lat:t,lng:l}})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-slate-500 flex items-center gap-1 mb-1",children:[e.jsx(ee,{size:11})," Notes internes"]}),e.jsx("textarea",{value:r.notes||"",onChange:s=>p({...r,notes:s.target.value}),className:"w-full p-3 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 text-sm h-28 resize-none",placeholder:"Budget approximatif, horaires pour appeler, compte-rendu..."})]})]})]}),e.jsxs("section",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800 p-4",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2",children:[e.jsx(ke,{size:14})," PiÃ¨ces jointes",((U=r.attachments)==null?void 0:U.length)>0&&e.jsx("span",{className:"ml-auto bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-semibold px-2 py-0.5 rounded-full",children:r.attachments.length})]}),e.jsxs("div",{className:`relative border-2 border-dashed rounded-xl p-5 text-center transition-all ${E?"border-brand-500 bg-brand-50 dark:bg-brand-900/20 scale-[1.01]":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 hover:border-slate-300 dark:hover:border-slate-600"}`,onDrop:G,onDragOver:M,onDragLeave:J,children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf",onChange:F,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:"Cliquez ou glissez vos fichiers ici"}),P?e.jsx(le,{size:28,className:"mx-auto text-brand-500 mb-2 animate-spin"}):e.jsx(we,{size:28,className:`mx-auto mb-2 transition-colors ${E?"text-brand-500":"text-slate-300"}`}),e.jsx("p",{className:"text-sm font-semibold text-slate-600 dark:text-slate-300",children:E?"RelÃ¢chez pour ajouter":"Glissez ou cliquez pour ajouter"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Photos du chantier, plans, PDFâ€¦"})]}),r.attachments&&r.attachments.length>0&&e.jsx("ul",{className:"mt-3 flex flex-col gap-2",children:r.attachments.map(s=>e.jsxs("li",{className:"group flex items-center justify-between gap-2 p-2.5 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg shadow-sm hover:border-slate-300 dark:hover:border-slate-600 transition-all",children:[e.jsxs("button",{onClick:()=>$(s),className:"flex items-center gap-2.5 flex-1 text-left hover:text-brand-600 dark:hover:text-brand-400 transition-colors overflow-hidden",children:[e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800 p-2 rounded-md shrink-0",children:s.type.startsWith("image/")?e.jsx(ye,{size:14,className:"text-blue-500"}):e.jsx(ee,{size:14,className:"text-orange-500"})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-sm font-semibold truncate",title:s.name,children:s.name}),e.jsx("p",{className:"text-xs text-slate-400",children:new Date(s.date).toLocaleDateString("fr-FR")})]})]}),e.jsx("button",{onClick:()=>_(s),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-colors shrink-0 opacity-0 group-hover:opacity-100 focus:opacity-100",title:"Supprimer",children:e.jsx(X,{size:14})})]},s.id))})]}),e.jsxs(N,{variant:"secondary",className:"w-full gap-2 text-sm font-semibold text-brand-700 bg-brand-50 border-brand-100 hover:bg-brand-100",onClick:V,children:[e.jsx(Ce,{size:15})," Enregistrer les modifications"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("section",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800 p-4",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2",children:[e.jsx(ae,{size:14})," Chiffrage & Devis"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-500 block mb-1",children:"Montant EstimÃ© ou Final (TTC)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand-500 pointer-events-none",size:17}),e.jsx("input",{type:"number",value:r.montantTTC||"",onChange:s=>p({...r,montantTTC:s.target.value}),className:"w-full pl-9 pr-4 py-2.5 text-lg font-bold bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-brand-500 outline-none",placeholder:"0,00"})]})]}),r.status!==d.LEAD&&e.jsxs("div",{className:"mb-5 bg-blue-50/50 hover:bg-blue-50 dark:bg-blue-900/10 dark:hover:bg-blue-900/20 transition-colors border border-blue-100 dark:border-blue-800/50 p-3 rounded-xl",children:[e.jsxs("label",{className:"text-xs font-semibold text-blue-700 dark:text-blue-400 block mb-1 flex items-center gap-1.5",children:[e.jsx(ce,{size:13})," Date d'envoi (DÃ©clenche les relances)"]}),e.jsx("input",{type:"date",value:r.dateEnvoiDevis?r.dateEnvoiDevis.substring(0,10):"",onChange:s=>p({...r,dateEnvoiDevis:new Date(s.target.value).toISOString()}),className:"w-full p-2 text-sm font-medium bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-slate-700 dark:text-slate-300"}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-1.5 leading-tight",children:"Modifiez cette date si vous avez envoyÃ© le devis Ã  la main sans utiliser le bouton d'envoi du CRM. Les relances (J+3, 10, 30) se basent sur ce jour."})]}),e.jsxs("div",{className:`relative border-2 border-dashed rounded-xl p-5 text-center transition-all cursor-pointer ${i?"border-brand-500 bg-brand-50 dark:bg-brand-900/20 scale-[1.01]":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 hover:border-slate-300 dark:hover:border-slate-600"}`,onDrop:B,onDragOver:T,onDragLeave:K,children:[e.jsx("input",{type:"file",accept:"application/pdf",onChange:Q,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:"Cliquez ou glissez le devis PDF ici"}),e.jsx(ee,{size:28,className:`mx-auto mb-2 transition-colors ${i?"text-brand-500":"text-slate-300"}`}),e.jsx("p",{className:"text-sm font-semibold text-slate-600 dark:text-slate-300",children:i?"RelÃ¢chez le devis ici":"Aucun devis liÃ©. Glissez un PDF ici"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"ou cliquez pour importer"}),e.jsx(N,{variant:"secondary",className:"mt-3 text-xs pointer-events-none",children:"Importer un devis"})]})]}),r.status!==d.SIGNED&&e.jsxs("section",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800 p-4",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4",children:"Faire avancer le dossier"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[r.status===d.LEAD&&e.jsx(N,{variant:"primary",className:"w-full text-sm",icon:ie,onClick:()=>D(r.id,r.montantTTC),children:'Passer en "Devis EnvoyÃ©" (Manuel)'}),r.status===d.SENT&&e.jsx(N,{variant:"secondary",className:"w-full text-sm bg-orange-50 text-orange-700 hover:bg-orange-100 border-orange-100 font-medium",icon:xe,onClick:()=>o(r.id),children:'Passer en "Relance"'}),(r.status===d.SENT||r.status===d.RELANCE)&&e.jsx(N,{variant:"secondary",className:"w-full text-sm bg-green-50 text-green-700 hover:bg-green-100 border-green-100 font-bold",icon:Z,onClick:()=>A(r.id),children:'âœ¨ Marquer comme "GagnÃ© / SignÃ©"'})]})]}),r.status===d.SIGNED&&e.jsxs("section",{className:"relative overflow-hidden bg-green-50 dark:bg-green-900/20 rounded-xl border-2 border-green-400 dark:border-green-600 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-36 h-36 bg-green-100 dark:bg-green-800/20 rounded-full blur-3xl -mr-12 -mt-12 pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-bold text-green-800 dark:text-green-300",children:"ðŸŽ‰ Deal GagnÃ© !"}),e.jsx("span",{className:"shrink-0 bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200 text-xs font-bold px-2 py-0.5 rounded-full uppercase tracking-wide",children:"SignÃ©"})]}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400 mb-4",children:"Le devis est signÃ©. OÃ¹ souhaitez-vous envoyer ce dossier ?"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(N,{variant:"primary",className:"w-full justify-start h-auto py-3 px-4",onClick:()=>{h(r.id,{assignation:"METRAGE"}),w()},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full shrink-0",children:e.jsx(se,{size:17})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-white text-sm",children:"Bureau d'Ã‰tudes"}),e.jsx("p",{className:"text-xs text-green-100 font-normal",children:"Un mÃ©treur doit se rendre sur place avant fabrication."})]})]})}),e.jsx(N,{variant:"secondary",className:"w-full justify-start h-auto py-3 px-4 bg-white border-slate-200 dark:border-slate-600",onClick:()=>{h(r.id,{assignation:"ATELIER"}),w()},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800 p-2 rounded-full shrink-0",children:e.jsx(Se,{size:17,className:"text-slate-500"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-slate-700 dark:text-slate-200 text-sm",children:"Directement Ã  l'Atelier"}),e.jsx("p",{className:"text-xs text-slate-500 font-normal",children:"MÃ©trage dÃ©jÃ  fourni. PrÃªt pour la fabrication."})]})]})})]})]})]}),e.jsx("div",{className:"mt-auto pt-2 border-t border-slate-100 dark:border-slate-800 flex justify-end",children:e.jsxs("button",{onClick:q,className:"flex items-center gap-1.5 text-xs text-slate-400 hover:text-red-500 transition-colors py-1 px-2 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20",children:[e.jsx(X,{size:12})," Supprimer ce dossier"]})})]})]})}),g&&e.jsx(Qe,{file:g,chantierId:r.id,onClose:()=>v(null),onSuccess:()=>{v(null),w()}})]})},We=({onNew:a,isDark:w,toggleDark:b,onOpenSettings:h,onOpenTrash:I,isOnline:D,firebaseConnected:o})=>{const{state:A,selectChantier:r,updateChantier:p,promoteLeadToSent:E,markForRelance:C,markAsSigned:P,createNewLead:f,duplicateChantier:i,deleteChantier:y}=ne(),[g,v]=x.useState(null),[V,L]=x.useState(!1),[G,M]=x.useState(null),[J,F]=x.useState(!1),[$,_]=x.useState(""),[q,B]=x.useState("leads"),T=x.useMemo(()=>(A.chantiers||[]).filter(t=>{var l,c,j,n;return!t.deleted&&!t.purged&&t.assignation==="COMMERCIAL"&&(((l=t.client)==null?void 0:l.toLowerCase().includes($.toLowerCase()))||((c=t.adresse)==null?void 0:c.toLowerCase().includes($.toLowerCase()))||((j=t.telephone)==null?void 0:j.includes($))||((n=t.email)==null?void 0:n.toLowerCase().includes($.toLowerCase())))}),[A.chantiers,$]),K=x.useMemo(()=>{const t=T.filter(n=>(!n.status||n.status===d.LEAD||n.status==="DRAFT")&&n.status!==d.SENT&&n.status!==d.SIGNED&&!n.commercialRelance),l=T.filter(n=>n.status===d.SENT&&!n.commercialRelance),c=T.filter(n=>n.status===d.RELANCE||n.status===d.SENT&&n.commercialRelance===!0),j=T.filter(n=>n.status===d.SIGNED);return[{id:"leads",title:"Nouveaux Leads",items:t,color:"bg-slate-100 dark:bg-slate-800/50",headerColor:"text-slate-700 dark:text-slate-300",dot:"bg-slate-400",border:"border-slate-200 dark:border-slate-700",ring:"ring-slate-400"},{id:"envoyes",title:"Devis EnvoyÃ©s",items:l,color:"bg-brand-50/50 dark:bg-brand-900/10",headerColor:"text-brand-700 dark:text-brand-300",dot:"bg-brand-500",border:"border-brand-100 dark:border-brand-900",ring:"ring-brand-400"},{id:"relance",title:"En Relance",items:c,color:"bg-rose-50/50 dark:bg-rose-900/10",headerColor:"text-rose-700 dark:text-rose-300",dot:"bg-rose-500",border:"border-rose-100 dark:border-rose-900",ring:"ring-rose-400"},{id:"signes",title:"GagnÃ©s / SignÃ©s",items:j,color:"bg-green-50/50 dark:bg-emerald-900/10",headerColor:"text-green-700 dark:text-emerald-400",dot:"bg-green-500",border:"border-green-100 dark:border-green-900",ring:"ring-green-400"}]},[T]),Q=x.useRef(!1);x.useEffect(()=>{const t=async()=>{if(!(Q.current||!D)){Q.current=!0;try{const c=T.filter(n=>(n.status===d.SENT||n.status===d.RELANCE)&&n.extractedQuoteNumber);if(c.length===0){Q.current=!1;return}const j="https://script.google.com/macros/s/AKfycbzTS1SgE9Lg3WlFHrC5q-jsfVUXMlk0fGStJQOw2yQGM1AIssJ8-hEtKls5cJTiEvxw/exec";for(const n of c){try{console.log(`[Auto-Sync] VÃ©rification du devis ${n.extractedQuoteNumber}...`);const S=String(n.extractedQuoteNumber).trim(),z=await fetch(`${j}?check=${S}`);if(z.ok){const k=await z.json();console.log(`[Auto-Sync] RÃ©ponse pour devis ${S}:`,JSON.stringify(k)),(k.signed===!0||k.signed==="true")&&(console.log(`[Auto-Sync] ðŸŽ‰ Devis ${n.extractedQuoteNumber} dÃ©tectÃ© comme signÃ© ! Mise Ã  jour...`),p(n.id,{status:d.SIGNED,dateSignature:new Date().toISOString()}))}}catch(S){console.error("Erreur vÃ©rification signature auto pour",n.extractedQuoteNumber,S)}await new Promise(S=>setTimeout(S,500))}}finally{Q.current=!1}}};t();const l=setInterval(t,18e4);return()=>clearInterval(l)},[T,p,D]);const U=(t,l)=>{v(l),t.dataTransfer.setData("text/plain",l),t.dataTransfer.effectAllowed="move"},s=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},u=(t,l)=>{if(t.preventDefault(),!!g){switch(l){case"leads":p(g,{status:d.LEAD,commercialRelance:!1});break;case"envoyes":E(g,null);break;case"relance":C(g);break;case"signes":P(g),M(g);break}v(null)}},m=async(t,l,c)=>{if(!t)return;const j="https://script.google.com/macros/s/AKfycbzTS1SgE9Lg3WlFHrC5q-jsfVUXMlk0fGStJQOw2yQGM1AIssJ8-hEtKls5cJTiEvxw/exec";try{if(c==="phone"){p(t.id,{relanceLevel:l,status:d.RELANCE,dateRelance:new Date().toISOString()});return}if(c==="email"||c==="email_archive"){const n={action:"relance_devis",devis:t.extractedQuoteNumber||"",client:t.client||"",email:t.email||"",relanceLevel:l},z=await(await fetch(j,{method:"POST",body:JSON.stringify(n)})).json();if(z.status==="success"){const k={relanceLevel:l,dateRelance:new Date().toISOString()};c==="email_archive"?k.status="ARCHIVED":k.status=d.RELANCE,p(t.id,k)}else alert("Erreur lors de l'envoi de l'email de relance : "+(z.message||"Erreur inconnue"))}}catch(n){console.error("Erreur handleRelanceAction:",n),alert("Impossible de joindre le serveur pour la relance.")}};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-50 dark:bg-slate-900",children:[V&&e.jsx(Oe,{onClose:()=>L(!1),onSubmit:t=>{f(t),L(!1)}}),G&&e.jsx(Ue,{chantierId:G,onClose:()=>M(null)}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex-shrink-0 flex items-center shadow-sm z-20 pl-16 md:pl-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white mr-auto",children:"Commercial"}),e.jsxs("div",{className:"flex gap-2 relative",children:[D?o?e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full",title:"ConnectÃ© au Cloud",children:e.jsx(De,{size:20,className:"text-green-500"})}):e.jsx("div",{className:"p-2 bg-orange-50 dark:bg-orange-900/20 rounded-full animate-pulse",title:"ProblÃ¨me de connexion Firebase (Quota/RÃ©seau)",children:e.jsx(oe,{size:20,className:"text-orange-500"})}):e.jsx("div",{className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full",title:"Hors Connexion",children:e.jsx(Ee,{size:20,className:"text-slate-400"})}),e.jsx("button",{onClick:()=>F(!J),className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:e.jsx(Te,{size:20})}),J&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>F(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 overflow-hidden z-50 animate-fade-in origin-top-right",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("button",{onClick:()=>{b(),F(!1)},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg transition-colors",children:[w?e.jsx(ze,{size:16,className:"mr-3 text-orange-400"}):e.jsx(Re,{size:16,className:"mr-3 text-brand-600"}),w?"Mode Clair":"Mode Sombre"]}),e.jsx("div",{className:"h-px bg-slate-100 dark:bg-slate-700 my-1"}),I&&e.jsxs("button",{onClick:()=>{I(),F(!1)},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg",children:[e.jsx(X,{size:16,className:"mr-3 text-red-500"}),"Corbeille"]}),h&&e.jsxs("button",{onClick:()=>{h(),F(!1)},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg",children:[e.jsx(Ae,{size:16,className:"mr-3 text-slate-400"}),"ParamÃ¨tres..."]})]})})]})]})]}),e.jsx("div",{className:"flex-none bg-white dark:bg-slate-900 px-4 pt-3 pb-3 border-b border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"w-full mx-auto relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Le,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-800 border-0 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all shadow-inner",placeholder:"Rechercher un dossier...",value:$,onChange:t=>_(t.target.value)})]}),e.jsx(N,{onClick:()=>L(!0),icon:ue,className:"py-2 text-sm shadow-sm whitespace-nowrap px-4 hover:scale-[1.02] transition-transform",children:"Nouveau Lead"})]})}),e.jsx("div",{className:"md:hidden flex-none px-2 pt-4 pb-2 bg-slate-50 dark:bg-slate-900 w-full relative z-10 shrink-0",children:e.jsx("div",{className:"grid grid-cols-4 gap-2 lg:gap-3",children:K.map(t=>e.jsxs("button",{onClick:()=>B(t.id),className:`p-3 lg:p-4 rounded-xl border transition-all flex flex-col items-center justify-center text-center gap-1.5
                                ${q===t.id?`ring-2 ring-offset-1 ${t.ring} border-transparent scale-100`:`${t.border.replace("border-","border-")}/30 opacity-90`}
                                ${t.color}`,children:[e.jsx("div",{className:"text-2xl font-bold",children:t.items.length}),e.jsx("div",{className:"text-[11px] leading-tight font-bold uppercase w-full break-words",children:t.title})]},`tile-${t.id}`))})}),e.jsx("main",{className:"flex-1 min-h-0 overflow-y-auto pb-40 md:pb-0 w-full mx-auto bg-slate-50 dark:bg-slate-900",children:e.jsx("div",{className:"flex-1 min-h-0 grid grid-cols-1 md:grid-cols-4 gap-6 h-auto md:h-full px-4 md:px-6 md:pt-6 pb-0 w-full mx-auto",children:K.map(t=>e.jsxs("div",{className:`flex flex-col h-auto md:h-full rounded-2xl border ${t.border}/60 ${t.color} ${q===t.id?"block":"hidden md:flex"}`,onDragOver:s,onDrop:l=>u(l,t.id),children:[e.jsx("div",{className:"flex items-center justify-between mb-4 md:mb-0 md:p-4 shrink-0 border-b border-transparent md:border-slate-200/50 dark:md:border-slate-700/50",children:e.jsxs("h3",{className:`font-bold ${t.headerColor} flex items-center gap-2`,children:[e.jsx("div",{className:`hidden md:block w-2.5 h-2.5 rounded-full ${t.dot}`}),t.title,e.jsx("span",{className:"bg-white/50 dark:bg-slate-800/50 text-xs px-2 py-0.5 rounded-full shadow-sm ml-2",children:t.items.length})]})}),e.jsx("div",{className:"flex-1 md:overflow-y-auto overscroll-contain md:p-3 pb-0 md:pb-32 space-y-3 custom-scrollbar",children:t.items.length===0?e.jsx("div",{className:"h-24 md:h-full flex items-center justify-center border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl text-slate-400 dark:text-slate-500 text-sm font-medium",children:"Vide"}):t.items.map(l=>e.jsxs("div",{className:`group relative ${g===l.id?"opacity-50":""}`,draggable:"true",onDragStart:c=>U(c,l.id),onDragEnd:()=>v(null),children:[e.jsx("div",{className:"hidden md:block absolute left-1 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity z-10 cursor-grab active:cursor-grabbing text-slate-300 dark:text-slate-600",children:e.jsx(Ie,{size:16})}),e.jsx("div",{className:"md:group-hover:translate-x-3 transition-transform duration-200",children:e.jsx($e,{c:l,onClick:c=>M(c),onDuplicate:c=>i(c),onDelete:c=>{window.confirm("Supprimer ce lead ?")&&y(c)},onPromoteToSent:E,onMarkForRelance:C,onMarkAsSigned:P,onTriggerRelanceAction:m})})]},l.id))})]},t.id))})})]})};export{We as CommercialModule};
