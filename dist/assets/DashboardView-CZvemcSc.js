import{c as xe,j as e,B as S,u as W,m as Y}from"./index-CvXp101_.js";import{R as h,t as z,E as ee,r as p,X as me,u as ue,m as A,v as be,w as pe,x as he,y as fe,z as ge,B as Ne,F as je,G as ve,H as we,T as Q,I as ke,J as Ce,p as ye,c as Z,C as J,n as te,K as Se,o as Ee}from"./vendor-D0DKGMpp.js";import{C as se}from"./Card-DYqkvist.js";import{S as Ie}from"./StatusBanner-DsRVUt_Y.js";const q=(...s)=>s.filter(Boolean).join(" "),j=({label:s,value:r,onChange:a,placeholder:n,type:o="text",error:c,inputMode:t,pattern:i,id:m,className:v="",disabled:g=!1,min:N,step:u})=>h.createElement("div",{className:q("mb-4",v),id:m},s?h.createElement("label",{className:q("block text-sm font-medium mb-1.5",c?"text-red-600":"text-slate-700 dark:text-slate-300")},`${s}${c?" *":""}`):null,h.createElement("input",{type:o,value:r||"",onChange:d=>a&&a(d.target.value),placeholder:n,inputMode:t,pattern:i,disabled:g,min:N,step:u,className:q("w-full p-3 rounded-xl bg-white dark:bg-slate-900 border outline-none transition-all dark:text-white focus:ring-4",c?"border-red-500 focus:ring-red-200 focus:border-red-500":"border-slate-200 dark:border-slate-700 focus:border-brand-500 focus:ring-brand-200",g&&"opacity-50 cursor-not-allowed")}),c?h.createElement("span",{className:"text-xs text-red-500 mt-1 block"},"Requis"):null),K=(...s)=>s.filter(Boolean).join(" "),ae=({options:s,value:r,onChange:a,label:n,error:o,id:c,className:t="",disabled:i=!1})=>h.createElement("div",{className:K("mb-4",t),id:c},n?h.createElement("label",{className:"block text-sm font-medium mb-2 text-slate-700 dark:text-slate-300"},n):null,h.createElement("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl"},s.map(m=>h.createElement("button",{key:m.value,type:"button",onClick:()=>!i&&a(m.value),disabled:i,className:K("flex-1 py-2 px-3 text-sm font-medium rounded-lg transition-all",r===m.value?"bg-white dark:bg-slate-700 text-brand-600 shadow-sm":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",i&&"opacity-50 cursor-not-allowed")},m.label))),o?h.createElement("span",{className:"text-xs text-red-500 mt-1 block"},"Requis"):null),Ae=({isOpen:s,onClose:r,title:a,children:n,size:o="md"})=>{if(!s)return null;const c={sm:"max-w-md",md:"max-w-xl",lg:"max-w-3xl",full:"max-w-full m-4"};return h.createElement("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm animate-fade-in"},h.createElement("div",{className:xe("bg-white dark:bg-slate-900 rounded-t-2xl md:rounded-2xl shadow-2xl w-full flex flex-col max-h-[90vh] animate-slide-up md:animate-fade-in",c[o])},h.createElement("div",{className:"px-6 py-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center"},h.createElement("h3",{className:"font-bold text-lg dark:text-white"},a),h.createElement("button",{onClick:r,className:"p-2 -mr-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 bg-slate-50 dark:bg-slate-800 rounded-full transition-colors"},"✕")),h.createElement("div",{className:"overflow-y-auto p-4"},n)))},Te=({address:s,gps:r,className:a=""})=>{if(!s)return e.jsx("span",{className:"text-slate-400 italic text-xs",children:"Pas d'adresse"});const n=o=>{o.stopPropagation();const c=encodeURIComponent(s),t=r==null?void 0:r.lat,i=r==null?void 0:r.lon;/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1?t&&i?window.location.href=`http://maps.apple.com/?ll=${t},${i}&q=${c}`:window.location.href=`http://maps.apple.com/?q=${c}`:t&&i?window.location.href=`geo:${t},${i}?q=${t},${i}(${c})`:window.location.href=`geo:0,0?q=${c}`};return e.jsxs("button",{onClick:n,className:`text-left hover:text-brand-600 hover:underline flex items-start group transition-colors ${a}`,title:"Ouvrir dans le GPS",children:[e.jsx(z,{size:14,className:"mr-1 mt-0.5 shrink-0 text-slate-400 group-hover:text-brand-500"}),e.jsx("span",{className:"truncate",children:s}),e.jsx(ee,{size:10,className:"ml-1 mt-1 text-slate-300 opacity-0 group-hover:opacity-100 transition-opacity"})]})},F=({value:s,onChange:r})=>{const[a,n]=p.useState(!1),[o,c]=p.useState([]),[t,i]=p.useState(!1),m=p.useRef(null);p.useEffect(()=>{function d(x){m.current&&!m.current.contains(x.target)&&i(!1)}return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[m]);const v=async d=>{if(!(!d||d.length<3))try{const k=await(await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(d)}&limit=5`)).json();k&&k.features&&(c(k.features),i(!0))}catch(x){console.error("Erreur recherche adresse",x)}};p.useEffect(()=>{const d=typeof s=="object"?s.address:s,x=setTimeout(()=>{d&&t&&v(d)},500);return()=>clearTimeout(x)},[s,t]);const g=()=>{if(!navigator.geolocation)return alert("Géolocalisation non supportée");n(!0);const d={enableHighAccuracy:!0,timeout:1e4,maximumAge:0};navigator.geolocation.getCurrentPosition(async x=>{try{const C=await(await fetch(`https://api-adresse.data.gouv.fr/reverse/?lon=${x.coords.longitude}&lat=${x.coords.latitude}`)).json();if(C&&C.features&&C.features.length>0){const M={address:C.features[0].properties.label,gps:{lat:x.coords.latitude,lon:x.coords.longitude}};r(M),c(C.features),i(!0)}else alert("Adresse introuvable à cette position.")}catch(k){console.error(k),alert("Erreur réseau API Adresse")}finally{n(!1)}},x=>{n(!1),console.warn("Erreur GPS:",x),alert("Impossible de vous localiser précisément. Vérifiez que le GPS est activé.")},d)},N=d=>{const x={address:d.properties.label,gps:{lon:d.geometry.coordinates[0],lat:d.geometry.coordinates[1]}};r(x),i(!1)},u=typeof s=="object"?s.address:s||"";return e.jsxs("div",{className:"mb-4 relative",ref:m,children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-200 mb-1",children:"Adresse du chantier"}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:u,onChange:d=>{r(d.target.value),i(!0)},onFocus:()=>u&&u.length>3&&i(!0),placeholder:"Saisir ou cliquer sur le pin...",className:"w-full p-3 pl-10 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all shadow-sm",autoComplete:"off"}),e.jsx(z,{size:18,className:"absolute left-3 top-3.5 text-slate-400"}),u&&e.jsx("button",{type:"button",onClick:()=>{r(""),c([])},className:"absolute right-3 top-3.5 text-slate-400 hover:text-slate-600",children:e.jsx(me,{size:16})})]}),e.jsx("button",{type:"button",onClick:g,disabled:a,className:"shrink-0 w-12 flex items-center justify-center bg-brand-50 dark:bg-brand-900/20 text-brand-600 border border-brand-200 dark:border-brand-800 rounded-xl hover:bg-brand-100 transition-colors disabled:opacity-50 active:scale-95",children:a?e.jsx(ue,{className:"animate-spin",size:20}):e.jsx(z,{size:20})})]}),t&&o.length>0&&e.jsx("ul",{className:"absolute z-[100] left-0 right-0 mt-1 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-xl shadow-xl max-h-60 overflow-y-auto animate-fade-in divide-y divide-slate-100 dark:divide-slate-700",children:o.map((d,x)=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>N(d),className:"w-full text-left px-4 py-3 text-sm text-slate-700 dark:text-slate-200 hover:bg-brand-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[e.jsx(z,{size:14,className:"text-slate-400 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:d.properties.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:[d.properties.postcode," ",d.properties.city]})]})]})},x))}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-1 ml-1 flex justify-between",children:[e.jsx("span",{children:"Le bouton utilise le GPS haute précision."}),a&&e.jsx("span",{className:"text-brand-500 font-bold",children:"Localisation en cours..."})]})]})},De=s=>{if(!s)return 0;const r=new Date;return s.filter(a=>{if(a.sendStatus==="SENT")return!1;if(!a.dateIntervention){const n=new Date(a.date);return(r-n)/(1e3*60*60*24)>5}return!1}).length},Re=s=>{if(!s.dateIntervention)return null;const r=g=>new Date(g).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",a=r(s.dateIntervention),n=r(new Date(new Date(s.dateIntervention).getTime()+60*6e4)),o=r(new Date);let c=s.adresse,t="",i="";s.gps&&s.gps.lat&&(t=`GEO:${s.gps.lat};${s.gps.lon}`,i=`X-APPLE-STRUCTURED-LOCATION;VALUE=URI;X-APPLE-RADIUS=100;X-TITLE="${s.adresse}":geo:${s.gps.lat},${s.gps.lon}`);const m=`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//SarangePro//Métrage//FR
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:${s.id}@app.sarange.fr
DTSTAMP:${o}
DTSTART:${a}
DTEND:${n}
SUMMARY:Métré : ${s.client}
DESCRIPTION:Client: ${s.client}\\nTéléphone: ${s.telephone}\\nAdresse: ${s.adresse}
LOCATION:${c}
${t}
${i}
STATUS:CONFIRMED
BEGIN:VALARM
TRIGGER:-P1D
ACTION:DISPLAY
DESCRIPTION:Rappel J-1 : Métré demain (${s.client})
END:VALARM
BEGIN:VALARM
TRIGGER:-PT2H
ACTION:DISPLAY
DESCRIPTION:Rappel H-2 : Départ imminent ? Vérifiez le trafic.
END:VALARM
BEGIN:VALARM
TRIGGER:-PT0M
ACTION:DISPLAY
DESCRIPTION:C'est l'heure du métré !
END:VALARM
END:VEVENT
END:VCALENDAR`,v=new Blob([m],{type:"text/calendar;charset=utf-8"});return URL.createObjectURL(v)},Pe=s=>{const r=Re(s);if(!r)return;const a=document.createElement("a");a.href=r,a.setAttribute("download",`Metre_${s.client.replace(/\s+/g,"_")}.ics`),document.body.appendChild(a),a.click(),document.body.removeChild(a)},Oe=s=>{if(!s.dateIntervention)return"";const r=encodeURIComponent(`Métré : ${s.client}`),a=encodeURIComponent(`Client: ${s.client}
Téléphone: ${s.telephone||""}
Adresse: ${s.adresse}

${s.gps?`GPS: ${s.gps.lat}, ${s.gps.lon}`:""}`),n=encodeURIComponent(s.adresse),o=new Date(s.dateIntervention),c=o.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",t=new Date(o.getTime()+60*6e4).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${r}&dates=${c}/${t}&details=${a}&location=${n}`},$e=({chantier:s})=>{const[r,a]=p.useState(!1);if(!s||!s.dateIntervention)return null;const n=()=>{window.open(Oe(s),"_blank"),a(!1)},o=()=>{Pe(s),a(!1)};return e.jsxs("div",{className:"relative inline-block",children:[e.jsxs(S,{variant:"secondary",onClick:()=>a(!r),className:"py-2 px-3 text-sm flex items-center gap-2",title:"Ajouter à l'agenda",children:[e.jsx(A,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Agenda"})]}),r&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 z-50 animate-fade-in overflow-hidden flex flex-col p-1",children:[e.jsxs("button",{onClick:n,className:"flex items-center w-full px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 rounded-lg transition-colors text-left",children:[e.jsx(ee,{size:14,className:"mr-2"})," Google Calendar"]}),e.jsxs("button",{onClick:o,className:"flex items-center w-full px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg transition-colors text-left",children:[e.jsx(be,{size:14,className:"mr-2"})," Outlook / Apple"]})]}),r&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>a(!1)})]})},Le=({onClose:s,onConfirm:r})=>{const a=new Date;a.setDate(a.getDate()+1);const n=a.toISOString().split("T")[0],[o,c]=p.useState(n),[t,i]=p.useState("09:00"),m=u=>{const d=new Date;d.setDate(d.getDate()+u),c(d.toISOString().split("T")[0])},v=u=>{i(u)},g=()=>{if(!o||!t)return alert("Veuillez choisir une date et une heure");const u=`${o}T${t}`;r(u),s()},N=({label:u,onClick:d,active:x})=>e.jsx("button",{onClick:d,className:`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all ${x?"bg-brand-100 text-brand-700 border-brand-200":"bg-white text-slate-600 border-slate-200 hover:border-brand-300"}`,children:u});return e.jsx(Ae,{isOpen:!0,onClose:s,title:"Planifier l'intervention",size:"sm",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-200",children:[e.jsx(A,{size:16})," Date"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{label:"Demain",onClick:()=>m(1),active:!1}),e.jsx(N,{label:"+2j",onClick:()=>m(2),active:!1}),e.jsx(N,{label:"+7j",onClick:()=>m(7),active:!1})]})]}),e.jsx(j,{type:"date",value:o,onChange:c,className:"font-bold text-lg",min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-200",children:[e.jsx(pe,{size:16})," Heure"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{label:"09:00",onClick:()=>v("09:00"),active:t==="09:00"}),e.jsx(N,{label:"14:00",onClick:()=>v("14:00"),active:t==="14:00"})]})]}),e.jsx(j,{type:"time",value:t,onChange:i,className:"font-bold text-lg text-center"})]}),e.jsx(S,{onClick:g,className:"w-full py-4 text-lg shadow-lg",icon:he,children:"Valider le rendez-vous"})]})})},ze=({activeTab:s,onTabChange:r,counts:a})=>e.jsxs("div",{className:"lg:hidden grid grid-cols-3 gap-2 mb-4 shrink-0",children:[e.jsxs("button",{onClick:()=>r("TODO"),className:`p-3 rounded-xl border transition-all flex flex-col items-center justify-center text-center gap-1
                    ${s==="TODO"?"ring-2 ring-offset-1 ring-red-400 dark:ring-red-500 border-transparent":"border-red-100 dark:border-red-900/30"}
                    bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400`,children:[e.jsx("div",{className:"text-2xl font-bold",children:a.todo}),e.jsx("div",{className:"text-[10px] font-bold uppercase truncate w-full",children:"À PLANIFIER"})]}),e.jsxs("button",{onClick:()=>r("PLANNING"),className:`p-3 rounded-xl border transition-all flex flex-col items-center justify-center text-center gap-1
                      ${s==="PLANNING"?"ring-2 ring-offset-1 ring-brand-400 dark:ring-brand-500 border-transparent":"border-brand-100 dark:border-brand-900/30"}
                      bg-brand-50 text-brand-600 dark:bg-brand-900/20 dark:text-brand-400`,children:[e.jsx("div",{className:"text-2xl font-bold",children:a.planning}),e.jsx("div",{className:"text-[10px] font-bold uppercase truncate w-full",children:"PLANNING"})]}),e.jsxs("button",{onClick:()=>r("DONE"),className:`p-3 rounded-xl border transition-all flex flex-col items-center justify-center text-center gap-1
                      ${s==="DONE"?"ring-2 ring-offset-1 ring-green-400 dark:ring-green-500 border-transparent":"border-green-100 dark:border-green-900/30"}
                      bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400`,children:[e.jsx("div",{className:"text-2xl font-bold",children:a.done}),e.jsx("div",{className:"text-[10px] font-bold uppercase truncate w-full",children:"ENVOYÉS"})]})]}),Fe=({onNew:s,isDark:r,toggleDark:a,onOpenSettings:n,onOpenTrash:o,isOnline:c})=>{const{state:t,selectChantier:i,deleteChantier:m,duplicateChantier:v,updateChantier:g,addChantier:N}=W(),[u,d]=p.useState(""),[x,k]=p.useState(!1),[C,E]=p.useState(!1),M=p.useRef(null),[T,ne]=p.useState("TODO"),[I,U]=p.useState(null),re=async l=>{if(I){g(I,{dateIntervention:l});const b=t.chantiers.find(w=>w.id===I);if(b)try{const w={...b,dateIntervention:l},f=await Y(w);f&&g(I,{googleEventId:f})}catch(w){console.error("Auto-sync GCal blocked",w)}U(null)}},[D,oe]=p.useState(!1),H=(t.chantiers||[]).filter(l=>!l.deleted&&!l.purged),ie=H.filter(l=>l.archived).length,[X,de]=p.useState(0);p.useEffect(()=>{de(De(t.chantiers||[]))},[t.chantiers]);const G=H.filter(l=>l.client.toLowerCase().includes(u.toLowerCase())||l.adresse.toLowerCase().includes(u.toLowerCase())||l.telephone&&l.telephone.includes(u)||l.email&&l.email.toLowerCase().includes(u.toLowerCase())).filter(l=>D?l.archived:!l.archived),R=G.filter(l=>!l.dateIntervention&&l.sendStatus!=="SENT").sort((l,b)=>new Date(l.date).getTime()-new Date(b.date).getTime()),P=G.filter(l=>l.dateIntervention&&l.sendStatus!=="SENT").sort((l,b)=>new Date(l.dateIntervention).getTime()-new Date(b.dateIntervention).getTime()),V=new Date,_=new Date(V.getFullYear(),V.getMonth(),V.getDate()).getTime(),O=_+864e5,ce=_+7*864e5,y={today:[],tomorrow:[],week:[],later:[]};P.forEach(l=>{const b=new Date(l.dateIntervention).getTime();b>=_&&b<O?y.today.push(l):b>=O&&b<O+864e5?y.tomorrow.push(l):b>=O+864e5&&b<ce?y.week.push(l):y.later.push(l)});const $=G.filter(l=>l.sendStatus==="SENT").sort((l,b)=>new Date(b.sentAt).getTime()-new Date(l.sentAt).getTime()),B=({c:l,isTodo:b=!1})=>{const w=!l.dateIntervention&&l.sendStatus!=="SENT"&&Date.now()-new Date(l.date).getTime()>432e6;return e.jsxs("div",{onClick:()=>i(l.id),className:`relative group bg-white dark:bg-slate-900 p-4 rounded-xl border shadow-sm hover:shadow-md active:scale-[0.99] transition-all cursor-pointer overflow-hidden mb-3
                    ${l.sendStatus==="SENT"?"border-green-200 dark:border-green-800 opacity-75 hover:opacity-100":w?"border-red-400 dark:border-red-500 ring-1 ring-red-400 dark:ring-red-500":"border-slate-200 dark:border-slate-800 hover:border-brand-400 dark:hover:border-brand-600"}
                `,children:[w&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-bl-lg",children:"URGENT"}),e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-bold text-lg dark:text-white truncate pr-2",children:l.client}),l.sendStatus==="SENT"&&e.jsx(J,{size:16,className:"text-green-500"})]}),e.jsx("div",{className:"text-sm text-slate-500 mb-3 ml-[-5px]",children:e.jsx(Te,{address:l.adresse,gps:l.gps})}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-lg p-2.5 flex items-center justify-between mb-3 text-sm",children:[l.dateIntervention?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"Intervention"}),e.jsxs("span",{className:"font-bold text-brand-600 dark:text-brand-400 flex items-center gap-1",children:[e.jsx(A,{size:14}),new Date(l.dateIntervention).toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})]})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"Créé le"}),e.jsx("span",{className:"font-bold text-slate-600 dark:text-slate-300",children:new Date(l.date).toLocaleDateString("fr-FR")})]}),l.telephone&&e.jsx("a",{href:`tel:${l.telephone}`,onClick:f=>f.stopPropagation(),className:"bg-white dark:bg-slate-700 p-2 rounded-full text-slate-600 dark:text-slate-300 shadow-sm border border-slate-100 dark:border-slate-600 hover:text-brand-600 hover:border-brand-600 transition-colors",children:e.jsx(Se,{size:16})})]}),b&&e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsx(S,{className:"flex-1 py-2 text-xs bg-brand-600 text-white shadow-md hover:bg-brand-700 h-10",onClick:f=>{f.stopPropagation(),U(l.id)},icon:A,children:"PLANIFIER"})}),e.jsxs("div",{className:"flex items-center justify-end pt-2 mt-2 border-t border-slate-100 dark:border-slate-800 gap-2",children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),v(l.id)},className:"text-slate-400 hover:text-brand-500",children:e.jsx(Ee,{size:16})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),confirm("Supprimer ?")&&m(l.id)},className:"text-slate-400 hover:text-red-500",children:e.jsx(Q,{size:16})})]})]})},L=({title:l,items:b,color:w})=>b.length===0?null:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:`text-xs font-bold uppercase tracking-wider mb-2 ${w}`,children:l}),b.map(f=>e.jsx(B,{c:f},f.id))]});return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0 z-40 px-4 pb-3 safe-top-padding shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 max-w-[1400px] mx-auto pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/favicon-512.png",alt:"Logo",className:"w-8 h-8 object-contain rounded-lg"}),e.jsxs("h1",{className:"text-xl font-bold tracking-tight",children:["Sarange",e.jsx("span",{className:"text-brand-600",children:"Pro"})]})]}),e.jsxs("div",{className:"flex gap-2 relative",ref:M,children:[c?e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full",children:e.jsx(fe,{size:20,className:"text-green-500"})}):e.jsx("div",{className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full",children:e.jsx(ge,{size:20,className:"text-slate-400"})}),e.jsx("button",{onClick:()=>E(!C),className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:e.jsx(Ne,{size:20})}),C&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 overflow-hidden z-50 animate-fade-in origin-top-right",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("button",{onClick:a,className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg transition-colors",children:[r?e.jsx(je,{size:16,className:"mr-3 text-orange-400"}):e.jsx(ve,{size:16,className:"mr-3 text-brand-600"}),r?"Mode Clair":"Mode Sombre"]}),e.jsx("div",{className:"h-px bg-slate-100 dark:bg-slate-700 my-1"}),e.jsxs("button",{onClick:()=>{oe(!D),E(!1)},className:`w-full flex items-center px-3 py-2 text-sm rounded-lg transition-colors ${D?"bg-brand-50 text-brand-700":"text-slate-700 dark:text-slate-200 hover:bg-slate-50"}`,children:[e.jsx(we,{size:16,className:"mr-3"}),D?"Voir Dossiers Actifs":"Voir Archives",e.jsx("span",{className:"ml-auto text-xs bg-slate-100 px-1.5 rounded-full",children:ie})]}),e.jsxs("button",{onClick:()=>{o(),E(!1)},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-lg",children:[e.jsx(Q,{size:16,className:"mr-3 text-red-500"}),"Corbeille"]}),e.jsxs("button",{onClick:()=>{n(),E(!1)},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 rounded-lg",children:[e.jsx(ke,{size:16,className:"mr-3"}),"Paramètres"]})]})})]})]}),e.jsxs("div",{className:"max-w-[1400px] mx-auto relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-800 border-0 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all shadow-inner",placeholder:"Rechercher un dossier...",value:u,onChange:l=>d(l.target.value)})]}),e.jsx(S,{onClick:()=>k(!0),icon:ye,className:"py-2 text-sm shadow-sm whitespace-nowrap px-4",children:"Nouveau"})]})]}),e.jsxs("main",{className:"flex-1 p-4 max-w-[1400px] mx-auto w-full h-[calc(100vh-140px)] overflow-hidden flex flex-col",children:[X>0&&e.jsx("div",{className:"mb-4 shrink-0",children:e.jsxs(Ie,{variant:"warning",icon:Z,children:[X," dossiers en attente de planification depuis +3 jours !"]})}),e.jsx(ze,{activeTab:T,onTabChange:ne,counts:{todo:R.length,planning:P.length,done:$.length}}),e.jsxs("div",{className:"flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:`flex flex-col h-full ${T==="TODO"?"block":"hidden lg:flex"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-red-600 flex items-center gap-2",children:[e.jsx(Z,{size:20}),"À PLANIFIER",e.jsx("span",{className:"bg-red-100 text-red-700 text-xs px-2 py-0.5 rounded-full",children:R.length})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 pb-20 custom-scrollbar",children:R.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Aucun dossier en attente"}):R.map(l=>e.jsx(B,{c:l,isTodo:!0},l.id))})]}),e.jsxs("div",{className:`flex flex-col h-full ${T==="PLANNING"?"block":"hidden lg:flex"} lg:border-l lg:border-r lg:border-slate-100 lg:dark:border-slate-800 lg:px-6`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-brand-600 flex items-center gap-2",children:[e.jsx(A,{size:20}),"PLANNING",e.jsx("span",{className:"bg-brand-100 text-brand-700 text-xs px-2 py-0.5 rounded-full",children:P.length})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 pb-20 custom-scrollbar",children:P.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Planning vide"}):e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Aujourd'hui",items:y.today,color:"text-green-600"}),e.jsx(L,{title:"Demain",items:y.tomorrow,color:"text-blue-600"}),e.jsx(L,{title:"Cette semaine",items:y.week,color:"text-brand-600"}),e.jsx(L,{title:"Plus tard",items:y.later,color:"text-slate-500"})]})})]}),e.jsxs("div",{className:`flex flex-col h-full ${T==="DONE"?"block":"hidden lg:flex"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4 px-2 shrink-0",children:e.jsxs("h3",{className:"font-bold text-green-600 flex items-center gap-2",children:[e.jsx(J,{size:20}),"ENVOYÉS",e.jsx("span",{className:"bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full",children:$.length})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 pb-20 custom-scrollbar",children:$.length===0?e.jsx("div",{className:"text-center p-8 text-slate-400 italic bg-slate-50 dark:bg-slate-900 rounded-xl border border-dashed border-slate-200",children:"Aucun dossier envoyé"}):$.map(l=>e.jsx(B,{c:l},l.id))})]})]})]}),x&&e.jsx(le,{onClose:()=>k(!1)}),I&&e.jsx(Le,{onClose:()=>U(null),onConfirm:re})]})},le=({onClose:s})=>{const{addChantier:r}=W(),[a,n]=p.useState({client:"",adresse:"",gps:null,typeContrat:"FOURNITURE_SEULE",telephone:"",email:"",clientFinal:"",adresseFinale:""}),o=(t,i="adresse")=>{n(typeof t=="object"?{...a,[i]:t.address,gps:t.gps}:{...a,[i]:t})},c=async()=>{if(!a.client)return alert("Nom requis");if(a.typeContrat==="SOUS_TRAITANCE"&&(!a.clientFinal||!a.adresseFinale))return alert("Client final requis");const t={...a,date:new Date().toISOString()};if(r(t),s(),t.dateIntervention)try{const i=await Y(t)}catch(i){console.error("Silent GCal Sync Fail",i)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-0 md:p-4 animate-fade-in",children:e.jsxs(se,{className:"w-full max-w-md p-6 shadow-2xl rounded-t-2xl md:rounded-2xl max-h-[95vh] overflow-y-auto animate-slide-up md:animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Nouveau Dossier"}),e.jsx("button",{onClick:s,className:"p-2 text-slate-400 hover:text-slate-600 bg-slate-50 dark:bg-slate-800 rounded-full transition-colors",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{label:"Nom Client",value:a.client,onChange:t=>n({...a,client:t}),placeholder:"Ex: Entreprise BTP"}),e.jsx(F,{value:a.adresse,onChange:t=>o(t,"adresse")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{label:"Tél",value:a.telephone,onChange:t=>n({...a,telephone:t}),type:"tel",inputMode:"tel",pattern:"[0-9]*"}),e.jsx(j,{label:"Email",value:a.email,onChange:t=>n({...a,email:t}),type:"email",inputMode:"email"})]}),e.jsx(ae,{label:"Contrat",value:a.typeContrat,onChange:t=>n({...a,typeContrat:t}),options:[{label:"Fourniture Seule",value:"FOURNITURE_SEULE"},{label:"Fourniture & Pose",value:"FOURNITURE_ET_POSE"},{label:"Sous-traitance",value:"SOUS_TRAITANCE"}]}),a.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700 animate-fade-in",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-500 mb-2 uppercase flex items-center",children:[e.jsx(te,{size:14,className:"mr-1"})," Client Final"]}),e.jsx(j,{label:"Nom Final",value:a.clientFinal,onChange:t=>n({...a,clientFinal:t}),placeholder:"Ex: Mme Michu"}),e.jsx(F,{value:a.adresseFinale,onChange:t=>o(t,"adresseFinale")})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8 pb-4",children:[e.jsx(S,{variant:"secondary",onClick:s,className:"flex-1",children:"Annuler"}),e.jsx(S,{onClick:c,className:"flex-1",children:"Créer"})]})]})})},Me=({chantier:s,onClose:r,onUpdate:a})=>{const[n,o]=p.useState({...s}),c=async()=>{if(!n.client)return alert("Nom requis");if(n.typeContrat==="SOUS_TRAITANCE"&&(!n.clientFinal||!n.adresseFinale))return alert("Client final requis");if(a(n),r(),n.dateIntervention)try{const t=await Y(n);t&&t!==n.googleEventId&&a({...n,googleEventId:t})}catch(t){console.error("Silent GCal Sync Fail",t)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-0 md:p-4 animate-fade-in",children:e.jsxs(se,{className:"w-full max-w-md p-6 shadow-2xl rounded-t-2xl md:rounded-2xl max-h-[95vh] overflow-y-auto animate-slide-up md:animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Modifier le dossier"}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["ID : ",n.id.slice(0,8)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{chantier:n}),e.jsx("button",{onClick:r,className:"p-2 text-slate-400 hover:text-slate-600 bg-slate-50 dark:bg-slate-800 rounded-full transition-colors",children:"✕"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-2 uppercase tracking-wider",children:"Planification"}),e.jsx(j,{label:"Date d'intervention",type:"datetime-local",value:n.dateIntervention||"",onChange:t=>o({...n,dateIntervention:t})}),e.jsx("p",{className:"text-[10px] font-medium text-slate-400 mt-2",children:n.dateIntervention?"✅ Ce dossier passera en PLANNING":"⚠️ Sans date, ce dossier reste en À PLANIFIER"})]}),e.jsx(j,{label:"Nom Client",value:n.client,onChange:t=>o({...n,client:t})}),e.jsx(F,{value:n.adresse,onChange:t=>o(typeof t=="object"?{...n,adresse:t.address,gps:t.gps}:{...n,adresse:t})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{label:"Tél",value:n.telephone,onChange:t=>o({...n,telephone:t}),type:"tel",inputMode:"tel",pattern:"[0-9]*"}),e.jsx(j,{label:"Email",value:n.email,onChange:t=>o({...n,email:t}),type:"email",inputMode:"email"})]}),e.jsx(ae,{label:"Contrat",value:n.typeContrat,onChange:t=>o({...n,typeContrat:t}),options:[{label:"Fourniture Seule",value:"FOURNITURE_SEULE"},{label:"Fourniture & Pose",value:"FOURNITURE_ET_POSE"},{label:"Sous-traitance",value:"SOUS_TRAITANCE"}]}),n.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-3 rounded-lg border border-amber-200 dark:border-amber-800 animate-fade-in",children:[e.jsxs("h3",{className:"text-xs font-bold text-amber-600 dark:text-amber-400 mb-2 uppercase flex items-center",children:[e.jsx(te,{size:14,className:"mr-1"})," Client Final"]}),e.jsx(j,{label:"Nom Final",value:n.clientFinal,onChange:t=>o({...n,clientFinal:t})}),e.jsx(F,{value:n.adresseFinale,onChange:t=>setAddr(t,"adresseFinale")})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8 pb-4",children:[e.jsx(S,{variant:"secondary",onClick:r,className:"flex-1",children:"Annuler"}),e.jsx(S,{onClick:c,className:"flex-1",children:"Enregistrer"})]})]})})},Be=Object.freeze(Object.defineProperty({__proto__:null,DashboardView:Fe,EditChantierModal:Me,NewChantierModal:le},Symbol.toStringTag,{value:"Module"}));export{Be as D,Me as E,j as I,Ae as M,ae as S,Te as a};
