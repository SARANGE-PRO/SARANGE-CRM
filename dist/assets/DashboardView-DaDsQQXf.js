import{j as e,u as F,B as v,c as A,I as u,S as z}from"./index-BkUUXKzz.js";import{r as c,p as y,q as L,s as D,t as $,u as q,v as B,w as G,l as V,x as H,y as J,j as R,k as K,T as Q,n as W,A as X,z as Y}from"./vendor-Dg6mT7in.js";import"./utils-CRpMHnBn.js";const C=({value:h,onChange:x})=>{const[a,s]=c.useState([]),[i,r]=c.useState(!1),l=c.useRef(null),f=c.useRef(null);c.useEffect(()=>{const n=d=>{l.current&&!l.current.contains(d.target)&&r(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]);const b=async n=>{try{const d=await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(n)}&limit=5`);if(d.ok){const p=await d.json();s(p.features||[]),r(!0)}}catch{}},k=n=>{const d=n.target.value;x(d),f.current&&clearTimeout(f.current),d.length>3?f.current=setTimeout(()=>b(d),300):r(!1)},S=()=>{if(window.location.protocol!=="https:"&&window.location.hostname!=="localhost"){alert("Connexion non sÃ©curisÃ©e : Localisation indisponible.");return}navigator.geolocation&&navigator.geolocation.getCurrentPosition(async n=>{var d;try{const g=await(await fetch(`https://api-adresse.data.gouv.fr/reverse/?lon=${n.coords.longitude}&lat=${n.coords.latitude}`)).json();(d=g.features)!=null&&d.length&&x(g.features[0].properties.label)}catch{}},n=>alert("Erreur GPS."))};return e.jsxs("div",{className:"relative mb-4",ref:l,children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5 text-slate-700 dark:text-slate-300",children:"Adresse"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"w-full p-3 pl-10 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:border-brand-500 dark:bg-slate-900 dark:text-white",placeholder:"Adresse...",value:h,onChange:k}),e.jsx(y,{size:18,className:"absolute left-3 top-3.5 text-slate-400"}),e.jsx("button",{onClick:S,className:"absolute right-2 top-2 p-1.5 text-brand-600 hover:bg-brand-50 rounded",children:e.jsx(y,{size:18})})]}),i&&a.length>0&&e.jsx("ul",{className:"suggestions-list",children:a.map(n=>e.jsxs("li",{onClick:()=>{x(n.properties.label),r(!1)},className:"p-3 border-b dark:border-slate-700 hover:bg-brand-50 dark:hover:bg-slate-800 cursor-pointer flex flex-col group",children:[e.jsx("span",{className:"font-medium text-sm text-slate-800 dark:text-slate-200",children:n.properties.name}),e.jsxs("span",{className:"text-xs text-slate-500",children:[n.properties.postcode," ",n.properties.city]})]},n.properties.id))})]})},Z=({onClose:h})=>{const{addChantier:x}=F(),[a,s]=c.useState({client:"",adresse:"",typeContrat:"FOURNITURE_SEULE",telephone:"",email:"",clientFinal:"",adresseFinale:""}),i=()=>{if(!a.client)return alert("Nom requis");if(a.typeContrat==="SOUS_TRAITANCE"&&(!a.clientFinal||!a.adresseFinale))return alert("Client final requis");x({...a,date:new Date().toISOString()}),h()};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-4 animate-fade-in",children:e.jsxs(A,{className:"w-full max-w-md p-6 shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 dark:text-white",children:"Nouveau Dossier"}),e.jsx(u,{label:"Nom Client",value:a.client,onChange:r=>s({...a,client:r}),placeholder:"Ex: Entreprise BTP"}),e.jsx(C,{value:a.adresse,onChange:r=>s({...a,adresse:r})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"TÃ©l",value:a.telephone,onChange:r=>s({...a,telephone:r}),type:"tel",inputMode:"tel",pattern:"[0-9]*"}),e.jsx(u,{label:"Email",value:a.email,onChange:r=>s({...a,email:r}),type:"email",inputMode:"email"})]}),e.jsx(z,{label:"Contrat",value:a.typeContrat,onChange:r=>s({...a,typeContrat:r}),options:[{label:"Fourniture Seule",value:"FOURNITURE_SEULE"},{label:"Fourniture & Pose",value:"FOURNITURE_ET_POSE"},{label:"Sous-traitance",value:"SOUS_TRAITANCE"}]}),a.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700 mb-4 animate-fade-in",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-500 mb-2 uppercase flex items-center",children:[e.jsx(R,{size:14,className:"mr-1"})," Client Final"]}),e.jsx(u,{label:"Nom Final",value:a.clientFinal,onChange:r=>s({...a,clientFinal:r}),placeholder:"Ex: Mme Michu"}),e.jsx(C,{value:a.adresseFinale,onChange:r=>s({...a,adresseFinale:r})})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(v,{variant:"secondary",onClick:h,className:"flex-1",children:"Annuler"}),e.jsx(v,{onClick:i,className:"flex-1",children:"CrÃ©er"})]})]})})},ae=({chantier:h,onClose:x,onUpdate:a})=>{const[s,i]=c.useState({...h}),r=()=>{if(!s.client)return alert("Nom requis");if(s.typeContrat==="SOUS_TRAITANCE"&&(!s.clientFinal||!s.adresseFinale))return alert("Client final requis");a(s),x()};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-4 animate-fade-in",children:e.jsxs(A,{className:"w-full max-w-md p-6 shadow-2xl",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 dark:text-white",children:"Modifier"}),e.jsx(u,{label:"Nom Client",value:s.client,onChange:l=>i({...s,client:l})}),e.jsx(C,{value:s.adresse,onChange:l=>i({...s,adresse:l})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{label:"TÃ©l",value:s.telephone,onChange:l=>i({...s,telephone:l}),type:"tel",inputMode:"tel",pattern:"[0-9]*"}),e.jsx(u,{label:"Email",value:s.email,onChange:l=>i({...s,email:l}),type:"email",inputMode:"email"})]}),e.jsx(z,{label:"Contrat",value:s.typeContrat,onChange:l=>i({...s,typeContrat:l}),options:[{label:"Fourniture Seule",value:"FOURNITURE_SEULE"},{label:"Fourniture & Pose",value:"FOURNITURE_ET_POSE"},{label:"Sous-traitance",value:"SOUS_TRAITANCE"}]}),s.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700 mb-4 animate-fade-in",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-500 mb-2 uppercase flex items-center",children:[e.jsx(R,{size:14,className:"mr-1"})," Client Final"]}),e.jsx(u,{label:"Nom Final",value:s.clientFinal,onChange:l=>i({...s,clientFinal:l})}),e.jsx(C,{value:s.adresseFinale,onChange:l=>i({...s,adresseFinale:l})})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(v,{variant:"secondary",onClick:x,className:"flex-1",children:"Annuler"}),e.jsx(v,{onClick:r,className:"flex-1",children:"Enregistrer"})]})]})})},re=({onNew:h,isDark:x,toggleDark:a,onOpenSettings:s})=>{const{state:i,selectChantier:r,deleteChantier:l,duplicateChantier:f}=F(),[b,k]=c.useState(""),[S,n]=c.useState(!1),[d,p]=c.useState(!1),g=c.useRef(null);c.useEffect(()=>{function t(o){g.current&&!g.current.contains(o.target)&&p(!1)}return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[g]);const[m,N]=c.useState("all"),O=i.chantiers.filter(t=>!t.archived).length,U=i.chantiers.filter(t=>!t.archived&&(!t.sendStatus||t.sendStatus==="DRAFT"||t.sendStatus==="ERROR")).length,I=i.chantiers.filter(t=>!t.archived&&t.sendStatus==="SENT").length,M=i.chantiers.filter(t=>t.archived).length,T=i.chantiers.filter(t=>t.client.toLowerCase().includes(b.toLowerCase())||t.adresse.toLowerCase().includes(b.toLowerCase())||t.telephone&&t.telephone.includes(b)||t.email&&t.email.toLowerCase().includes(b.toLowerCase())).filter(t=>m==="archived"?t.archived:t.archived?!1:m==="draft"?!t.sendStatus||t.sendStatus==="DRAFT"||t.sendStatus==="ERROR":m==="sent"?t.sendStatus==="SENT":!0),P=({chantier:t})=>{const o=t.sendStatus||"DRAFT";if(o==="SENT"){const j=t.sentAt?new Date(t.sentAt):null,E=j?`${String(j.getDate()).padStart(2,"0")}/${String(j.getMonth()+1).padStart(2,"0")}`:"";return e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx(W,{size:20,className:"text-green-500"}),e.jsx("span",{className:"text-[10px] font-bold text-green-600 dark:text-green-400",children:E})]})}return o==="ERROR"?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx(X,{size:20,className:"text-red-500"}),e.jsx("span",{className:"text-[10px] font-bold text-red-600 dark:text-red-400",children:"Erreur"})]}):e.jsx(Y,{size:20,className:"text-orange-400"})},w=({active:t,onClick:o,count:j,label:E,colorClass:_})=>e.jsxs("button",{onClick:o,className:`p-4 rounded-xl border transition-all text-left ${_} ${t?"ring-2 ring-offset-2 ring-brand-500":"hover:scale-[1.02]"}`,children:[e.jsx("div",{className:"text-2xl font-bold",children:j}),e.jsx("div",{className:"text-xs font-medium",children:E})]});return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0 z-20 px-4 pb-3 safe-top-padding",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white font-bold",children:"S"}),e.jsxs("h1",{className:"text-xl font-bold tracking-tight",children:["Sarange",e.jsx("span",{className:"text-brand-600",children:"Pro"})]})]}),e.jsxs("div",{className:"flex gap-2 relative",ref:g,children:[e.jsx("button",{onClick:()=>p(!d),className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:e.jsx(L,{size:20})}),d&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-100 dark:border-slate-700 overflow-hidden z-50 animate-fade-in origin-top-right",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsxs("button",{onClick:()=>{a()},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg transition-colors",children:[x?e.jsx(D,{size:16,className:"mr-3 text-orange-400"}):e.jsx($,{size:16,className:"mr-3 text-brand-600"}),x?"Mode Clair":"Mode Sombre"]}),e.jsxs("button",{onClick:()=>{N("archived"),p(!1)},className:`w-full flex items-center px-3 py-2 text-sm rounded-lg transition-colors ${m==="archived"?"bg-brand-50 text-brand-700 dark:bg-brand-900/20 dark:text-brand-300":"text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[e.jsx(q,{size:16,className:"mr-3"}),"Archives",e.jsx("span",{className:"ml-auto text-xs bg-slate-100 dark:bg-slate-900 px-1.5 py-0.5 rounded-full",children:M})]}),e.jsx("div",{className:"h-px bg-slate-100 dark:bg-slate-700 my-1"}),e.jsxs("button",{onClick:()=>{s(),p(!1)},className:"w-full flex items-center px-3 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg transition-colors",children:[e.jsx(B,{size:16,className:"mr-3"}),"ParamÃ¨tres"]})]})})]})]}),e.jsxs("div",{className:"max-w-5xl mx-auto relative",children:[e.jsx(G,{className:"absolute left-3 top-3 text-slate-400",size:20}),e.jsx("input",{className:"w-full pl-10 p-2.5 bg-slate-100 dark:bg-slate-800 border-0 rounded-xl outline-none focus:ring-2 focus:ring-brand-500 dark:text-white transition-all",placeholder:"Rechercher...",value:b,onChange:t=>k(t.target.value)})]})]}),e.jsxs("main",{className:"flex-1 p-4 max-w-5xl mx-auto w-full",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(w,{active:m==="all",onClick:()=>N("all"),count:O,label:"Dossiers",colorClass:"bg-blue-50 dark:bg-blue-900/20 border-blue-100 dark:border-blue-800/30 text-blue-600 dark:text-blue-400"}),e.jsx(w,{active:m==="draft",onClick:()=>N("draft"),count:U,label:"En cours",colorClass:"bg-orange-50 dark:bg-orange-900/20 border-orange-100 dark:border-orange-900/30 text-orange-600 dark:text-orange-400"}),e.jsx(w,{active:m==="sent",onClick:()=>N("sent"),count:I,label:"EnvoyÃ©s",colorClass:"bg-green-50 dark:bg-green-900/20 border-green-100 dark:border-green-900/30 text-green-600 dark:text-green-400"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"font-bold text-slate-700 dark:text-slate-300",children:m==="all"?"Tous les dossiers":m==="draft"?"Dossiers en cours":m==="sent"?"Dossiers envoyÃ©s":"Archives"}),e.jsx(v,{onClick:()=>n(!0),icon:V,className:"py-2 text-sm shadow-sm",children:"Nouveau"})]}),e.jsxs("div",{className:"space-y-3",children:[T.length===0&&e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("span",{className:"text-4xl",children:"ðŸ“‚"}),e.jsxs("p",{className:"mt-2",children:["Aucun dossier ",m!=="all"?"dans cette catÃ©gorie":""]})]}),T.map(t=>e.jsxs("div",{onClick:()=>r(t.id),className:`group bg-white dark:bg-slate-900 p-4 rounded-xl border ${t.sendStatus==="SENT"?"border-green-400 dark:border-green-600":t.sendStatus==="ERROR"?"border-red-400 dark:border-red-600":t.typeContrat==="SOUS_TRAITANCE"?"border-amber-400 dark:border-amber-600":"border-slate-200 dark:border-slate-800"} shadow-sm active:scale-[0.99] transition-all cursor-pointer hover:border-brand-400 dark:hover:border-brand-600 relative overflow-hidden`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white group-hover:text-brand-600 transition-colors",children:t.client}),e.jsxs("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t.adresse)}`,target:"_blank",rel:"noopener noreferrer",onClick:o=>o.stopPropagation(),className:"text-sm text-slate-500 flex items-center mt-1 hover:text-brand-600 hover:underline",children:[e.jsx(y,{size:14,className:"mr-1"})," ",t.adresse]}),(t.telephone||t.email)&&e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-slate-500",children:[t.telephone&&e.jsxs("a",{href:`tel:${t.telephone}`,onClick:o=>o.stopPropagation(),className:"flex items-center hover:text-brand-600",children:[e.jsx(H,{size:12,className:"mr-1"})," ",t.telephone]}),t.email&&e.jsxs("a",{href:`mailto:${t.email}`,onClick:o=>o.stopPropagation(),className:"flex items-center hover:text-brand-600",children:[e.jsx(J,{size:12,className:"mr-1"})," ",t.email]})]}),t.typeContrat==="SOUS_TRAITANCE"&&e.jsxs("div",{className:"mt-2 text-xs bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-200 px-2 py-1 rounded inline-flex items-center",children:[e.jsx(R,{size:12,className:"mr-1"})," Client Final : ",t.clientFinal]})]}),e.jsx(P,{chantier:t})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center border-t border-slate-100 dark:border-slate-800 pt-3",children:[e.jsx("span",{className:"text-xs font-mono text-slate-400",children:new Date(t.date).toLocaleDateString()}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),f(t.id)},className:"text-slate-400 hover:text-brand-500",children:e.jsx(K,{size:18})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),confirm("Supprimer ?")&&l(t.id)},className:"text-slate-400 hover:text-red-500",children:e.jsx(Q,{size:18})})]})]})]},t.id))]})]}),S&&e.jsx(Z,{onClose:()=>n(!1)})]})};export{C as AddressInput,re as DashboardView,ae as EditChantierModal,Z as NewChantierModal};
